<!DOCTYPE html>
<!-- 
   Made in Hell
   https://ldijkman.github.io/Ace_Seventh_Heaven/Hell.html
-->   
<!-- 
Copyright, Free to use if message is left in the code   
    original source https://github.com/gopinav/ai 
  this: 
     OpenAI Stream Chat, HTML WebPage
       https://plnkr.co/edit/KmmUTa3FNTQ6WLa7
       https://codepen.io/ldijkman/pen/gOqWwxw?editors=1010
       https://ldijkman.github.io/Ace_Seventh_Heaven/OpenAI_Stream_Chat.html
             https://github.com/ldijkman/Ace_Seventh_Heaven/tree/main/docs

Copyright, Free to use if this/above message is left in the code           
-->   
<html>
  <head>
    <style>
      .container {
      /*  width: 500px;
        max-height: 500px;
        margin: 10px;
        border: 1px solid #fff;
        background-color: #ffffff;
        box-shadow: 0px 2px 7px #292929;
        -moz-box-shadow: 0px 2px 7px #292929;
        -webkit-box-shadow: 0px 2px 7px #292929;
        border-radius: 10px;
        -moz-border-radius: 10px;
        -webkit-border-radius: 10px;
        rresize: both;
*/
  position: absolute;
  min-height:90px;
         min-width:350px;
  background-color: #f1f1f1;
  border: 1px solid #d3d3d3;
  left: 40px;
  top:  140px;
  width: 500px;
  height: 500px;
  border-radius: 5px;
   
  
      }


      .container,
      .mainbody,
      .header,
      .footer {
        padding: 0px;
        
      }
      .mainbody {
        position:absolute;
        margin-top: 0;
        min-height:15px;
        max-height: 508px;
        width:100%;
        overflow: auto;
        top:40px;
        bottom:25px;
      
      }
      .header {
        position:absolute;
        height: 25px;
        width:100%;
        border-bottom: 1px solid #eee;
        background-color: lightblue;
        -webkit-border-top-left-radius: 5px;
        -webkit-border-top-right-radius: 5px;
        -moz-border-radius-topleft: 5px;
        -moz-border-radius-topright: 5px;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
        margin:2px;
        cursor:move;
      }
      .footer {
        position:absolute;
        height:20px;
        width:100%;
        background-color: lightgray;
        border-top: 1px solid #ddd;
        -webkit-border-bottom-left-radius: 5px;
        -webkit-border-bottom-right-radius: 5px;
        -moz-border-radius-bottomleft: 5px;
        -moz-border-radius-bottomright: 5px;
        border-bottom-left-radius: 5px;
        border-bottom-right-radius: 5px; 
        bottom:1px;
      }
.linenr {
    float: left;
    color: rgb(180, 180, 180);
    left: 1px;
    position: absolute;
}
.log-row {
    position:relative;
    left: 10px;
    margin-left: 20px;
}

#textbox {
   font-size: 18px;
    border:solid 2px gray;
    width:98%;
    height:20px;
}
    </style>

      <style>
    body{
      
      background:lightgray;
      margin:100px;

      
    }
  /* CSS for the spinner */
#spinner {
  border: 4px solid #f3f3f3; /* Light gray border */
  border-top: 4px solid orange; /* Orange color for spinning */
  border-radius: 50%; /* Circular shape */
  width: 22px; /* Make the spinner smaller by adjusting width */
  height: 22px; /* Make the spinner smaller by adjusting height */
  animation: spin 2s linear infinite; /* Spin animation */
  display: none; /* Initially hidden */
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
  </style>  
    </head>

  <body>
    <!-- next adds the console to the HTML webpage -->
    <script src="https://ldijkman.github.io/Ace_Seventh_Heaven/console.js"></script>
    <!-- above adds the console to the HTML webpage -->
       
       
        <button onclick="toggleVisibility('container')"">Toggle OpenAi</button>
     <button onclick="toggleVisibility('console-log-div')"">Toggle Console</button>
    
   

    <script>
        function toggleVisibility(what) {
            var myDiv = document.getElementById(what);

            // Toggle the visibility
            if (myDiv.style.display === "none") {
                myDiv.style.display = "block";
            } else {
                myDiv.style.display = "none";
            }
        }
    </script>

<br><br>
<iframe width="480" height="320" src="https://www.youtube.com/embed/VaPQZR8EarI" title="OpenAi API Stream Floating Code Assitant" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
<br><br><textarea rows="25" cols="80">
<pre>
  You: bruine bonen met spek

OpenAI Generating...
Bruine bonen met spek is een heerlijk en traditioneel Nederlands gerecht. 
Om het te maken heb je de volgende ingrediÃ«nten nodig:

-400 gram bruine bonen
-200 gram gerookte spekblokjes
-1 ui, gesnipperd
-2 teentjes knoflook, fijngehakt
-1 laurierblad
-1 theelepel paprikapoeder
-1 theelepel komijnpoeder
-1 blikje tomatenpuree
-500 ml water
- Zout en peper naar smaak
- Optioneel: een rookworst

Bereidingswijze:

1. Laat de bruine bonen een nacht in ruim water weken, spoel ze daarna goed af.

2. Verhit een beetje olie in een grote pan en bak de spekblokjes goudbruin.

3. Voeg de gesnipperde ui en knoflook toe en bak deze kort mee totdat ze glazig zijn.

4. Voeg het paprikapoeder, komijnpoeder, 
tomatenpuree en laurierblad toe en bak dit een minuutje mee zodat de smaken vrijkomen.

5. Voeg vervolgens de bruine bonen en het water toe. 
Breng het geheel aan de kook en laat het vervolgens op laag vuur ongeveer1,5 -2 uur sudderen, 
of totdat de bonen zacht zijn. Roer af en toe door en voeg meer water toe indien nodig.

6. Breng het gerecht op smaak met zout en peper.

7. Als je van rookworst houdt, kun je deze apart koken 
volgens de instructies op de verpakking en daarna in plakjes snijden. 
Voeg de plakjes rookworst toe aan de pan met bruine bonen en laat deze nog even mee verwarmen.

Serveer de bruine bonen met spek warm met bijvoorbeeld rijst, 
aardappelpuree of een stukje brood. Eet smakelijk!
</pre>
</textarea>













    <div class="container" id="container">
      <div class="header" id="header" title="Experimental ">
      	<center>
      	 Floating AI Code Assistant <button onclick="toggleVisibility('container')" style="float:right;margin-right:5px;"> X </button>
   
         </center>
      </div>
      <div class="mainbody">
      	
      	
      	    <div style="border :1px solid white;margin:10px;padding:10px;">
<center>
   <a href="https://platform.openai.com/account/api-keys" target="HEAVEN">API_KEY</a> : <input type="text" id="apikey" title="Enter or Paste your API_KEY Here?!"> 
   
    </center>
  

</div>

<div><center>
      <h3 class="">
        <!--Streaming OpenAI API Completions in JavaScript-->
        OpenAI Code Assistant
      </h3></center>
      <div id="resultContainer" class="" style="border :1px solid gray;margin:10px;padding:10px;">
        <!--<p class="">Generated Text</p>-->
        <p id="resultText" class="">Ai Reponse...</p>
      </div>
      <center>
      <input
        type="text"
        id="promptInput"
        class=""
        placeholder="Ask Question..."
      />
      <div class=""><div id="spinner"></div>
      <br>
        <button
          id="generateBtn"
          class=""
        >
          Generate
        </button>
        <button
          id="stopBtn"
          disabled
          class=""
        >
          Stop
        </button>
        </center>
      </div>
     <center>
       <br>
    <a href="https://ldijkman.github.io/Ace_Seventh_Heaven/Hell.html" target="hell">Heaven or Hell, That is the Question.</a><br>
</center>
    </div>
      	
      	
      
      <div class="footer"><center><font style="font-size:10px;">
 &copy;Dirk Luberth Dijkman Bangert 30 Andijk The Netherlands
 </font>
      </center></div>
    </div>

   
<!-- 
Copyright, Free to use if message is left in the code   
    original source https://github.com/gopinav/ai 
  this: 
     OpenAI Stream Chat, HTML WebPage
       https://plnkr.co/edit/KmmUTa3FNTQ6WLa7
       https://codepen.io/ldijkman/pen/gOqWwxw?editors=1010
       https://ldijkman.github.io/Ace_Seventh_Heaven/OpenAI_Stream_Chat.html
             https://github.com/ldijkman/Ace_Seventh_Heaven/tree/main/docs

Copyright, Free to use if this/above message is left in the code           
-->
    
    
    
    
    
    
    
    
    
<script>
  // https://stackoverflow.com/questions/8960193/how-to-make-html-element-resizable-using-pure-javascript
 var element = document.querySelector(".container")
makeResizable(element,10,10)


// wait for the page loaded, and make console draggable 
document.addEventListener("DOMContentLoaded",
function (event) {
    console.info("console.js, Running, Making it Draggable.");
    makeconsoledraggable(); // https://www.w3schools.com/howto/howto_js_draggable.asp

 var element = document.querySelector(".container")
makeResizable(element,10,10)

    console.info("Ok, You can Drag Me now!.");
    console.info("Resize, bottom right corner!.");
     console.debug('This Bug is RosyBrown');
});





function makeResizable(element, minW = 500, minH = 500, size = 10)
{
    const top = document.createElement('div');
    top.style.width = '100%';
    top.style.height = size + 'px';
    top.style.backgroundColor = 'transparent';
    top.style.position = 'absolute';
    top.style.top = - (size/2) + 'px';
    top.style.left = '0px';
    top.style.cursor = 'n-resize';

    top.addEventListener('mousedown',resizeYNegative())

    element.appendChild(top);

    const bottom = document.createElement('div');
    bottom.style.width = '100%';
    bottom.style.height = size + 'px';
    bottom.style.backgroundColor = 'transparent';
    bottom.style.position = 'absolute';
    bottom.style.bottom = - (size/2) + 'px';
    bottom.style.left = '0px';
    bottom.style.cursor = 'n-resize';

    bottom.addEventListener('mousedown',resizeYPositive())

    element.appendChild(bottom);

    const left = document.createElement('div');
    left.style.width = size + 'px';
    left.style.height = '100%';
    left.style.backgroundColor = 'transparent';
    left.style.position = 'absolute';
    left.style.top = '0px';
    left.style.left = - (size/2) + 'px';
    left.style.cursor = 'e-resize';

    left.addEventListener('mousedown',resizeXNegative())

    element.appendChild(left);

    const right = document.createElement('div');
    right.style.width = size + 'px';
    right.style.height = '100%';
    right.style.backgroundColor = 'transparent';
    right.style.position = 'absolute';
    right.style.top = '0px';
    right.style.right = - (size/2) + 'px';
    right.style.cursor = 'e-resize';

    right.addEventListener('mousedown',resizeXPositive())

    element.appendChild(right);


    const corner1 = document.createElement('div');
    corner1.style.width = size + 'px';
    corner1.style.height = size + 'px';
    corner1.style.backgroundColor = 'transparent';
    corner1.style.position = 'absolute';
    corner1.style.top = - (size/2) + 'px';
    corner1.style.left = - (size/2) + 'px';
    corner1.style.cursor = 'nw-resize';

    corner1.addEventListener('mousedown',resizeXNegative())
    corner1.addEventListener('mousedown',resizeYNegative())
    
    element.appendChild(corner1);

    const corner2 = document.createElement('div');
    corner2.style.width = size + 'px';
    corner2.style.height = size + 'px';
    corner2.style.backgroundColor = 'transparent';
    corner2.style.position = 'absolute';
    corner2.style.top = - (size/2) + 'px';
    corner2.style.right = - (size/2) + 'px';
    corner2.style.cursor = 'ne-resize';

    corner2.addEventListener('mousedown',resizeXPositive())
    corner2.addEventListener('mousedown',resizeYNegative())

    element.appendChild(corner2);

    const corner3 = document.createElement('div');
    corner3.style.width = size + 'px';
    corner3.style.height = size + 'px';
    corner3.style.backgroundColor = 'transparent';
    corner3.style.position = 'absolute';
    corner3.style.bottom = - (size/2) + 'px';
    corner3.style.left = - (size/2) + 'px';
    corner3.style.cursor = 'sw-resize';

    corner3.addEventListener('mousedown',resizeXNegative())
    corner3.addEventListener('mousedown',resizeYPositive())

    element.appendChild(corner3);

    const corner4 = document.createElement('div');
    corner4.style.width = size + 'px';
    corner4.style.height = size + 'px';
    corner4.style.backgroundColor = 'transparent';
    corner4.style.position = 'absolute';
    corner4.style.bottom = - (size/2) + 'px';
    corner4.style.right = - (size/2) + 'px';
    corner4.style.cursor = 'se-resize';

    corner4.addEventListener('mousedown',resizeXPositive())
    corner4.addEventListener('mousedown',resizeYPositive())

    element.appendChild(corner4);
    
    function get_int_style(key)
    {
        return parseInt(window.getComputedStyle(element).getPropertyValue(key));
    }

    function resizeXPositive()
    {
        let offsetX
        function dragMouseDown(e) {
            if(e.button !== 0) return
            e = e || window.event;
            e.preventDefault();
            const {clientX} = e;
            offsetX = clientX - element.offsetLeft - get_int_style('width');
            document.addEventListener('mouseup', closeDragElement)
            document.addEventListener('mousemove', elementDrag)
          }
        
          function elementDrag(e) {
                const {clientX} = e;
                let x = clientX - element.offsetLeft - offsetX
                if(x < minW) x = minW;
                element.style.width =  x + 'px';
          }
        
          function closeDragElement() {
            document.removeEventListener("mouseup", closeDragElement);  
            document.removeEventListener("mousemove", elementDrag);
          }
        return dragMouseDown
    }

    function resizeYPositive()
    {
        let offsetY
        function dragMouseDown(e) {
            if(e.button !== 0) return
            e = e || window.event;
            e.preventDefault();
            const {clientY} = e;
            offsetY = clientY - element.offsetTop - get_int_style('height');
    
            document.addEventListener('mouseup',closeDragElement)
            document.addEventListener('mousemove',elementDrag)
          }
        
          function elementDrag(e) {
                const {clientY} = e;
                let y =  clientY - element.offsetTop - offsetY;
                if(y < minH) y = minH;
                element.style.height = y + 'px';
          }
        
          function closeDragElement() {
            document.removeEventListener("mouseup", closeDragElement);  
            document.removeEventListener("mousemove", elementDrag);
          }
        return dragMouseDown
    }

    function resizeXNegative()
    {
        let offsetX
        let startX
        let startW
        let maxX
        function dragMouseDown(e) {
            if(e.button !== 0) return
            e = e || window.event;
            e.preventDefault();
            const {clientX} = e;
            startX = get_int_style('left')
            startW = get_int_style('width')
            offsetX = clientX - startX;
            maxX = startX + startW - minW
    
            document.addEventListener('mouseup',closeDragElement)
            document.addEventListener('mousemove',elementDrag)
          }
        
          function elementDrag(e) {
                const {clientX} = e;
                let x = clientX - offsetX
                let w = startW + startX - x
                if(w < minW) w = minW;
                if(x > maxX) x = maxX;
                element.style.left = x + 'px';
                element.style.width = w + 'px';
          }
        
          function closeDragElement() {
            document.removeEventListener("mouseup", closeDragElement);  
            document.removeEventListener("mousemove", elementDrag);
          }
        return dragMouseDown
    }

    function resizeYNegative()
    {
        let offsetY
        let startY
        let startH
        let maxY
        function dragMouseDown(e) {
            if(e.button !== 0) return
            e = e || window.event;
            e.preventDefault();
            const {clientY} = e;
            startY = get_int_style('top')
            startH = get_int_style('height')
            offsetY = clientY - startY;
            maxY = startY + startH - minH 
    
            document.addEventListener('mouseup',closeDragElement,false)
            document.addEventListener('mousemove',elementDrag,false)
          }
        
          function elementDrag(e) {
                const {clientY} = e;
                let y =  clientY - offsetY
                let h = startH + startY - y
                if(h < minH) h = minH;
                if(y > maxY) y = maxY;
                element.style.top = y + 'px';
                element.style.height = h + 'px';
          }
        
          function closeDragElement() {
            document.removeEventListener("mouseup", closeDragElement);  
            document.removeEventListener("mousemove", elementDrag);
          }
        return dragMouseDown
    }
}
// https://stackoverflow.com/questions/8960193/how-to-make-html-element-resizable-using-pure-javascript
  



// start drag https://www.w3schools.com/howto/howto_js_draggable.asp
function makeconsoledraggable() { 
  consolecontainer=document.getElementById("container");
    var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
//  if (document.getElementById(consolecontainer.id + "header"))
//  if present, the header is where you move the DIV from:
//     document.getElementById(consolecontainer.id + "header").onmousedown = dragMouseDown;
//   } else {
//   otherwise, move the DIV from anywhere inside the DIV:
    document.getElementById("header").onmousedown = consoledragmousedown;
   
 

  function consoledragmousedown(e) {
    e = e || window.event;
    e.preventDefault();
    // get the mouse cursor position at startup:
    pos3 = e.clientX;
    pos4 = e.clientY;
    document.onmouseup = closeconsoledrag;
    // call a function whenever the cursor moves:
    document.onmousemove = consoledrag;
  }

  function consoledrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    // set the element's new position:
    consolecontainer.style.top = (consolecontainer.offsetTop - pos2) + "px";
    consolecontainer.style.left = (consolecontainer.offsetLeft - pos1) + "px";
  }

  function closeconsoledrag() {
    /* stop moving when mouse button is released:*/
    document.onmouseup = null;
    document.onmousemove = null;
  }
}
// end drag https://www.w3schools.com/howto/howto_js_draggable.asp


 </script>



 <script>
/*
<!-- 
Copyright, Free to use if message is left in the code   
    original source https://github.com/gopinav/ai 
  this: 
     OpenAI Stream Chat, HTML WebPage
       https://plnkr.co/edit/KmmUTa3FNTQ6WLa7
       https://codepen.io/ldijkman/pen/gOqWwxw?editors=1010
       https://ldijkman.github.io/Ace_Seventh_Heaven/OpenAI_Stream_Chat.html
             https://github.com/ldijkman/Ace_Seventh_Heaven/tree/main/docs

Copyright, Free to use if this/above message is left in the code   
-->
*/
// Add your code here
/**
 * This code demonstrates how to use the OpenAI API to generate chat completions.
 * The generated completions are received as a stream of data from the API 
 * and the
 * code includes functionality to handle errors and abort requests using an AbortController.
 * The API_KEY variable needs to be updated 
 * with the appropriate value from OpenAI for successful API communication.
 */



const API_URL = "https://api.openai.com/v1/chat/completions";
var API_KEY = document.querySelector("#apikey").value;

const promptInput = document.getElementById("promptInput");
const generateBtn = document.getElementById("generateBtn");
const stopBtn = document.getElementById("stopBtn");
const resultText = document.getElementById("resultText");

    // Add an event listener to the input element for the "input" event.
    document.getElementById("apikey").addEventListener("input", function(event) {
      // This function will be called whenever the user types in the input field.
      API_KEY = document.getElementById("apikey").value;
      console.debug("API_KEY ", API_KEY)
    });


let controller = null; // Store the AbortController instance

const generate = async () => {
  const spinner = document.getElementById("spinner");
  spinner.style.display = "block";
  
  if (!promptInput.value) {
    alert("Please enter a prompt.");        // Alert the user if no prompt value
    return;
  }

  console.debug("ask tokens ",promptInput.value.length);

  // Disable the generate button and enable the stop button
  generateBtn.disabled = true;
  stopBtn.disabled = false;
  resultText.innerText += "\nOpenAI Generating...\n";

  // Create a new AbortController instance
  controller = new AbortController();
  const signal = controller.signal;

  try {
    // Fetch the response from the OpenAI API with the signal from AbortController
    const response = await fetch(API_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${API_KEY}`,
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: promptInput.value }],
        max_tokens: 4000,     // think 4000 chars for response leaves 96 for ask
        stream: true,         // For streaming responses
      }),
      signal,                 // Pass the signal to the fetch request
    });

    // Read the response as a stream of data
    const reader = response.body.getReader();
    const decoder = new TextDecoder("utf-8");
    //resultText.innerText = "";  //  i do not want to clear on each new question
console.time();
var message="";
    while (true) {
      const { done, value } = await reader.read();
      if (done) {
        break;
      }
      // Massage and parse the chunk of data
      const chunk = decoder.decode(value);
      const lines = chunk.split("\n");
      const parsedLines = lines
        .map((line) => line.replace(/^data: /, "").trim()) // Remove the "data: " prefix
        .filter((line) => line !== "" && line !== "[DONE]") // Remove empty lines and "[DONE]"
        .map((line) => JSON.parse(line)); // Parse the JSON string

      for (const parsedLine of parsedLines) {
        const { choices } = parsedLine;
        const { delta } = choices[0];
        const { content } = delta;
        // Update the UI with the new content
        if (content) {
          resultText.innerText += content;
          message+=content;
          console.info("Blah ",content); // https://youtu.be/mfJhMfOPWdE
        }
      }
    }
console.timeEnd();
console.debug("message tokens? ",message.length);//promptInput.value.length);

 
  } catch (error) {
    // Handle fetch request errors
    if (signal.aborted) {
      resultText.innerText += "\nRequest aborted.\n";
    } else {
      console.error("Error:", error);
      resultText.innerHTML += "<br><font style=\"color:red;\">Error, is your API_KEY valid ?</font><br>";
      console.error("Error, is your API_KEY valid ?");
     
    }
  } finally {
    // Enable the generate button and disable the stop button
    generateBtn.disabled = false;
    stopBtn.disabled = true;
    controller = null; // Reset the AbortController instance
  }
   spinner.style.display = "none";
};

const stop = () => {
  // Abort the fetch request by calling abort() on the AbortController instance
  if (controller) {
    controller.abort();
    controller = null;
  }
};

promptInput.addEventListener("keyup", (event) => {
  if (event.key === "Enter") {
    resultText.innerText +="\nYou: "+ promptInput.value+"\n";
    generate();
  }
});

generateBtn.addEventListener("click", (event)=>{
  resultText.innerText +="\nYou: "+ promptInput.value+"\n";
  generate();
});

stopBtn.addEventListener("click", stop);

/*
<!-- 
Copyright, Free to use if message is left in the code   
    original source https://github.com/gopinav/ai 
  this: 
     OpenAI Stream Chat, HTML WebPage
       https://plnkr.co/edit/KmmUTa3FNTQ6WLa7
       https://codepen.io/ldijkman/pen/gOqWwxw?editors=1010
       https://ldijkman.github.io/Ace_Seventh_Heaven/OpenAI_Stream_Chat.html
             https://github.com/ldijkman/Ace_Seventh_Heaven/tree/main/docs

Copyright, Free to use if this/above message is left in the code   
-->
*/
      </script>
    
    
<!-- 
Copyright, Free to use if message is left in the code   
    original source https://github.com/gopinav/ai 
  this: 
     OpenAI Stream Chat, HTML WebPage
       https://plnkr.co/edit/KmmUTa3FNTQ6WLa7
       https://codepen.io/ldijkman/pen/gOqWwxw?editors=1010
       https://ldijkman.github.io/Ace_Seventh_Heaven/OpenAI_Stream_Chat.html
             https://github.com/ldijkman/Ace_Seventh_Heaven/tree/main/docs

Copyright, Free to use if this/above message is left in the code           
-->
  <br><br>
  <iframe width="800" height="600" src="https://www.youtube.com/embed/l9wejBgCiT4" title="The Ladder (Soundcheck) - Prince" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
  </body>
</html>
