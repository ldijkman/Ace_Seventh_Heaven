<!--
       Heaven or Hell, That is the Question

i think the minimapeditor is now more like  (could be made) plugin like, in the editor
    // test maybe better for plugin alike code
    editor.container.insertAdjacentHTML("beforeend", "<div id=\"minimapeditor\" class=\"minimapeditor\" onmouseover=\'ace.edit(\"minimapeditor\").focus();\'></div>")

    there is no vertical scrollbar in visualstudio minimap
    but i think the vscroll in minimap makes the minimap better 
      i like to scroll minimap without editor scrolling
         not in vs monaco

???
   in visualstudio monaco 
      a search selection is not cleared by a mouse click on editor
   i need that
???

need a raspberry pi5 to replace my raspberry pi400
  need more speed
    Bought a IT-Gigant Lenovo i5 ThinkCentre 120SSD 80Euro 
      removed Windows, installed Linux Mint
        https://www.google.com/search?q=ITGigant+Lenovo+i5+ThinkCentre

Get Ace back in the Race
   Fund This Project   
       Http://paypal.me/LDijkman

-->

<!DOCTYPE html>
<html lang="en">
<script>
var warning = true;
window.onbeforeunload = function() {
  if (warning) {
    return "You have made changes on this page that you have not yet confirmed. If you navigate away from this page you will lose your unsaved changes";
    }
}
</script>

  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/ldijkman/randomnerd_esp32_wifi_manager/main/Electra.jpg">

<title>The AfterWorld, Editor with AI </title>

<head>
	<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.6">

<style type="text/css" media="screen">
body {
  color-scheme: dark;
  background-color: black;
  overscroll-behavior: none;
  overflow: hidden;
  width: 100%;
  height: 100%;
}

#editor {
  width: 80%;
  height: 100%;
  display: flex;
}


.ace_editor .ace_marker-layer .ace_selection {
  //background-color: orange;
  border:2px solid orange;
}

.ace_editor .ace_marker-layer .ace_selected-word {
  //background-color: orange;
  border:2px solid yellow;
}

#minimapeditor {                   /*minimap*/
  position: absolute;
  right: 32px;
  top: 0%;
  width: 125px;
  height: 100%;
  background-color: ;
  border: 1px solid gray;
  z-index:1000;
}

#minimapeditor .ace_scrollbar-h {   /*do not show horizontal scrollbar on minmap*/
  display: none;
}

.ace_scrollbar-h {               /*editor horizontal scrollbar*/
  width: 100%;
}

.ace_scroll-v {                   /*custom vertical scrollbar guide rail*/       
  z-index: 1000;
  position: absolute;
  top: 0;
  right: 1px;
  bottom: 10px;
  width: 30px;
  border: 1px solid gray;
}

.ace_thumb-v {
  background: lightgray;         /*draghandle custom vertical scrollbar*/
}

.ace_map-row {                  /*custom vertical scrollbar active cursor line*/
  z-index: 1001;
  position: absolute;
  pointer-events: none;
  top: 0;
  right: 1px;
  width: 30px;
  height: 2px;
  background: greenyellow;
}

.ace_map-item {                  /*custom vertical scrollbar list item blue line*/
  z-index: 1002;
  position: absolute;
  pointer-events: none;
  right: 6px;
  width: 20px;
  height: 1px;
  background: cornflowerblue;
}

.ace_link_marker {                  /*red underline when over url link in editore*/
  position: absolute;
  border-bottom: 5px solid red;
  opacity: 50%;
}

.ace_search.right {                      /*find search popup box*/
  position: absolute;
  border-radius: 8px 8px 8px 8px;
  border-right: 0 none;
  left: 5%;
  top: 2%;
  font-size: 15px; /*otherwise it scales with fontsize of editor inherit*/
  right: auto;
  cursor: move;
  color-scheme: dark;
  background-color: #444444;
  color: lightgray;
}

.ace_button {              /* change color search*/
  color: lightgray;
}

a:-webkit-any-link {              /* change color link in topmenu*/
  color: lightgray;
  cursor: pointer;
  text-decoration: underline;
}

.container {                      /*contains it all*/
  position: absolute;
  display: flex;
  top: 5%;
  width: 100%;
  height: 95%;
  border: 1px solid #cbd5e0;
}

.resizer {                    /*drag handle between left and right window*/
  background-color: #dba9b3;
  width: 5px;
  cursor: ew-resize;
}
.container__right {
  flex: 1;                    /* Take the remaining width */
  width: 100%;
  height: 100%;
  display: flex;
}

#preview {
  flex: 1;                    /* Take the remaining width */
  height: 100%;
  display: flex;
}

#preview iframe {             /*html preview iframe*/
  width: 100%;
  height: 100%;
  border: none;
  overflow: hidden;
}

#status {                     /*not visible*/
  position: absolute;
  padding: 0px 0;
  height: 55px;
  width: 100%;
 
}
.ace_scrollbar-v {      /*make minimap vertical scrollbar a bit less wide*/
  width: 6px;
}

.yellowborder {                            /*for dark themes*/
  position: absolute;
  bbackground-color: rgba(255,0,255,0.10) ;
  border: 2px solid yellow;
  z-index:100;
  display:block;
}

.purpleborder {                           /*for bright themes*/
  position: absolute;
  bbackground-color: rgba(255,0,255,0.10) ;
  border: 2px solid purple;
  z-index:100;
}

  .ace_editor .ace_marker-layer .ace_bracket {  /*better visible {} pair*/
  
   background: rgba(255,255,0,0.25);
   border: 1px solid greenyellow;
   //padding-left: 2px;padding-right: 2px;padding-top: 2px;padding-bottom: 2px;
   //border-collapse: 10px;
    
  }
  .ace_indent-guide{
  color:red; 
  background-color:red;
  width:2px;
  }

.brightness {
    background-color: white;
    display: inline-block;
   
}
.brightness img:hover {
    opacity: .5;
}

.ace_search_field {
    border-radius: 3px 0 0 3px;
    background-color: #eee;
    color: black;
    border: 1px solid #cbcbcb;
    border-right: 0 none;
    outline: 0;
    padding: 0;
    font-size: inherit;
    margin: 0;
    line-height: inherit;
    padding: 0 6px;
    min-width: 17em;
    vertical-align: top;
    min-height: 1.8em;
    box-sizing: content-box;
}

.ace_searchbtn.prev, .ace_searchbtn.next {
    padding: 0px 0.7em;
    background: #CCCCCC;
    color:black;
}
.ace_searchbtn:last-child {
    border-radius: 0 3px 3px 0;
    border-right: 1px solid #cbcbcb;
    background: #B0B0B0;
}
.ace_searchbtn.prev:after {
    content: "";
    border: solid 2px #888;
    width: 0.5em;
    height: 0.5em;
    border-width: 2px 0 0 2px;
    display: inline-block;
    transform: rotate(45deg);  /*rotate <*/
    color: black;
}
 .ace_searchbtn.next:after {
    content: "";
    border: solid 2px #888;
    width: 0.5em;
    height: 0.5em;
    border-width: 2px 0 0 2px;
    display: inline-block;
    transform: rotate(-135deg);  /*rotate >*/
    color: black;
}
#gearbutton{
  font-size:16px;
}
.errormarker {
  position: absolute;
  background-color: rgba(255,0,0,0.1);
  border: 1px solid red;
  z-index:3;
}
.warningmarker {
  position: absolute;
  background-color: rgba(255,255,0,0.75);
  border: 1px solid yellow;
  z-index:3;
}

/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/
.dropdown {
  position: relative;
  display: inline-block;
    noposition: absolute;
  nodisplay: block;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #666;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 11000;
  padding:5px;
  margin:-5px;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

.dropdown-content a:hover {background-color: #ddd;}

.dropdown:hover .dropdown-content {display: block;}

.dropdown:hover .dropbtn {background-color: #3e8e41;}


/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/
.dropdowntwo {
  position: relative;
  display: inline-block;
}

.dropdowntwo-content {
  display: none;
  position: absolute;
  background-color: #666;
  min-width: 160px;
  top:-20px;
  left:100px;
  border: 1px solid greenyellow;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 11000;
  padding:5px;  
  overflow-x: hidden;
  overflow-y: auto;
  margin:-5px;
}

.dropdowntwo-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;

}

.dropdowntwo-content a:hover {background-color: #ddd;}

.dropdowntwo:hover .dropdowntwo-content {display: block;}

.dropdowntwo:hover .dropbtntwo {background-color: #3e8e41;}




.select {
  position: absolute;
  top:12px;
  width:120px;
  z-index:100000;
}
.select :hover{
   width:250px;  
}
.select option{
   width:250px;  
}
.select optgroup{
   width:250px;
 }

}

</style>


 <style>
      .cont_ai_ner {
        position: fixed;
        display:float;
        min-height:90px;
        min-width:350px;
        background-color: #f1f1f1;
        border: 1px solid gray;
        left: 100px;
        top:  140px;
        width: 500px;
        height: 500px;
        border-radius: 5px;
        z-index:100000;
      }
      .cont_ai_ner,
      .AfterWorld,
      .Heaven,
      .Hell {
        padding: 0px; 
      }
      .AfterWorld {
        position:absolute;
        margin-top: 0;
        min-height:15px;
        nomax-height: 508px;
        width:100%;
        overflow: auto;
        top:25px;
        bottom:20px;
       
      }
      .Heaven {
        position:absolute;
        height: 25px;
        width:99%;
        border-bottom: 1px solid #eee;
        background-color: lightblue;
        -webkit-border-top-left-radius: 5px;
        -webkit-border-top-right-radius: 5px;
        -moz-border-radius-topleft: 5px;
        -moz-border-radius-topright: 5px;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
        margin:2px;
        cursor:move;
        border: 1px solid gray;
      }
      .Hell {
        position:absolute;
        height:20px;
        width:99.5%;
        background-color: lightgray;
        border-top: 1px solid #ddd;
        -webkit-border-bottom-left-radius: 5px;
        -webkit-border-bottom-right-radius: 5px;
        -moz-border-radius-bottomleft: 5px;
        -moz-border-radius-bottomright: 5px;
        border-bottom-left-radius: 5px;
        border-bottom-right-radius: 5px; 
        bottom:1px;
         border: 1px solid gray;
      }



#buttons {
  position: fixed;
  top: 30px;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: purple;
  padding: 8px;
}
    </style>

    <style>
    body{
      
      //background:lightgray;
     // margin:50px;

      
    }
    /* CSS for the spinner */
  #spinner {
    border: 4px solid #f3f3f3; /* Light gray border */
    border-top: 4px solid orange; /* Orange color for spinning */
    border-radius: 50%; /* Circular shape */
    width: 22px; /* Make the spinner smaller by adjusting width */
    height: 22px; /* Make the spinner smaller by adjusting height */
    animation: spin 2s linear infinite; /* Spin animation */
    display: none; /* Initially hidden */
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  </style>  

  <style>
.ddropbtn {
  position: relative;
}

.ddropdown {
  position: absolute;
  display: block;
}

.ddropdown-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  width: 200px;
  mmin-height: 260px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
  margin:-3px;  /*otherwise there is a gap, loose mouse focus */
}

.ddropdown-content a {
  color: black;
  nopadding: 12px 16px;
  text-decoration: none;
  display: block;
}

.ddropdown-content a:hover {background-color: #ddd;}

.ddropdown:hover .dropdown-content {display: block;}

.ddropdown:hover .dropbtn {background-color: #3e8e41;}


</style>

<!--
   <style>
   /*   console   */
   
   /*
   body {
      color-scheme: dark;
      background-color: black;
      overscroll-behavior: none;
      overflow: hidden;
      width: 100%;
      height: 100%;
      color: lightgray;
    }
*/
    /* Make the whole thing smaller with transform: scale(70%) */
    #console-log-div {
      min-height: 55px;
      max-height: 200px;
      width: 600px;
      top: 200px;
      left:100px;
      margin: 1px;
      padding: 1px 0 0 0;
      font-family: "Input Mono", monospace;
      font-weight: 400;
      font-size: 0.8em;
      line-height: 1em;
      color: rgba(0, 0, 0, .61);
      box-shadow: inset 0 0 2px rgba(0, 0, 0, .1);
      background-color: #ebebeb;
      overflow: auto;
      overscroll-behavior-y: auto;
      transform: scale(100%);
      z-index:50000;

    }

    #console-log-div #legend,
    #console-log-div .log-row,
    #console-log-div td {
      padding: 1px 0 8px 0;
      text-indent: 1px;
       z-index:50000;
    }

    #console-log-div #legend {
      padding-bottom: 12px;
      font-size: 1.2em;
      cursor: move;
       z-index:50000;
    }

    #console-log-div .log-row:nth-child(odd) {
      background: rgba(0, 0, 0, .1);
       z-index:50000;
    }

    #console-log-div thead {
      background: rgba(0, 0, 0, .2);
    }

    </style>
    -->
<link rel="stylesheet" href="https://ldijkman.github.io/Ace_Seventh_Heaven/console.css">

  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
      

<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.9/beautify.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.9/beautify-css.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.9/beautify-html.js"></script>

<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">

<style>
.ui-tooltip {
	padding: 8px;
	position: absolute;
	z-index: 100000;
	max-width: 300px;
  pointer-events:none;
  box-shadow:none;
}

</style>
<script>
   
   //https://phuoc.ng/collection/html-dom/create-resizable-split-views/
document.addEventListener('DOMContentLoaded', function () {
    // Query the element
    const resizer = document.getElementById('dragMe');
    const leftSide = resizer.previousElementSibling;
    const rightSide = resizer.nextElementSibling;

    // The current position of mouse
    let x = 0;
    let y = 0;
    let leftWidth = 0;

    // Handle the mousedown event
    // that's triggered when user drags the resizer
    const mouseDownHandler = function (e) {
        // Get the current mouse position
        x = e.clientX;
        y = e.clientY;
        leftWidth = leftSide.getBoundingClientRect().width;

        // Attach the listeners to document
        document.addEventListener('mousemove', mouseMoveHandler);
        document.addEventListener('mouseup', mouseUpHandler);
    };

    const mouseMoveHandler = function (e) {
        // How far the mouse has been moved
        const dx = e.clientX - x;
        const dy = e.clientY - y;

        const newLeftWidth = ((leftWidth + dx) * 100) / resizer.parentNode.getBoundingClientRect().width;
        leftSide.style.width = newLeftWidth + '%';

        resizer.style.cursor = 'col-resize';
        document.body.style.cursor = 'col-resize';

        leftSide.style.userSelect = 'none';
        leftSide.style.pointerEvents = 'none';

        rightSide.style.userSelect = 'none';
        rightSide.style.pointerEvents = 'none';
    };

    const mouseUpHandler = function () {
        resizer.style.removeProperty('cursor');
        document.body.style.removeProperty('cursor');

        leftSide.style.removeProperty('user-select');
        leftSide.style.removeProperty('pointer-events');

        rightSide.style.removeProperty('user-select');
        rightSide.style.removeProperty('pointer-events');

        // Remove the handlers of mousemove and mouseup
        document.removeEventListener('mousemove', mouseMoveHandler);
        document.removeEventListener('mouseup', mouseUpHandler);
    };

    // Attach the handler
    resizer.addEventListener('mousedown', mouseDownHandler);
});
   
   
var backup="";
 var tooltipval=1;
   
  </script>
<!--<script type="text/javascript" src="scrollbar.js"></script>
 <link rel="stylesheet" href="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/Ace_color/ext-scrollbar.css" />
-->
<script type="text/javascript" src="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/Ace_color/ext-scrollbar.js"></script>



</head>

<body>

 <!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->
 <div class="dropdown">
  <button class="dropbtn" onmouseover="this.focus()">File</button>
  <div class="dropdown-content">
    <input type="button" class="dropbt" onclick="document.getElementById('openbton').click()" value="Open File" onmouseover="this.focus()">
                         <!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->
              <div class="dropdowntwo">
              <button class="dropbtntwo" title="oes not always work CORS policy" onmouseover="this.focus()" >Open File From URL </button>
                <div class="dropdowntwo-content" style="left:140px;top:-15px;width:300px;padding:20px;">
                       <input type="text" class="dropbttwo" id="urlinput" onclick='' style="width:300px;" title="does not always work CORS policy" value="//run.plnkr.co/plunks/TMDzQALQgACruCYz/" onmouseover="this.focus()" list="nope_url"><br>
                         <datalist id="url">
                           <option value="https://run.plnkr.co/plunks/TMDzQALQgACruCYz/">
                            <option value="https://run.plnkr.co/plunks/5m0Aa8vqmntFDekn/">
                            <option value="https://raw.githubusercontent.com/ldijkman/Ace_Seventh_Heaven/main/docs/Hell.html">
                            <option value="empty">
                          </datalist>
                    
                    <center><br>
                      <input type="button" class="dropbttwo" onclick="download_to_textbox(urlinput.value);Update_HTML_Preview();" style="border: 1px solid white;" title="does not always work CORS policy" value="open from URL" onmouseover="this.focus()">
                      </center>
                  </div>
              </div>
              <!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->
     <input type="button" class="dropbt" onclick='save()' style="" onmouseover="this.focus()" value="Save by DownLoad"  onmouseover="this.focus()">
    <input type="button" class="savebutton dropbt" type="button" style="" title="if Framed DownLoad&#013;if FullScreen maybe Save to Disk" onmouseover="this.focus()" value="Save to Disk?">
 </div>
</div>
<!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->




<input
        type="file"
        id="openbton"
        onchange="openCode(this.files)"
        value="Open PC"
        style="background-color:lightgray;color:black;font-weight: bold;"
        title="For PC load a file from Disk"
        hidden
      />
<input class="text" value="7th_Heaven.html" size="15" title="FileName" onmouseover="this.focus()">

  <button onclick='ace.edit("editor").setFontSize(parseInt(ace.edit("editor").getFontSize())-1);document.getElementById("fontSize").value=editor.getFontSize()' title="FontSize -" onmouseover="this.focus()">-</button>
  <input type="number" id="fontSize" style="width: 2.2em;" value='20' oninput='ace.edit("editor").setFontSize(parseInt(this.value))'  title="FontSize" onmouseover="this.focus()">
  <button onclick='ace.edit("editor").setFontSize(parseInt(ace.edit("editor").getFontSize())+1);document.getElementById("fontSize").value=editor.getFontSize()' title="FontSize +" onmouseover="this.focus()">+</button>

  <select id="ace-mode" style="width: 75px;" title="select editor file type mode" onmouseover="this.focus()">
    <option value="css">CSS</option>
    <option value="html" selected>HTML</option>
    <option value="javascript">JavaScript</option>
    <option value="json">JSON</option>
    <option value="text">Text</option>
    <option value="c_cpp">C and C++</option>
  </select>

<select id="ace-theme"  class="select" size="1" style="width: 100px;" title="select a theme colorscheme" onMouseOver='this.focus();this.size="43";this.style.width="175px";this.style.top="+35px";' onMouseout='this.size="1";this.style.width="";this.style.top="";' >
<optgroup class="optgroup" label="Bright" id="sel">
  <option value="ace/theme/chrome">Chrome</option>
  <option value="ace/theme/clouds">Clouds</option>
  <option value="ace/theme/crimson_editor">Crimson Editor</option>
  <option value="ace/theme/dawn">Dawn</option>
  <option value="ace/theme/dreamweaver">Dreamweaver</option>
  <option value="ace/theme/eclipse">Eclipse</option>
  <option value="ace/theme/github">GitHub</option>
  <option value="ace/theme/iplastic">IPlastic</option>
  <option value="ace/theme/solarized_light">Solarized Light</option>
  <option value="ace/theme/textmate">TextMate</option>
  <option value="ace/theme/tomorrow">Tomorrow</option>
  <option value="ace/theme/xcode">XCode</option>
  <option value="ace/theme/kuroir">Kuroir</option>
  <option value="ace/theme/katzenmilch">KatzenMilch</option>
  <option value="ace/theme/sqlserver">SQL Server</option>
</optgroup>
<optgroup label="Dark" style="min-width: 250px;">
  <option value="ace/theme/ambiance">Ambiance</option>
  <option value="ace/theme/chaos">Chaos</option>
  <option value="ace/theme/clouds_midnight">Clouds Midnight</option>
  <option value="ace/theme/dracula">Dracula</option>
  <option value="ace/theme/cobalt">Cobalt</option>
  <option value="ace/theme/gruvbox">Gruvbox</option>
  <option value="ace/theme/gob">Green on Black</option>
  <option value="ace/theme/idle_fingers">idle Fingers</option>
  <option value="ace/theme/kr_theme">krTheme</option>
  <option value="ace/theme/merbivore">Merbivore</option>
  <option value="ace/theme/merbivore_soft">Merbivore Soft</option>
  <option value="ace/theme/mono_industrial">Mono Industrial</option>
  <option value="ace/theme/monokai">Monokai</option>
  <option value="ace/theme/nord_dark">Nord Dark</option>
  <option value="ace/theme/one_dark">One Dark</option>
  <option value="ace/theme/pastel_on_dark">Pastel on dark</option>
  <option value="ace/theme/solarized_dark">Solarized Dark</option>
  <option value="ace/theme/terminal">Terminal</option>
  <option value="ace/theme/tomorrow_night">Tomorrow Night</option>
  <option value="ace/theme/tomorrow_night_blue">Tomorrow Night Blue</option>
  <option value="ace/theme/tomorrow_night_bright">Tomorrow Night Bright</option>
  <option value="ace/theme/tomorrow_night_eighties">Tomorrow Night 80s</option>
  <option value="ace/theme/twilight">Twilight</option>
  <option value="ace/theme/vibrant_ink" selected>Vibrant Ink</option>
  <option value="ace/theme/github_dark">GitHub Dark</option>
</optgroup>
</select>
    &nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;&nbsp;&nbsp;&nbsp;
<button onclick='ace.edit("minimapeditor").setFontSize(parseFloat(ace.edit("minimapeditor").getFontSize())-.1);document.getElementById("minimapfontSize").value=minimapeditor.getFontSize()' title="MiniMap FontSize -" onmouseover="this.focus()">-</button>
<input type="number" id="minimapfontSize" style="width: 2.2em;" value='3' step="0.1" oninput='ace.edit("minimapeditor").setFontSize(parseFloat(this.value))'  title="MiniMap FontSize" onmouseover="this.focus()">
<button onclick='ace.edit("minimapeditor").setFontSize(parseFloat(ace.edit("minimapeditor").getFontSize())+.1);document.getElementById("minimapfontSize").value=minimapeditor.getFontSize()' title="MiniMap FontSize +" onmouseover="this.focus()">+</button>


<!--
///////////////////////////
// menu button Edit
/////////////////////////// 
-->
  <!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->
 <div class="dropdown">
  <button class="dropbtn" onmouseover="this.focus()">Edit</button>
  <div class="dropdown-content" style="width:200px;padding:5px;">
   <input type="button" class="dropbt" id="" onclick="" title="Warning Maybe no UnDo on next buttons &#013; use ctrl+a, ctrl+c &#013; to save a copy to yuor clipboard"  style="color:yellow" onmouseover="this.focus()" value="Warning Maybe no UnDo">
   <br>
              <!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->
              <div class="dropdowntwo">
              <button class="dropbtntwo" title="Test sub menu 1?" onmouseover="this.focus()" >make a backup copy </button>
                <div class="dropdowntwo-content" style="top:5px;">
                    <input type="button" class="dropbttwo" onclick="backup=editor.getValue();" style="" title="copy text" value="save content" onmouseover="this.focus()"><br>
                    <input type="button" class="dropbttwo" onclick='if(backup!=""){editor.setValue(backup);}' style="" title="restore backup" value="restore content"  onmouseover="this.focus()"><br>
                </div>
              </div>
              <!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->

    <input type="button" class="dropbt" onclick="convertspacestotab();" id="" value="Convert Spaces to Tabs" onmouseover="this.focus()" 
    title="Convert Spaces to Tabs &#013;  number of space to tabs&#013;  is taken from menu option tab size&#013;&#013;see the dots change to lines on invisibles&#013;Note: menu option Atomic Soft Tabs makes spaces from tabs key&#013; https://www.browserling.com/tools"> 
<script>    
  function convertspacestotab(){
      // next from https://www.browserling.com/tools/spaces-to-tabs
      //       $(function(){mkTool("spaces-to-tabs",function(t){var a=$("#spaces-to-tabs-count").val(),e=new RegExp(" {"+a+"}","g");return t.replace(e,"	")})});
      var text=editor.getValue();                               // get editor text
      var a = tabinput.value;                                   // menu option input number tabsize
      // this gets atomic when atomic is checked ;-)
      e = new RegExp(" {" + a + "}", "g");                      // https://www.browserling.com/tools
      var textt= text.replace(e, "	");
      editor.getSession().setValue(textt);                      // set editor text now tabs invisibles
      minimapeditor.setValue(editor.getSession().getValue());   // set minimap text
  }
 </script>  

    <input type="button" class="dropbt" onclick="converttabstospaces();" id="" value="Convert Tabs to Spaces" onmouseover="this.focus()" 
    title="Convert Tabs to Spaces &#013;  number of space from tabs&#013;  is taken from menu option tab size&#013;&#013;see the tab lines change to dots on invisible&#013;Note: menu option Atomic Soft Tabs makes spaces from tabs keys&#013; https://www.browserling.com/tools"> 
<script>    
  function converttabstospaces(){
      // next from https://www.browserling.com/tools/spaces-to-tabs
      //      $(function(){mkTool("tabs-to-spaces",function(o){for(var c=$("#tabs-to-spaces-count").val(),a="",t=1;t<=c;t++)a+=" ";return o.replace(/\t/g,a)})});
      var text=editor.getValue();                               // get editor text                                
      for (var c = tabinput.value, a = "", t = 1; t <= c; t++)a += " ";// c= menu options input number tabsize https://www.browserling.com/tools
      var textt= text.replace(/\t/g, a);
      editor.getSession().setValue(textt);                      // set editor text now dots invisibles
      minimapeditor.setValue(editor.getSession().getValue());   // set minimap text
  }
 </script>   


     <input type="button" class="dropbt" onclick="removetail();" id="" value="Remove Tail" onmouseover="this.focus()" 
    title="Remove Tail  &#013; Remove spaces and tabs from end of line&#013;"> 
    <br>
<script>    
  function removetail(){
      // get max lines of file
      //   console.log("editor.session.getLength()",editor.session.getLength());
      // https://stackoverflow.com/questions/24695377/replace-content-of-the-line-in-ace-editor-and-overwrite-it
     var r = "";
     var t="";
     var temp = "";
     let n=editor.session.getLength();
     var Range = require("ace/range").Range
     // for (let i = 0; i < n; i++){
     //     t=editor.session.getLine(i);
     //     r=t.trimEnd();
     //     editor.session.replace(new Range(i,0,i,Number.MAX_VALUE),r);
     // }  
//same for loop as above but now minimized for speed?
for(i=0;i<n;i++)r=(t=editor.session.getLine(i)).trimEnd(),editor.session.replace(new Range(i,0,i,Number.MAX_VALUE),r);     
 
      //editor.getSession().setValue(result);                    // set editor text 
      minimapeditor.setValue(editor.getSession().getValue());   // set minimap text
  }
 </script>  

      <input type="button" class="dropbt" onclick="removelead();" id="" value="Remove Leading" onmouseover="this.focus()" 
    title="Remove Lead  &#013; Remove spaces and tabs from begin of line&#013;"> 
    <br>
<script>    
  function removelead(){
      // get max lines of file
      //   console.log("editor.session.getLength()",editor.session.getLength());
      // https://stackoverflow.com/questions/24695377/replace-content-of-the-line-in-ace-editor-and-overwrite-it
     var r = "";
     var t="";
     var temp = "";
     let n=editor.session.getLength();
     var Range = require("ace/range").Range
     // for (let i = 0; i < n; i++){
     //     t=editor.session.getLine(i);
     //     r=t.trimEnd();
     //     editor.session.replace(new Range(i,0,i,Number.MAX_VALUE),r);
     // }  
//same for loop as above but now minimized for speed?
for(i=0;i<n;i++)r=(t=editor.session.getLine(i)).trimStart(),editor.session.replace(new Range(i,0,i,Number.MAX_VALUE),r);     
 
      //editor.getSession().setValue(result);                    // set editor text 
      minimapeditor.setValue(editor.getSession().getValue());   // set minimap text
  }
 </script>  


      <input type="button" class="dropbt" onclick="removeempty();" id="" value="Remove empty lines" onmouseover="this.focus()" 
    title="Remove Empty  &#013; Remove empty lines &#013;"> 
    <br>
<script>    
  function removeempty(){
      var text = editor.getSession().getValue();
      // https://stackoverflow.com/questions/16369642/javascript-how-to-use-a-regular-expression-to-remove-blank-lines-from-a-string
      // text.replace(/^(?=\n)$|^\s*|\s*$|\n\n+/gm, ""); // this removes also leading and tailing
      text=text.replace(/(\r?\n)\s*\1+/g, '$1');
      editor.getSession().setValue(text);  
      
      
      play();
  }
 </script> 


   <input type="button" class="dropbt" id="" onclick="" title="" style="" onmouseover="this.focus()" value="-----">
   <br>
    <input type="button" class="dropbt" onclick="pretty()" id="" value="Beautify / Prettify" onmouseover="this.focus()"
    title="Beautify / Prettify&#013;  Format HTML Code&#013;&#013;Sorry NO UnDo&#013&#013;https://github.com/beautify-web/js-beautify&#013;https://beautifier.io/&#013;   make an options menu?">
 <script>
   function pretty(){
       var text=editor.getValue();
       // ace beautify does not work nice
       // use another
       // https://github.com/beautify-web/js-beautify
       // https://beautifier.io/
       var pretty=html_beautify(text,{
  "indent_size": "2",
  "indent_char": " ",
  "max_preserve_newlines": "5",
  "preserve_newlines": true,
  "keep_array_indentation": false,
  "break_chained_methods": false,
  "indent_scripts": "keep",
  "brace_style": "collapse",
  "space_before_conditional": true,
  "unescape_strings": false,
  "jslint_happy": true,
  "end_with_newline": true,
  "wrap_line_length": "0",
  "indent_inner_html": true,
  "comma_first": false,
  "e4x": false,
  "indent_empty_lines": false
});
       editor.getSession().setValue(pretty);                      // set editor 
       minimapeditor.setValue(editor.getSession().getValue());   // set minimap text
   }
   </script>

                <!-- start submenu /*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->
              <div class="dropdowntwo">
              <button class="dropbtntwo" title="Beautify Options" onmouseover="this.focus()">Options</button>
                <div class="dropdowntwo-content" style="left:50px;max-width:400px;width:400px;margin:10px;padding:10px;">
                  
<font color="lightgray">

          <select name="tabsize" id="tabsize">
            <option value="1">Indent with a tab character</option>
            <option value="2">Indent with 2 spaces</option>
            <option value="3">Indent with 3 spaces</option>
            <option value="4">Indent with 4 spaces</option>
            <option value="8">Indent with 8 spaces</option>
          </select>
          <select name="max-preserve-newlines" id="max-preserve-newlines">
            <option value="-1">Remove all extra newlines</option>
            <option value="1">Allow 1 newline between tokens</option>
            <option value="2">Allow 2 newlines between tokens</option>
            <option value="5">Allow 5 newlines between tokens</option>
            <option value="10">Allow 10 newlines between tokens</option>
            <option value="0">Allow unlimited newlines between tokens</option>
          </select>
          <select name="wrap-line-length" id="wrap-line-length">
            <option value="0">Do not wrap lines</option>
            <option value="40">Wrap lines near 40 characters</option>
            <option value="70">Wrap lines near 70 characters</option>
            <option value="80">Wrap lines near 80 characters</option>
            <option value="110">Wrap lines near 110 characters</option>
            <option value="120">Wrap lines near 120 characters</option>
            <option value="160">Wrap lines near 160 characters</option>
          </select>
          <select id="brace-style">
            <option value="collapse">Braces with control statement</option>
            <option value="expand">Braces on own line</option>
            <option value="end-expand">End braces on own line</option>
            <option value="none">Attempt to keep braces where they are</option>
          </select>
        
            <p style="margin:6px 0 0 0">HTML &lt;style&gt;, &lt;script&gt; formatting:</p>
            <select id="indent-scripts">
              <option value="keep">Keep indent level of the tag</option>
              <option value="normal">Add one indent level</option>
              <option value="separate">Separate indentation</option>
            </select>
        
<br><br>

<!--
                    <input type="checkbox"><input type="button" class="dropbttwo" onclick="" style="" title="" value="End script and style with newline?" onmouseover="this.focus()"><br>
                    <input type="checkbox"><input type="button" class="dropbttwo" onclick='' style="" title="" value="Support e4x/jsx syntax"  onmouseover="this.focus()"><br>
                    <input type="checkbox"><input type="button" class="dropbttwo" onclick='' style="" title="" value="Use comma-first list style?" onmouseover="this.focus()"><br>
                    <input type="checkbox"><input type="button" class="dropbttwo" onclick='' style="" title="" value="Detect packers and obfuscators?" onmouseover="this.focus()"><br>
                    <input type="checkbox"><input type="button" class="dropbttwo" onclick='' style="" title="" value="Preserve inline braces/code blocks?" onmouseover="this.focus()"><br>
                    <input type="checkbox"><input type="button" class="dropbttwo" onclick='' style="" title="" value="Keep array indentation?" onmouseover="this.focus()"><br>
                    <input type="checkbox"><input type="button" class="dropbttwo" onclick='' style="" title="" value="Break lines on chained methods?" onmouseover="this.focus()"><br>
                    <input type="checkbox"><input type="button" class="dropbttwo" onclick='' style="" title="" value='Space before conditional: "if(x)" / "if (x)"' onmouseover="this.focus()"><br>
                    <input type="checkbox"><input type="button" class="dropbttwo" onclick='' style="" title="" value="Unescape printable chars encoded as \xNN or \uNNNN?" onmouseover="this.focus()"><br>
                    <input type="checkbox"><input type="button" class="dropbttwo" onclick='' style="" title="" value="Use JSLint-happy formatting tweaks?" onmouseover="this.focus()"><br>
                    <input type="checkbox"><input type="button" class="dropbttwo" onclick='' style="" title="" value="Indent <head> and <body> sections?" onmouseover="this.focus()"><br>
                    <input type="checkbox"><input type="button" class="dropbttwo" onclick='' style="" title="" value="Keep indentation on empty lines?" onmouseover="this.focus()"><br>                
 -->
           <input class="checkbox" type="checkbox" id="end-with-newline">
          <label for="end-with-newline" onmouseover="" title="Title Test">End script and style with newline?</label>
          <br>
          <input class="checkbox" type="checkbox" id="e4x">
          <label for="e4x" title="Title Test">Support e4x/jsx syntax</label>
          <br>
          <input class="checkbox" type="checkbox" id="comma-first">
          <label for="comma-first" title="Title Test">Use comma-first list style?</label>
          <br>
          <input class="checkbox" type="checkbox" id="detect-packers">
          <label for="detect-packers" title="Title Test">Detect packers and obfuscators?</label>
          <br>
          <input class="checkbox" type="checkbox" id="brace-preserve-inline">
          <label for="brace-preserve-inline" title="Title Test">Preserve inline braces/code blocks?</label>
          <br>
          <input class="checkbox" type="checkbox" id="keep-array-indentation">
          <label for="keep-array-indentation" title="Title Test">Keep array indentation?</label>
          <br>
          <input class="checkbox" type="checkbox" id="break-chained-methods">
          <label for="break-chained-methods" title="Title Test">Break lines on chained methods?</label>
          <br>
          <input class="checkbox" type="checkbox" id="space-before-conditional">
          <label for="space-before-conditional" title="Title Test">Space before conditional: "if(x)" / "if (x)"</label>
          <br>
          <input class="checkbox" type="checkbox" id="unescape-strings">
          <label for="unescape-strings" title="Title Test">Unescape printable chars encoded as \xNN or \uNNNN?</label>
          <br>
          <input class="checkbox" type="checkbox" id="jslint-happy">
          <label for="jslint-happy" title="Title Test">Use JSLint-happy formatting tweaks?</label>
          <br>
          <input class="checkbox" type="checkbox" id="indent-inner-html">
          <label for="indent-inner-html" title="Title Test">Indent &lt;head&gt; and &lt;body&gt; sections?</label>
          <br>
          <input class="checkbox" type="checkbox" id="indent-empty-lines">
          <label for="indent-empty-lines" title="Title Test">Keep indentation on empty lines?</label>
         
                    <a href="https://beautifier.io/?without-codemirror" target="beauty">https://beautifier.io/?without-codemirror
              </font>
              <center><img src="https://beautifier.io/web/banner-light.svg"></center>
               </a>  </div>
              </div>
              <!--  end submenu /*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->



<br>
   <input type="button" class="dropbt" id="" onclick="" title="" style="" onmouseover="this.focus()" value="-----">
   
<br>
              <!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->
              <div class="dropdowntwo">
              <button class="dropbtntwo" title="Test sub menu 1?" onmouseover="this.focus()">Test sub menu 1? </button>
                <div class="dropdowntwo-content">
                    <input type="button" class="dropbttwo" onclick="" style="" title="--- 1 test sub menu 1 ---" value="--- 1 test sub menu 1 ---" onmouseover="this.focus()"><br>
                    <input type="button" class="dropbttwo" onclick='' style="" title="--- 1 test sub menu 2 ---" value="--- 1 test sub menu 2 ---"  onmouseover="this.focus()"><br>
                    <input type="button" class="dropbttwo" onclick='' style="" title="--- 1 test sub menu 3 ---" value="--- 1 test sub menu 3 ---" onmouseover="this.focus()"><br>
                </div>
              </div>
              <!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->


   <br>
                 <!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->
              <div class="dropdowntwo">
              <button class="dropbtntwo" title="Test sub menu 2?" onmouseover="this.focus()">Test sub menu 2? </button>
                <div class="dropdowntwo-content">
                    <input type="button" class="dropbttwo" onclick="" style="" title="--- 2 test sub menu 1 ---" value="--- 2 test sub menu 1 ---" onmouseover="this.focus()"><br>
                    <input type="button" class="dropbttwo" onclick='' style="" title="--- 2 test sub menu 2 ---" value="--- 2 test sub menu 2 ---"  onmouseover="this.focus()"><br>
                    <input type="button" class="dropbttwo" onclick='' style="" title="--- 2 test sub menu 3 ---" value="--- 2 test sub menu 3 ---" onmouseover="this.focus()"><br>
                    <input type="button" class="dropbttwo" onclick='' style="" title="--- 2 test sub menu 4 ---" value="--- 2 test sub menu 4 ---" onmouseover="this.focus()"><br>
                    <input type="button" class="dropbttwo" onclick='' style="" title="--- 2 test sub menu 5 ---" value="--- 2 test sub menu 5 ---" onmouseover="this.focus()"><br>
                </div>
              </div>
              <!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->


   <br>
   <input type="button" class="dropbt" id="" onclick="" title="" style="" onmouseover="this.focus()" value="-----">
   <br>
    <input type="button" class="dropbt" id="" onclick="" title="" style="" onmouseover="this.focus()" value="- not yet!-">
   <br>
    <input type="button" class="dropbt" id="" onclick="terserall();" title="Yep thats minify ;-) &#013; Warned you &#013; Terser? &#013; https://terser.org/ &#013; https://github.com/terser/terser" style="" onmouseover="this.focus()" value="Minify / Uglify">
    
<!--
<script src="https://cdn.jsdelivr.net/npm/source-map@0.7.3/dist/source-map.js"></script>
<script src="https://cdn.jsdelivr.net/npm/terser/dist/bundle.min.js"></script>
-->
<script defer="defer" src="https://extendsclass.com/lib/terser/dist/bundle.min.js"></script>

    
    <script>
      function terserall(){
        play();
        var text=editor.getValue();
       var code = text;
        var result = Terser.minify(code);
  // var result = await minify(code, {sourceMap: true}); // this breaks the function tersersall , minify not found, await maybe problem
         console.log(result.code);  // minified output: function add(n,d){return n+d}
        console.log(result.map);  // source map
      editor.getSession().setValue(result.code);                      // set editor text now dots invisibles
      minimapeditor.setValue(editor.getSession().getValue());   // set minimap text
      }
</script>
                <!-- start submenu /*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->
              <div class="dropdowntwo">
              <button class="dropbtntwo" title="Terser Uglification Options" onmouseover="this.focus()">Options</button>
                <div class="dropdowntwo-content" style="top:-300px;left:50px;max-width:400px;width:400px;margin:10px;padding:10px;">
                  
<font color="lightgray">

  <div class="options">
    <form class="mr-1">

    <input type="checkbox" :id="option.id" x-model="option.checked" id="caseSensitive" value="">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="caseSensitive" class="" 
    title="Treat attributes in case sensitive manner (useful for custom HTML tags)">
    Case-sensitive</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="collapseBooleanAttributes">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="collapseBooleanAttributes" class="" 
    title="Omit attribute values from boolean attributes">
    Collapse boolean attributes</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="collapseInlineTagWhitespace" value="">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="collapseInlineTagWhitespace" class="unsafe" 
    title="Don't leave any spaces between <code>display:inline;</code> elements when collapsing. Must be used in conjunction with <code>collapseWhitespace=true">
      Collapse inline tag whitespace</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="collapseWhitespace">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="collapseWhitespace" class="" 
    title='Collapse white space that contributes to text nodes in a document tree'>
    Collapse whitespace</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="conservativeCollapse" value="">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="conservativeCollapse" class="" 
    title='conservativeCollapse'>
    conservativeCollapse</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="decodeEntities">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="decodeEntities" class="" 
    title='Use direct Unicode characters whenever possible'>
    Decode Entity Characters</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="html5">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="html5" class="" 
    title='Parse input according to HTML5 specifications'>
    HTML5</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="includeAutoGeneratedTags" value="">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="includeAutoGeneratedTags" class="" 
    title='Insert tags generated by HTML parser'>
    Include auto-generated tags</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="keepClosingSlash" value="">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="keepClosingSlash" class="" 
    title='Keep the trailing slash on singleton elements'>
    Keep closing slash</label><br>

    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="maxLineLength" class="" 
    title="Specify a maximum line length. Compressed output will be split by newlines at valid HTML split-points">
    Max. line length</label>
    <input type="number" :id="option.id" x-model="option.value" id="maxLineLength"><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="minifyCSS">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="minifyCSS" class="" 
    title="Minify CSS in style elements and style attributes (uses <code>clean-css</code>)">
    Minify CSS</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="minifyJS">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="minifyJS" class="" 
    title="Minify JavaScript in script elements and event attributes (uses <code>Terser</code>)">
    Minify JavaScript</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="minifyURLs" value="">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="minifyURLs" class="" 
    title='Minify URLs in various attributes (uses <code>relateurl</code>)'>
    Minify URLs</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="noNewlinesBeforeTagClose" value="">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="noNewlinesBeforeTagClose" class="" 
    title='Never add a newline before a tag that closes an element'>
    No newline before Tag Close</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="preserveLineBreaks" value="">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="preserveLineBreaks" class="" 
    title="Always collapse to 1 line break (never remove it entirely) when whitespace between tags include a line break. Must be used in conjunction with <code>collapseWhitespace=true</code>">
    Preserve line-breaks</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="preventAttributesEscaping" value="">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="preventAttributesEscaping" class="unsafe" 
    title='Prevents the escaping of the values of attributes'>
    Prevent attributes escaping</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="processConditionalComments">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="processConditionalComments" class="" 
    title='Process contents of conditional comments through minifier'>
    Process conditional comments</label><br>

    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="processScripts" class="" 
    title='Comma-delimited string corresponding to types of script elements to process through minifier (e.g. <code>text/ng-template, text/x-handlebars-template</code>)'>
    Process scripts</label>
    <input type="text" :id="option.id" x-model="option.value" id="processScripts"><br>

    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="quoteCharacter" class="" 
    title='Type of quote to use for attribute values \' '>
    Quote character</label>
    <input type="text" :id="option.id" x-model="option.value" id="quoteCharacter"><br>



    <input type="checkbox" :id="option.id" x-model="option.checked" id="removeAttributeQuotes">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? ' unsafe' : ''" for=" removeAttributeQuotes" class="" 
    title='Remove quotes around attributes when possible'>
    Remove attribute quotes</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="removeComments">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="removeComments" class="">
      Remove Strip HTML comments</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="removeEmptyAttributes">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="removeEmptyAttributes" class="" 
    title='Remove all attributes with whitespace-only values'>
    Remove empty attributes</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="removeEmptyElements" value="">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="removeEmptyElements" class="unsafe" 
    title='Remove all elements with empty contents'>
    Remove empty elements</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="removeOptionalTags">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="removeOptionalTags" class="">
      Remove optional tags</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="removeRedundantAttributes">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="removeRedundantAttributes" class="" 
    title='Remove attributes when value matches default.'>
    Remove redundant attributes</label><br>
    

    <input type="checkbox" :id="option.id" x-model="option.checked" id="removeScriptTypeAttributes">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="removeScriptTypeAttributes" class="" 
    title='Remove <code>type="text/javascript"</code> from <code>script</code> tags. Other <code>type</code> attribute values are left intact'>
    Remove script type attributes</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="removeStyleLinkTypeAttributes">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="removeStyleLinkTypeAttributes" class="" 
    title='Remove <code>type="text/css"</code> from <code>style</code> and <code>link</code> tags. Other <code>type</code> attribute values are left intact'>
    Remove style link type attributes</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="removeTagWhitespace">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="removeTagWhitespace" class="unsafe" 
    title='Remove space between attributes whenever possible. <em>Note that this will result in invalid HTML!</em>'>
    Remove tag whitespace</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="sortAttributes">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="sortAttributes" class="unsafe" 
    title='Sort attributes by frequency'>
    Sort attributes</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="sortClassName">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="sortClassName" class="unsafe" 
    title='Sort style classes by frequency'>
    Sort class name</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="trimCustomFragments">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="trimCustomFragments" class="" 
    title='Trim white space around <code>ignoreCustomFragments</code>.'>
    Trim white space around custom fragments</label><br>

    <input type="checkbox" :id="option.id" x-model="option.checked" id="useShortDoctype">
    <label :for="option.id" x-text="option.label" :class="option.unsafe ? 'unsafe' : ''" for="useShortDoctype" class="" 
    title='Replaces the <code>doctype</code> with the short (HTML5) <code>doctype</code>'>
    Use short doctype</label><br>

    </form>
</div><span>Select:</span>
  <input type="button" onclick="selectAllOptions(true)" value="All">
  <input type="button" onclick="selectAllOptions(false)" value="None">
  <input type="button" onclick="resetOptions()" value="Reset">
  <a href="https://terser.org/html-minifier-terser/" target="ugly">
  <center><img src="https://terser.org/img/terser-banner-logo.svg" width="200px"></center></a>
              </font></div> </div></div>
                 </div>
              </div>
              <!--  end submenu /*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->



    <!--   <input type="button" class="dropbt" id="invisiblesbutton" onclick="toggleinvisibles()" title="Toggle Invisibles" style="" onmouseover="this.focus()" value="Hide Invisibles">
  -->
  </div>
</div>
<!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->


<!--
///////////////////////////
// menu button view 
/////////////////////////// 
-->
 <!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->
 <div class="dropdown">
  <button class="dropbtn" onmouseover="this.focus()">View</button>
  <div class="dropdown-content">
    <input type="button" class="dropbt" onclick="showhideminimap()" id="minimapbutton" value="Hide MiniMap" onmouseover="this.focus()">
    <input type="button" class="dropbt" onclick="showhidepreview()" id="previewbutton" value="Hide Preview" onmouseover="this.focus()">
    <input type="button" class="dropbt" id="fullscreenbutton" onclick="toggleFullScreen()" title="Toggle FullScreen" style="" onmouseover="this.focus()" value="FullScreen">
    <input type="button" class="dropbt" id="linenmbrsbutton" onclick="togglelinenumbers()" title="Toggle the Gutter LineNumbers" style="" onmouseover="this.focus()" value="Hide LineNumbers">
    <input type="button" class="dropbt" id="invisiblesbutton" onclick="toggleinvisibles()" title="Toggle Invisibles" style="" onmouseover="this.focus()" value="Hide Invisibles">
  </div>
</div>
<!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->



<!--
///////////////////////////
// menu button Options
/////////////////////////// 
-->
 <!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->
 <div class="dropdown">
  <button class="dropbtn" onmouseover="this.focus()">Options</button> 
  <div class="dropdown-content"style="width:200;" > 
    <input type="button" class="dropbt" value="Ace Settings Menu" onClick='ace.edit("editor").execCommand("showSettingsMenu");' title="Show ACE Settings Menu"  onmouseover="this.focus()">
    <button class="dropbt" onclick="" id=""  onmouseover="this.focus()" title="Tab is based on +this.value+ spaces">TabSize: 
      <input type="number" step="1" class="" id="tabinput" oninput="editor.setOption('tabSize', this.value);"  style="width:30px;"value="2" min="2" onmouseover="this.focus()" title="Tab is based on +this.value+ spaces"> </button> <br>

<!-- atomic soft tabs -->
 <input type="checkbox" id="chcksofttabs" onchange="togglesofttabs()" 
 title='Atomic Soft Tabs&#013;   off Tab is a line in invisibles (maybe smaller faster code?) &#013;   on Tab is made of spaces, dots in invisibles&#013;&#013;maybe make a Edit option to convert spaces to tabs'>
 <button class="dropbt" onclick="if(chcksofttabs.checked){chcksofttabs.checked=false;}else{chcksofttabs.checked=true;};togglesofttabs()" id="" value="" onmouseover="this.focus()" 
 title='Atomic Soft Tabs&#013;   off Tab is a line in invisibles (maybe smaller faster code?) &#013;   on Tab is made of spaces, dots in invisibles&#013;&#013;maybe make a Edit option to convert spaces to tabs'>Atomic Soft Tabs</button><br>
<script>
function togglesofttabs(){
  if(chcksofttabs.checked){
			editor.setOption('useSoftTabs', true);  
      console.log("check true togglesofttabs");
  }else{
     editor.setOption('useSoftTabs', false); 
     console.log("check false togglesofttabs");
  }
}
</script>
<!-- atomic soft tabs -->

<!-- auto  indent -->
 <input type="checkbox" id="chcklai" onchange="toggleautoindent()" checked  
 title='Auto indent&#013;   off start a new line at begin&#013;   on start a new line at tabbed position of previous line'>
 <button class="dropbt" onclick="if(chcklai.checked){chcklai.checked=false;}else{chcklai.checked=true;};toggleautoindent()" id="" value="" onmouseover="this.focus()" 
 title='Auto indent&#013;   off start a new line at begin&#013;   on start a new line at tabbed position of previous line'>Auto indent</button><br>
<script>
function toggleautoindent(){
  if(chcklai.checked){
			//editor.setOption('behavioursEnabled', true);  // auto close (){}[] and maybe also <div> etc
      editor.setOption('enableAutoIndent', true);
      console.log("check true auto indent");
  }else{
     //editor.setOption('behavioursEnabled', false); // auto close (){}[] and maybe also <div> etc
     editor.setOption('enableAutoIndent', false);
     console.log("check false auto indent");
  }
}
</script>
<!-- auto  indent -->

<!--  toggleliveautocompletion -->
<input type="checkbox" id="chcklac" onchange="toggleliveautocompletion()" checked  
title='Live Auto Completion, Suggestion, Snippets, PopUp&#013;if off&#013;Swittch to Basic AutoCompletion&#013;CTRL+Space&#013;Shows the PopUp &#013;'><button class="dropbt" onclick="if(chcklac.checked){chcklac.checked=false;}else{chcklac.checked=true;};toggleliveautocompletion()" id="" value="" onmouseover="this.focus()" title='Live Auto Completion, Suggestion, Snippets, PopUp&#013;if off&#013;Swittch to Basic AutoCompletion&#013;CTRL+Space&#013;Shows the PopUp &#013;'>AutoCompletion</button><br>
<script>
function toggleliveautocompletion(){
  if(chcklac.checked){
    	//editor.setOption('enableBasicAutocompletion', true);
			editor.setOption('enableLiveAutocompletion', true);
      console.log("check true enableLiveAutocompletion");
  }else{
     //editor.setOption('enableBasicAutocompletion', false);
     editor.setOption('enableLiveAutocompletion', false);
     console.log("check false enableLiveAutocompletion");
  }
}
</script>
<!--  toggleliveautocompletion -->

<!-- toggleWraplonglines  -->
<input type="checkbox" id="tgglwrplnglns" onchange="toggleWraplonglines()"><button class="dropbt" onclick="if(tgglwrplnglns.checked){tgglwrplnglns.checked=false;}else{tgglwrplnglns.checked=true;};toggleWraplonglines()" id="" value="" onmouseover="this.focus()">Wrap Long Lines</button>
<script>
function toggleWraplonglines(){
  if(tgglwrplnglns.checked){
    	//editor.setOption('enableBasicAutocompletion', true);
			editor.setOption('wrap', true);
      console.log("wrap true");
  }else{
     //editor.setOption('enableBasicAutocompletion', false);
     editor.setOption('wrap', false);
     console.log("wrap false");
  }
}
</script>
<!-- toggleWraplonglines  -->
<br>
 <input type="checkbox" id="chckbehaviours" onchange="togglebehaviours()" checked  
 title='behavioursEnabled&#013;   off no auto close { [ ( <cemter> " &#013;   on auto close () [] {} <center></center> Etc.'>
 <button class="dropbt" onclick="if(chckbehaviours.checked){chckbehaviours.checked=false;}else{chckbehaviours.checked=true;};togglebehaviours()" id="" value="" onmouseover="this.focus()" 
 title='behavioursEnabled&#013;   off no auto close { [ ( <cemter> " &#013;   on auto close () [] {} <center></center> Etc.'>Behaviours</button><br>
<script>
function togglebehaviours(){
  if(chckbehaviours.checked){
			editor.setOption('behavioursEnabled', true);  // auto close (){}[] and maybe also <div> etc
      console.log("check true behavioursEnabledt");
  }else{
     editor.setOption('behavioursEnabled', false); // auto close (){}[] and maybe also <div> etc
     console.log("check false behavioursEnabled");
  }
}
</script>

<input type="button" class="dropbt" id="tooltipbutton" onclick="toggletooltip()" title="Toggle menu Tooltip Popup info on / off" style="" onmouseover="this.focus()" value="Hide menu ToolTip popup">
  <script>
   
    function toggletooltip(){
      play();
      if (tooltipval==1){
          tooltipbutton.value="Show menu ToolTip popup";
          $( document ).tooltip({
              disabled: true
          });



          tooltipval=0;
      }else{  
          tooltipbutton.value="Hide menu ToolTip popup";
          $( document ).tooltip({
              disabled: false
          });     // does not show again? https://api.jqueryui.com/tooltip/#option-disabled
                  // it shows but on the ace editor layer visible on light themes
                  // not near the mouse pointer in original colors
          tooltipval=1;       
//$( document ).tooltip({
//  track: true
//});
       
$( document ).tooltip({
  position: { my: "left-250 top+15", at: "left bottom", collision: "flipfit" }
});
      }    
    }
    </script>
  <!--     <input type="button" class="dropbt" id="linenmbrsbutton" onclick="togglelinenumbers()" title="Toggle the Gutter LineNumbers" style="" onmouseover="this.focus()" value="Hide LineNumbers">
    <input type="button" class="dropbt" id="invisiblesbutton" onclick="toggleinvisibles()" title="Toggle Invisibles" style="" onmouseover="this.focus()" value="Hide Invisibles">
-->
  </div>
</div>
<!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->


 <input type="button"  id="fullscreenbutton" onclick="toggleFullScreen()" title="Toggle FullScreen" style="" onmouseover="this.focus()" value="FS">
   <input type="button"  id="AIbutton" onclick="toggleVisibility('cont_ai_ner')" title="GPT OpenAI API" style="color:greenyellow;" onmouseover="this.focus()" value="AI">


<input type="button" value="&nbsp;F1&nbsp;" onClick='editor.execCommand("openCommandPallete")' 
 title="Show F1 Better KeyBoard ShortCuts popup Menu&#010;if use F1 button, must have focus on Editor"  onmouseover="this.focus()">
<a href="Http://paypal.me/LDijkman" target="Coffee">
<img   src="https://raw.githubusercontent.com/ldijkman/Ace_Seventh_Heaven/main/docs/Electra.jpg" style="float:right;width:22px;height:22px;margin: 0px 15px 15px 0px;"  >
</a>

<input type="button"  id="errorbutton" value="V" style="<!--transform: rotate(90deg);-->color:red;  /*rotate >*/" onclick="nexterror();" onmouseover="this.focus()" title="next warning / error">

<input type="button"  id="Sticky" value=">>" style="transform: rotate(90deg);  /*rotate >*/" onclick="editor.renderer.scrollToLine(Number.POSITIVE_INFINITY)" onmouseover="this.focus()" title="scroll to Begin">
<input type="button"  id="Sticky" value=">>" style="transform: rotate(-90deg);  /*rotate >*/" onclick="editor.renderer.scrollToLine(Number.NEGATIVE_INFINITY)"  onmouseover="this.focus()" title="scroll to End">

<input type="button"  id="Sticky" value=">" style="transform: rotate(90deg);  /*rotate >*/" onclick="editor.scrollPageDown();" onmouseover="this.focus()" title="scrollPageDown">
<input type="button"  id="Sticky" value=">" style="transform: rotate(-90deg);  /*rotate >*/" onclick="editor.scrollPageUp();" onmouseover="this.focus()" title="scrollPageUp">

 
    <script>
function joinfunction() {
   var myWindow = window.open("", "_child",  "left=200,top=100,width=700,height=700;scrollbars=1;");
//https://ldijkman.github.io/Ace_Seventh_Heaven/shortcutkeys.html
myWindow.document.write(`<html>
  <head>
    <title>hello</title>
    
<style>
body{
   font-size: 12pt;
   margin: 20px;
   padding: 20px;
}
kbd {
    font-family: Monaco, Menlo, monospace;
    font-size: 12pt;
    text-transform: capitalize;
    border: 1px solid #969896;
    padding: 1px 5px;
    border-radius: 3px;
    color: #a3685a;
    background-color: #ffffff;
}

user agent stylesheet
kbd {
    font-family: monospace;
}
</style>

</head>
<body bgcolor="lightgray">

<br>
the F1 shortcut menu should look like this?<br>
<br>
<table>
<tbody>
<tr>
<td>Ace Settings</td>
<td><span class="nsoa"><kbd>ctrl</kbd> + <kbd>,</kbd> CTRL+Comma</span></td>
</tr>
<tr>
<td>Shortcuts Menu</td>
<td><span class="nsoa"><kbd>F1</kbd></span></td>
</tr>
<tr>
<td>Search / Find</td>
<td><span class="nsoa"><kbd>ctrl</kbd> + <kbd>f</kbd></span></td>
</tr>
<tr>
<td>Undo</td>
<td><span class="nsoa"><kbd>ctrl</kbd> + <kbd>z</kbd></span></td>
</tr>
<tr>
<td>Redo</td>
<td><span class="nsoa"> <kbd>ctrl</kbd> + <kbd>shift</kbd> + <kbd>z</kbd></span></td>
</tr>
<tr>
<td>Select All</td>
<td><span class="nsoa"><kbd>ctrl</kbd> + <kbd>a</kbd></span></td>
</tr>
<tr>
<td>Paste</td>
<td><span class="nsoa"><kbd>ctrl</kbd> + <kbd>v</kbd></span></td>
</tr>
<tr>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>

more to add<br>
anyone interestend in making a help page?
https://github.com/ldijkman/Ace_Seventh_Heaven/blob/main/docs/shortcutkeys.html<br>
<!-- DivTable.com -->
<br>
<pre>
  Menu Options 
    checkbox      
        Live Auto Completion, Suggestion, Snippets, PopUp
    if off 
       Swittch to Basic AutoCompletion
    CTRL+Space
       Shows the Suggestions PopUp

</pre>
<center
<br>
<iframe width="480" height="240" src="https://www.youtube.com/embed/JeYSttRZKmA" title="Why Should You Learn Vim" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
<br>
<a href="https://youtu.be/JeYSttRZKmA" target="vim">Ace VIM type KeyBinding, Why</a><br>
<br>
<a href="https://github.com/23maverick23/nsoa-console" target="button">
button idea from nsoa-console</a><br>
</body>
</html>`);
}

</script>

<!--
///////////////////////////
// menu button Help
/////////////////////////// 
-->
 <!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->
 <div class="dropdown">
  <button class="dropbtn" onmouseover="this.focus()">Help</button>
  <div class="dropdown-content">
    <button class="dropbt" style="width:90px;" onclick="joinfunction()" type="button" onmouseover="this.focus()">Help page</button>
     <button class="dropbt" style="width:90px;" onmouseover="this.focus()" onclick='window.open("https://github.com/ldijkman/Ace_Seventh_Heaven/issues","_Bugs")'>Bugs-issues</button>
    <button class="dropbt" style="width:90px;" onmouseover="this.focus()" onclick='window.open("https://github.com/ldijkman/Ace_Seventh_Heaven/discussions","_github")'>Discussions</button>
    <button class="dropbt" style="width:90px;" onmouseover="this.focus()" onclick='window.open("https://github.com/ldijkman/Ace_Seventh_Heaven/discussions/3","_wishlist")'>WishList-</button>
    <button class="dropbt" style="width:90px;" onmouseover="this.focus()" onclick='window.open("https://facebook.com/luberth.dijkman","_FaceBook")'>FaceBook</button>  
    <button class="dropbt" style="width:90px;" onclick="XFunction()" onmouseover="this.focus()">X Twitter</button>
    <button class="dropbt" style="width:90px;" onmouseover="this.focus()" onclick=''>-</button>
    <button class="dropbt" style="width:90px;" onmouseover="this.focus()" onclick='window.open("http://paypal.me/LDijkman","_donations")'>Donations</button>
  </div>
</div>
<!--/*https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover*/-->

<script>
function XFunction() {
  window.open("https://x.com/DLD52791488", "_blank");
}
</script>

 <label id="version" style="color:lightgray;font-size:14px;"></label> 


  <!--dutchorange////////////////////////////////////////////////////////////-->


<div class="container">
    <div id="editor" onmouseover='ace.edit("editor").focus();'><textarea>
<!DOCTYPE html> <!-- this should be the first line of the document not all the blahblah before this-->
<html> <!--trigger an Error should be <html> see vertical scrollbar red line-->
<head>

  <title>Visual TimeSlot Day Week Scheduler, Touch Friendly</title>

  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/ldijkman/randomnerd_esp32_wifi_manager/main/Electra.jpg">
  <!-- on my android icon is also shown on home screen, if saved to home screen -->
<!--
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  -->
 <meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- when save to home screen on phone - it is full screen - no annoying adres bar -->
    <!-- Allow web app to be run in full-screen mode - iOS. -->
    <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- Allow web app to be run in full-screen mode - Android. -->
    <meta name="mobile-web-app-capable" content="yes">

     <!--
       do not show google translate popup, translate does not work
       should not be translated Google won't translate any of the content
     -->
    <meta name="google" value="notranslate">
    <meta name="google" content="notranslate">

    <meta name="description" content="Visual Day scheduler.">
    <meta name="author" content="Copyright Dirk Luberth Dijkman 2023">


  <!--
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
  -->
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>

   <!-- modified version analog timepcker on github https://github.com/ldijkman/randomnerd_esp32_wifi_manager/tree/main/docs/mrs -->
   <script src="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/lib/timepicker.js"></script>
   <script src="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/lib/ismobile.js"></script>
   <script src="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/lib/suncalc.js"></script>

	    
  <link rel="stylesheet" href="https://ldijkman.github.io/Ace_Seventh_Heaven/console.css">
<!--
<script src="https://ldijkman.github.io/Ace_Seventh_Heaven/console.js"></script>
-->

<style>
  #editpopup {          /* # = id */
  position: fixed;
  left:40%;
  top:30%;
  z-index: 9;
  background-color: #f1f1f1;
  text-align: center;
  border: 1px solid orange;
  padding: 1px;
  z-index:1001;  /* i do not know what the zindex of the world map picker is, its high like 1000*/
  display: none;
}

#editpopupheader {      /* # = id */
  padding: 5px;
  cursor: move;
  z-index: 10;
  background-color: #2196F3;
  color: #fff;
  z-index:1001;  /* i do not know what the zindex of the world map picker is, its high like 1000 */
}

.clock-timepicker-popup{    /* . = class */
  opacity:90%;
  }

#outerDiv {                 /* # = id */
  position:relative;
  width:100%;
  height:50px;
  border: 1px solid black;
  background-color: lightgray;
  cursor: pointer;

}
.outerDiv {               /* . = class */
  width:100%;
  height:50px;
  border: 1px solid black;

}
#innerDiv {
  position:relative;
  //left:50px;
  width: 0px;
  height:50px;
  background-color: green;
  opacity:50%;
  z-index:500;

}
.ruler-line {               /* . = class */
  background: #999;
  top: -30px;
  position: absolute;
  left: 50%;
}

.ruler-number {               /* . = class */
  position: absolute;
  top: -50px;
  left: 50%;
  margin-left: -.20em;
  width: 2em;
  z-index:-1;  /*  stops it from click add timeslots*/
}


.evening_shade {               /* . = class */
 position:absolute;height:20px;background-color:gray;opacity:20%;top:-20px;
 width: 5%;
}
.morning_shade {
  position:absolute;height:20px;background-color:gray;opacity:20%;top:-20px;
  left:91%;
  width: 5%;
}

#label_monday{
  color:green;
}
input{
  caret-color: red;   /*no blibking cursor at some places*/
}

label  {
  cursor:pointer;             /*mouse hand on label monday ....*/
  caret-color: transparent;   /*no blinking cursor at some places*/
  user-select: none;          /*disable mouse text drag selection on labels*/
 }

body{
  caret-color: transparent;   /*no blibking cursor at some places*/
  user-select: none;
  /*
  disable mouse text drag selection on body
  is that what facebook uses?
  */
}



</style>

</head>
<body bgcolor="#f2f2ed">


<script>
/////////////////////////////////////////////
// served from ESP32
// screenshots
// https://github.com/ldijkman/randomnerd_esp32_wifi_manager/tree/main/docs/mrs/create_from_scratch
// Chrome inspect => Network => WS
/////////////////////////////////////////////
/**
 * ----------------------------------------------------------------------------
 * ESP32 Remote Control with WebSocket
 * ----------------------------------------------------------------------------
 * © 2020 Stéphane Calderoni
 *
 * https://m1cr0lab-esp32.github.io/remote-control-with-websocket/
 *
 * https://github.com/m1cr0lab-esp32/remote-control-with-websocket
 * ----------------------------------------------------------------------------
 */

var gateway = `ws://${window.location.hostname}/ws`;
var websocket;

// ----------------------------------------------------------------------------
// Initialization
// ----------------------------------------------------------------------------

window.addEventListener('load', onLoad);

function onLoad(event) {
    initWebSocket();
}

// ----------------------------------------------------------------------------
// WebSocket handling
// ----------------------------------------------------------------------------

function initWebSocket() {
    console.log('Trying to open a WebSocket connection...');
    websocket = new WebSocket(gateway);
    websocket.onopen  = onOpen;
    websocket.onclose = onClose;
}

function onOpen(event) {
    console.log('Connection opened');
}

function onClose(event) {
    console.log('Connection closed');
    setTimeout(initWebSocket, 2000);
}

/* later on the page next code for sending websocket
function send_to_ESP(){                              // call by save and delete
    var dy=daytext;
    var ts=timeslots;
    timeslot_to_ESP = {dy,ts};        // active day timeslot
    console.log("send_to_ESP() ? ",JSON.stringify( timeslot_to_ESP ));  // active day timeslot

    websocket.send(JSON.stringify( timeslot_to_ESP ));  // send the websocket to ESP
    // {"dy":"Tue","ts":[0,60,300,360,600,660,900,960,1200,1260]}

}
*/

/////////////////////////////////////////////
// served from ESP32
// screenshots
// https://github.com/ldijkman/randomnerd_esp32_wifi_manager/tree/main/docs/mrs/create_from_scratch
// Chrome inspect => Network => WS
/////////////////////////////////////////////


/*
*  var dy=daytext;
   var ts=timeslots;
   timeslot_to_ESP = {dy,ts};

* deserialize {"dy":"Tue","ts":[0,60,300,360,600,660,900,960,1200,1260]}
* websocket message {"dy":"Tue","ts":[0,60,300,360,600,660,900,960,1200,1260]}
* https://arduinojson.org/v6/assistant/#/step2
* result arduino code
// Stream& input; {"dy":"Tue","ts":[0,60,300,360,600,660,900,960,1200,1260]}

StaticJsonDocument<256> doc;

DeserializationError error = deserializeJson(doc, input);

if (error) {
  Serial.print(F("deserializeJson() failed: "));
  Serial.println(error.f_str());
  return;
}

const char* dy = doc["dy"]; // "Tue"

JsonArray ts = doc["ts"];
int ts_0 = ts[0]; // 0
int ts_1 = ts[1]; // 60
int ts_2 = ts[2]; // 300
int ts_3 = ts[3]; // 360
int ts_4 = ts[4]; // 600
int ts_5 = ts[5]; // 660
int ts_6 = ts[6]; // 900
int ts_7 = ts[7]; // 960
int ts_8 = ts[8]; // 1200
int ts_9 = ts[9]; // 1260
*/

console.info(' Hello World', new Date());	    
	    
</script>







<center>
<pre class="gofullscreenmessage" id="gofullscreenmessage" style="font-size : 17px;"><!-- this text will be set if device screen framed --></pre>
<pre class="pleaserotatetolandscape" id="pleaserotatetolandscape" style="font-size : 17px;"><!-- this text will be set if device screen is in portrait,  Rotate device to LandScape? --></pre>

<br>

<!-- radio button is hidden -->
<label for="radio_monday" id="label_monday"  style="border: 1px solid gray;border-radius: 13px; padding:5px;margin:3px;color:green;">
Monday
<input type="radio" name="myRadioButton" class="radioday" onclick="checkit(this.id)" id="radio_monday" style="color:gray;" checked hidden >
</label>
<label for="radio_tuesday" id="label_tuesday" style="border: 1px solid gray; border-radius: 13px;padding:5px;margin:3px;color:gray;">
Tuesday
<input type="radio" name="myRadioButton" class="radioday"  onclick="checkit(this.id)" id="radio_tuesday" style="color:gray;" hidden>
</label>
<label for="radio_wednesday" id="label_wednesday" style="border: 1px solid gray; border-radius: 13px;padding:5px;margin:3px;color:gray;">
Wednesday
<input type="radio" name="myRadioButton" class="radioday" onclick="checkit(this.id)" id="radio_wednesday" style="color:gray;" hidden>
</label>
<label for="radio_thursday" id="label_thursday" style="border: 1px solid gray; border-radius: 13px;padding:5px;margin:3px;color:gray;">
Thursday
<input type="radio" name="myRadioButton" class="radioday" onclick="checkit(this.id)" id="radio_thursday" style="color:gray;" hidden>
</label>
<label for="radio_friday" id="label_friday" style="border: 1px solid gray; border-radius: 13px;padding:5px;margin:3px;color:gray;">
Friday
<input type="radio" name="myRadioButton" class="radioday" onclick="checkit(this.id)" id="radio_friday" style="color:gray;" hidden>
</label>
<label for="radio_saturday" id="label_saturday" style="border: 1px solid gray; border-radius: 13px;padding:5px;margin:3px;color:gray;">
Saturday
<input type="radio" name="myRadioButton" class="radioday" onclick="checkit(this.id)" id="radio_saturday" style="color:gray;" hidden>
</label>
<label for="radio_sunday" id="label_sunday" style="border: 1px solid gray; border-radius: 13px;padding:5px;margin:3px;color:gray;">
Sunday
<input type="radio" name="myRadioButton" class="radioday"  onclick="checkit(this.id)" id="radio_sunday" style="color:gray;" hidden>
</label>

</center>
<br>

<div id="container" class="container" style="">

    <div id="day"><h1>Monday</h1><!-- big dayname on left gets here --></div>

    <div id='outerDiv' class="outerDiv" onclick = 'changeWidth(event)'>
        <div id='innerDiv'></div>
    </div>

</div>
<br><br>
<center>
<br>
<br>
<br>
<label for="days">Copy <b class id="copyday"></b> Schema to</label>
<select id="days">
  <option id="firstoption" value="none" style="color:gray;" selected disabled>Select Day</option>
  <optgroup label=" ">
  <option value="monday">Monday</option>
  <option value="tuesday">Tuesday</option>
  <option value="wednesday">Wednesday</option>
  <option value="thursday">Thursday</option>
  <option value="friday">Friday</option>
  <option value="saturday">Saturday</option>
  <option value="sunday">Sunday</option>
  </optgroup>
  <optgroup label=" ">
  <option value="weekdays">Weekdays Mon...Fri</option>
  </optgroup
  ><optgroup label=" "> </optgroup>

</select>
    
<input type="button" id="copyokbutton" value="OK" onclick='copy_schema(document.getElementById("days").value)'>

<br>
<!--
  time picker does not like when pagescale is changed
  or is it touch that does not like scale change
  think it would be nice to have page zoom scale

Zoom test<br>
<input type="range" style="width:95%;height:100px;"  min="50" max="200" value="100" oninput="setZoom(this.value)"list=tickmarks>
<datalist id=tickmarks>
<option>0</option>
<option>50</option>
<option>75</option>
<option>100 </option>
<option>125</option>
<option>150</option>
<option>175</option>
<option>200</option>
</datalist><br>
-->
<pre class="message" id="message"></pre>
<pre class="message2" id="message2"></pre>
<pre class="message3" id="message3"></pre>

<input type="button" value="Chrome inspect clear console " onclick="console.clear()"><br>
Open Chrome Inspect Console = Ctrl + Shift + j<br>
<br>




<hr width="40%">

<a href="https://www.google.com/search?q=52.7354,5.179" target="google">GeoLocation for sunrise, sunset </a>
<br>
<br>
lat:<input type="text" id="lat" size="6" oninput="dogeoloc()" value="52.7354" onchange="dogeoloc()"/>
lon:<input type="text" id="lon" size="6" oninput="dogeoloc()" value="5.179" onchange="dogeoloc()"/>

<hr width="40%">

<br>
<br>

<!--begin https://www.jqueryscript.net/other/leaflet-location-picker.html#google_vignette-->
sunrise sunset geolocation picker map lat lon<br>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.6.0/leaflet.css" />
<link rel="stylesheet" href="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/create_from_scratch/leaflet-locationpicker.css" />

<div class="container">
      <input id="geoloc" type="text" value="52.7354,5.179" class="form-control mb-3"  />
      <input type="button" value="use location" onclick="useit()"  /><br><br>
      <div id="fixedMapCont" style="border: 3px solid #222; width:275px;"></div>
</div>
Think the time / timezone of your device must match geolocation<br>
i am in europe, if i choose caribean location<br>
time sunrise sunset is about 7 hours of target<br>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.6.0/leaflet.js"></script>
<script src="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/create_from_scratch/leaflet-locationpicker.js"></script>
<script>
  $('#geoloc').leafletLocationPicker({
    alwaysOpen: true,
    mapContainer: "#fixedMapCont"
});

function useit(){
    var location = document.getElementById("geoloc").value.split(',');   // make an array splitted at comma                             // split hh:mm  at the colons
    document.getElementById("lat").value=location[0];   // left of comma val 0 of array
    document.getElementById("lon").value=location[1];   // rigth of comma val 1 of array
    dogeoloc();
}
</script>
<!-- end https://www.jqueryscript.net/other/leaflet-location-picker.html#google_vignette-->

<br>
<br>
a bar for each day<br>
click on bar should open a popup at that clicked time<br>
text field should open an analog timepicker dail that looks the same on all systems<br>
<br>
i Think most people use a phone or tablet not pc with mouse<br>
so should work for phone or tablet touch<br>
Touch drag edit popup should work<br>
<br>
<br>
<br>
<div style="width:100%;font-size:1vw;">
/*
<pre>
 __      ___                 _        _____      _              _       _           
 \ \    / (_)               | |      / ____|    | |            | |     | |          
  \ \  / / _ ___ _   _  __ _| |_____| (___   ___| |__   ___  __| |_   _| | ___ _ __ 
   \ \/ / | / __| | | |/ _` | |______\___ \ / __| '_ \ / _ \/ _` | | | | |/ _ \ '__|
    \  /  | \__ \ |_| | (_| | |      ____) | (__| | | |  __/ (_| | |_| | |  __/ |   
     \/   |_|___/\__,_|\__,_|_|     |_____/ \___|_| |_|\___|\__,_|\__,_|_|\___|_|   
                                                                                    
                                                                                    
Figlet font Big https://run.plnkr.co/plunks/ZEkhoGgs4ntDZzT0/ 
</pre>
*/
</div>
<br>






















<script>
  console.clear();

// and Luberth said he prefers not to use JQuery
// and now he Luberth Creates his own AbraCadaBra JaBaDabba Script
// id() short for document.getElementById()
// makes the code much better readable for me even better as JQquery $()
//
// id("label_monday").style.borderColor = "green";
// same as
// document.getElementById("label_monday").style.borderColor = "green";
function id(id) {
  return document.getElementById(id);
}

// classname() short for document.getElementsByClassName()
function classname(classname) {
  return document.getElementsByClassName(classname);
}




// ESP8266 ESP32 webserver should set next on pageload?
// with %template_placeholder% variable replace on load?
// https://github.com/me-no-dev/ESPAsyncWebServer#template-processing
// but the % sign is a bit tricky i would say if not an even number page may be messed up by other % signs

  //let monday_timeslots = [%monday_times_from_ESP_on_upload%];       // %vaiable% filled with variables in ESP on upload

  let monday_timeslots = [450,990,15,135,240,285,1200,1440];          // timeslots pairs of 2 in minutes of day
  let tuesday_timeslots = [0,60,300,360,600,660,900,960,1200,1260];   // timeslots pairs of 2 in minutes of day
  let wednesday_timeslots = [0,300,360,660,900,1260];                 // timeslots pairs of 2 in minutes of day
  let thursday_timeslots = [0,300,660,900,1200,1440];                 // timeslots pairs of 2 in minutes of day
  let friday_timeslots = [0,30,360,1260];                             // timeslots pairs of 2 in minutes of day
  let saturday_timeslots = [0,720];                                   // timeslots pairs of 2 in minutes of day
  let sunday_timeslots = [720,1440];                                  // timeslots pairs of 2 in minutes of day
// ESP8266 ESP32 webserver should set above on pageload?

  let timeslots = monday_timeslots;
  var daytext;
///////////////////////////////////////////////////
// send_to_ESP()
// test add a dayname to the array
// https://stackoverflow.com/questions/44746912/adding-array-name-to-anonymous-array-in-a-json-string
////////////////////////////////////////////////////////////////////////////////
function send_to_ESP(){                              // call by save and delete
    var dy=daytext;
    var ts=timeslots;
    timeslot_to_ESP = {dy,ts};        // active day timeslot
    console.log("send_to_ESP() ? ",JSON.stringify( timeslot_to_ESP ));  // active day timeslot

    websocket.send(JSON.stringify( timeslot_to_ESP ));  // send the websocket to ESP
    // {"dy":"Tue","ts":[0,60,300,360,600,660,900,960,1200,1260]}

}
// if changes are made send it to ESP8266 ESP32 webserver?
// https://m1cr0lab-esp32.github.io/remote-control-with-websocket/





////////////////////////////////////////////////////////////
// copy_schema(wichtimeslot)
// wichtimeslot holds the day to paste current timeslot in
////////////////////////////////////////////////////////////
function copy_schema(wichtimeslot){
    console.log("copy_schema to ",wichtimeslot);
    if(wichtimeslot=="monday"){
      monday_timeslots=[];                // empty timeslot
      monday_timeslots= timeslots;        //
    }
    if(wichtimeslot=="tuesday"){
      tuesday_timeslots=[];
      tuesday_timeslots= timeslots;
    }
    if(wichtimeslot=="wednesday"){
      wednesday_timeslots=[];
      wednesday_timeslots= timeslots;
    }
    if(wichtimeslot=="thursday"){
      thursday_timeslots=[];
      thursday_timeslots= timeslots;
    }
    if(wichtimeslot=="friday"){
      friday_timeslots=[];
      friday_timeslots= timeslots;
    }
    if(wichtimeslot=="saturday"){
      saturday_timeslots=[];
      saturday_timeslots= timeslots;
    }
    if(wichtimeslot=="sunday"){
      sunday_timeslots=[];
      sunday_timeslots= timeslots;
    }



    if(wichtimeslot=="weekdays"){    // monday to friday
      monday_timeslots=[];
      monday_timeslots= timeslots;

      tuesday_timeslots=[];
      tuesday_timeslots= timeslots;

      wednesday_timeslots=[];
      wednesday_timeslots= timeslots;

      thursday_timeslots=[];
      thursday_timeslots= timeslots;

      friday_timeslots=[];
      friday_timeslots= timeslots;
    }

  // change option text and ok button text for a moment
  id("firstoption").innerHTML = "Copy Done!";
  id("copyokbutton").value = "Sending to Server!";
  // reset text after 2.5 second
  setTimeout( () => {
      id("copyokbutton").value = "OK";
      id("firstoption").innerHTML = "Select Day";
  }, 2500 );

  id("days").value="none";
}




  function setZoom(value) {
        document.body.style.zoom = value+'%';
    };




/////////////////////////////////////////////////////
// check radio labels weekdays
/////////////////////////////////////////////////////
function checkit(wich) {
   console.log("wich ",wich);
  timeslots = [];
  if (id("radio_monday").checked) {
    daytext="Mon";
    timeslots = monday_timeslots;                           // load selected day in timeslots
    drawtimeslots();
    id("day").innerHTML = "<h1>Monday</h1>";
    id("copyday").innerHTML = "Monday";
    //id('radio_monday').checked
    console.log("radio_monday");
    id("label_monday").style.color = "green";
    id("label_monday").style.borderColor = "green";
  } else {
    id("label_monday").style.color = "gray";
    id("label_monday").style.borderColor = "gray";
  }

  if (id("radio_tuesday").checked) {
    daytext="Tue";
    timeslots = tuesday_timeslots;                           // load selected day in timeslots
    drawtimeslots();
    id("day").innerHTML = "<h1>Tuesday</h1>";
    id("copyday").innerHTML = "Tuesday";
    //id('radio_tuesday').checked
    console.log("radio_tuesday");
    id("label_tuesday").style.color = "green";
    id("label_tuesday").style.borderColor = "green";
  } else {
    id("label_tuesday").style.color = "gray";
    id("label_tuesday").style.borderColor = "gray";
  }

  if (id("radio_wednesday").checked) {
    daytext="Wed";
    timeslots = wednesday_timeslots;                           // load selected day in timeslots
    drawtimeslots();
    id("day").innerHTML = "<h1>Wednesday</h1>";
    id("copyday").innerHTML = "Wednesday";
    //id('radio_wednesday').checked
    console.log("radio_wednesday");
    id("label_wednesday").style.color = "green";
    id("label_wednesday").style.borderColor = "green";
  } else {
    id("label_wednesday").style.color = "gray";
    id("label_wednesday").style.borderColor = "gray";
  }

  if (id("radio_thursday").checked) {
    daytext="Thu";
    timeslots = thursday_timeslots;                           // load selected day in timeslots
    drawtimeslots();
    id("day").innerHTML = "<h1>Thursday</h1>";
    id("copyday").innerHTML = "Thursday";
    //id('radio_thursday').checked
    console.log("radio_thursday");
    id("label_thursday").style.color = "green";
    id("label_thursday").style.borderColor = 'green'
  } else {
    id("label_thursday").style.color = "gray";
    id("label_thursday").style.borderColor = "gray";

  }

  if (id("radio_friday").checked) {
    daytext="Fri";
    timeslots = friday_timeslots;                           // load selected day in timeslots
    drawtimeslots();
    id("day").innerHTML = "<h1>Friday</h1>";
    id("copyday").innerHTML = "Friday";
    //id('radio_friday').checked
    console.log("radio_friday");
    id("label_friday").style.color = "green";
    id("label_friday").style.borderColor = 'green'
  } else {
    id("label_friday").style.color = "gray";
    id("label_friday").style.borderColor = 'gray'
  }

  if (id("radio_saturday").checked) {
    daytext="Sat";
    timeslots = saturday_timeslots;                           // load selected day in timeslots
    drawtimeslots();
    id("day").innerHTML = "<h1>Saturday</h1>";
    id("copyday").innerHTML = "Saturday";
    //id('radio_saturday').checked
    console.log("radio_saturday");
    id("label_saturday").style.color = "green";
    id("label_saturday").style.borderColor = "green";
  } else {
    id("label_saturday").style.color = "gray";
    id("label_saturday").style.borderColor = "gray";
  }

  if (id("radio_sunday").checked) {
    daytext="Sun";
    timeslots = sunday_timeslots;                           // load selected day in timeslots
    drawtimeslots();
    id("day").innerHTML = "<h1>Sunday</h1>";
    id("copyday").innerHTML = "Sunday";
    //id('radio_saturday').checked
    console.log("radio_sunday");
    id("label_sunday").style.color = "green";
    id("label_sunday").style.borderColor = "green";
  } else {
    id("label_sunday").style.color = "gray";
    id("label_sunday").style.borderColor = "gray";
  }
}



//////////////////////////////////////////
// offtimechange
/////////////////////////////////////////
function offtimechange(){
  console.log("function offtimechange(){");
   if(id("offtime").value == "00:00"){
        id("offtime").value="24:00";                         // if offtime is 00:00 set it to 24:00
  }
}


/////////////////////////////////////////////////////////////////////////////////////////////////////
// call from HTML delete button   <input type="button" value="Delete" onclick="deletebutton()">
///////////////////////////////////////////////////////////////////////////////////////////////////
function deletebutton(){
    console.log("deletebutton clicked");
    console.log("timeslotpointer  ",timeslotpointer);

    if(timeslotpointer===""){return;}                  // timeslotpointer is from function timeslotclicked(wich)
    timeslots.splice( timeslotpointer, 2);             // remove 2 from timeslotarray
    timeslotpointer = "";                              // otherwise if delete is clicked again it will remove other

    domessage();
    showhideeditpopup();
    drawtimeslots();
    savefromedit = 0;                                  // do not know, have some strange overwrite / delete
                                                       // its a flag used when save button is clicked
    send_to_ESP();
}






//////////////////////////////////////////////////////////////////////////////////////////////
// call from HTML cancel button <input type="button" value="Cancel" onclick="cancelbutton()">
//////////////////////////////////////////////////////////////////////////////////////////////
function cancelbutton(){
  showhideeditpopup();
  id('innerDiv').style.left='';   // erase edit timeslot green div drawing???????
  id('innerDiv').style.width='';
  id('startlabel').innerHTML='';
  id('endlabel').innerHTML='';

   savefromedit = 0;
   selected_highlight = -1;                              // erase edit timeslot highlight
}








var timeslotpointer="";
var savefromedit=0;
var sorted;
var timeslotsnested;



//////////////////////////////////////
// time slot clicked edit or delete?
/////////////////////////////////////
function timeslotclicked(wich){   // div onclick gives/returns wich,   onclick="timeslotclicked(`+i+`)"
    timeslotdivclick = 1;         // i do not now a flag to keep outerdiv click away cq return from outerdiv click
                                  // maybe because of (i used why dont know)  different z-index for innerdiv and outerdiv
                                  // maybe an overlaying div is clicked first followed by underlaying div, i dont know
    console.log("timeslotclicked",wich);
    timeslotpointer = wich;

    selected_highlight = wich;                        // wich timeslot edit highlight color




    id("addoredit").innerHTML="EDIT TimeSlot";
    id("deletebutton").disabled = false;   // enablee the delete button
    id("deletebutton").hidden = false;     // not hide the delete button, show delete button
    showhideeditpopup();                                        // show edit popup

    // wich holds the array position of first data we need in minutes
    id("ontime").value=toHoursAndMinutes(timeslots[wich]);  // get minute data from timeslot array and convert to hh:mm for text input field
    id("offtime").value=toHoursAndMinutes(timeslots[wich+1]);
    savefromedit=1;                                 // a flag for savebutton
// if changes need to modify the timeslot array data

}





//////////////////////////////////////////////////////////////////////////////////////////
// save time slot
// call from HTML save button <input type="button" value="Save" onclick="savetimeslot()">
// save button pressed, save to timeslot array
//////////////////////////////////////////////////////////////////////////////////////////
function savetimeslot() {

     if(id("offtime").value == "00:00"){
        id("offtime").value="24:00";                         // if offtime is 00:00 set it to 24:00
         console.log("change 00:00 to 24:00");
  }

    var onhhmm = id("ontime").value;
    var offhhmm = id("offtime").value;
    console.log("onval, offval", onhhmm, offhhmm);

    showhideeditpopup();          // hide edit popup


  if(savefromedit==1){
      console.log("savefromedit",savefromedit);
      // here from a save click from possible modified timeslot save
      // edit timeslot overwrite values in timeslot array
        console.log("timeslotpointer",timeslotpointer);
        timeslots[timeslotpointer] = hhmm_to_minutes(id("ontime").value);     // change the values in the timeslot array
        timeslots[timeslotpointer+1] = hhmm_to_minutes(id("offtime").value);  // hh:mm to minutes
        savefromedit=0;
  }else{
        // push / add values pair to a new timeslot array             hh:mm to minutes
        timeslots.push(hhmm_to_minutes(id("ontime").value) , hhmm_to_minutes(id("offtime").value));
  }


/////////////////////////////////////////////////////////////////
// test nest
// try overlapping when sort is on
// timeslots.sort(function(a, b){return a - b});   // sort array following order of values
// should do something to prevent overlapping the pairs mix in new pairs
// make an aray in array, nested array? [[0,0],[0,0],[0,0]] do not know how to do that in javascript
// so that the paris stay pairs
//
// this creates a nested array from timeslots
// https://stackoverflow.com/questions/44937470/turning-an-array-into-a-multidimensional-array-javascript
timeslotsnested = timeslots.reduce((a, c, i) => {
  return i % 2 === 0 ? a.concat([timeslots.slice(i, i + 2)]) : a;
}, []);
//$('pre.message2').html("timeslotsnested"+JSON.stringify(timeslotsnested)); //jquery
id('message2').innerHTML = ("timeslotsnested"+JSON.stringify(timeslotsnested));//javascript
console.log("timeslotsnested ",timeslotsnested);

/*
(5) [Array(2), Array(2), Array(2), Array(2), Array(2)]
0: (2) [450, 990]
1: (2) [15, 135]
2: (2) [240, 285]
3: (2) [1200, 1440]
4: (2) [387, 402]
length: 5
*/
////////////////////////////
// sort a nested array???
sorted=timeslotsnested.sort((a,b) => a[0] - b[0]);
//$('pre.message3').html("nestedsorted"+JSON.stringify(sorted));  //jquery
id('message3').innerHTML = ("nestedsorted"+JSON.stringify(sorted));//javascript

console.log("nestedsorted?",sorted);
/*
nestedsorted?
(5) [Array(2), Array(2), Array(2), Array(2), Array(2)]
0: (2) [15, 135]
1: (2) [240, 285]
2: (2) [363, 1110]
3: (2) [450, 990]
4: (2) [1200, 1440]
length: 5
*/
////////////////////////////
// empty timemeslots array
var nestedsorted=sorted;
timeslots.length = 0;                            // Clear contents
// next line makes no sense?
// timeslots.push.apply(timeslots, nestedsorted);   // push put nestedsorted in timeslots

console.log("timeslots ",timeslots);

// go from nested array to single array again
var newArray = Array.prototype.concat.apply([], nestedsorted);
console.log("newArray",newArray);
timeslots.length = 0;                  // Clear contents
timeslots.push.apply(timeslots, newArray);
// thats silly, this is stupid
////////////////////////////////



/******************************************************
* block a timeslot to go / past overlap next timeslot
*******************************************************/
for (let i = 0; i < timeslots.length; i=i+2) {
 if(timeslots[i+1] >= timeslots[i+2]){            // compare off to next on
      timeslots[i+1]=timeslots[i+2];
      alert(`
      cannot create that endpoint,\n`
      +toHoursAndMinutes(timeslots[i+3])+
      ` not reached`
      +id("offtime").value+
      `\n`
      + toHoursAndMinutes(timeslots[i+1]) +
      `-`
      + toHoursAndMinutes(timeslots[i+2])  +
      ` remove`);

 }
}

// delete the points that are in middle of selection timeslot overlap
for (let i = 0; i < timeslots.length; i=i+2) {
  if(timeslots[i+1] == timeslots[i+2]){          // compare off to next on
      timeslots.splice( (i+1), 2);               // if off & next on the same, delete both from array
  }
}
//////////////////////////////////////////////
    console.log("timeslots ",timeslots);


    domessage();
    drawtimeslots();
    send_to_ESP();


}








/////////////////////////////////////////////////////////////////////////////////////////////
// write messsage to html <pre id="" or class=""> will be replaced, message goes here </pre>
/////////////////////////////////////////////////////////////////////////////////////////////
function domessage(){
    // next muttiline because use of ` = ~ tilde key lef side number keys keyboard
    // Alternatively known as acute, backtick, left quote, or an open quote,
    // the back quote or backquote is a punctuation mark (`).
    // It's on the same U.S. computer keyboard key as the tilde ~.

    // just for easy compare to minutes next hours array has no other use
    const hourarray=[];
    for (var i=0 ;  i < timeslots.length; i++) {
          hourarray[i]=toHoursAndMinutes(timeslots[i]);
    }


// when i compare this to other sites the vissiblity calculated is not correct
// https://hemel.waarnemen.com/applets/missiemaan.cgi
// https://www.kalender-365.nl/maan/actuele-maanstand.html
// they say 6% i get 15%
var moonval=moon.phase;
if(moon.phase > 0.5)moonval=1-moon.phase; // moon.phase  0.9220658851746119
console.log("moonval",moonval);
// moonval=0.25;                          // 0.07797258947334718; i get 16% other sites say 6%

// map moonval in range 0 to 0.5 to scale 0% to 100%
var moonvisible=Math.round(map_range(moonval,0,0.5,0,100));

// a message writen to <pre class="message"></pre> in the html
$('pre.message').html(`
    <p style=\"color:red\">timeslots array length `
    +timeslots.length+
    "<br>timeslots in minutes <br>"
    +timeslots+
    `<br><br>in hours<br>`
    +hourarray+`
    <br>moon.phase 0 to 1, 0,5 is full moon?<br>`
    +moon.phase+'<br>Moon visible '
    +moonvisible+
    `% (not correct, not square)</p>`);  // not squares, circle segments

}

var selected_highlight;


// left() of a sting maybe a bit Basica, GWBasic, Qbasic ;-)
// var num = "1008px".left(4);
// https://stackoverflow.com/questions/490508/left-function-in-javascript-or-jquery
String.prototype.left = function(n) {
    return this.substring(0, n);                 // return n number of characters on left side of string
}


/////////////////////////////////////
// drawtimeslots
/////////////////////////////////////
function drawtimeslots(){
// draw timeslots array


  id('innerDiv').style.left='';   // erase edit timeslot???????
  id('innerDiv').style.width='';
  id('startlabel').innerHTML='';
  id('endlabel').innerHTML='';
 // draw timeslots array
  $("div.timeslot").remove(); // remove all previous generated divs with Class timeslot
  $("div.slabel").remove(); // remove all previous generated divs with Class timeslot
  $("div.elabel").remove(); // remove all previous generated divs with Class timeslot
  $("div.startlabel").remove(); // remove all previous generated divs with Class timeslot
  $("div.endlabel").remove(); // remove all previous generated divs with Class timeslot
  for (let i = 0; i < timeslots.length; i=i+2) {
    console.log("timeslots[i] and [i+1]", timeslots[i]," ",timeslots[i+1]);


     var left=map_range(timeslots[i],  0,1440,0,100);              // scale time in range 0to1440 to 0 to 100%
     var width=map_range(timeslots[i+1],  0,1440,0,100)-left;      // scale time in range 0to1440 to 0 to 100%
     width=width.toFixed(2);   // to 2 decimals;
     console.log("left width",left," ",width);

    var timeslotcolor = "rgba(44,44, 99, 0.6)";   // use RGBA color opacity 0.6
    var label_opacity = 100;                      // opacity for timeslot time text labels
    var timeslot_opacity = 80;
    if(i == selected_highlight){
        timeslotcolor = "rgba(100,200, 250, 0.6)";  // use RGBA highlight color edit timeslot
        label_opacity = 60;                         // if edit timeslot, shade original timeslot time text labels
        timeslot_opacity = 40;
    }

// want to remove leading zero from timelabel
var ontext = toHoursAndMinutes(timeslots[i]);
console.log("ontext.left(1) ",ontext.left(1)+" "+ontext);
if (ontext.left(1)=="0"){ontext=ontext.substring(1);} // want to remove leading zero from timelabel
console.log("ontext.left(1) ",ontext.left(1)+" "+ontext);


// want to remove leading zero from timelabel
var offtext = toHoursAndMinutes(timeslots[i+1]);
console.log("offtext.left(1) ",offtext.left(1)+" "+offtext);
if (offtext.left(1)=="0"){offtext=offtext.substring(1);} // want to remove leading zero from timelabel
console.log("offtext.left(1) ",offtext.left(1)+" "+offtext);


// fontsize for time labels underneath the timeslots
// maybe if slots are close together, change fontsze to smaller
// or nouislider has a join merging https://refreshless.com/nouislider/examples/#section-merging-tooltips
// or do a webkit rotate label
var fontsize;          // nochange
// var fontsize = 12;  // px


    //debugger;

      // problem with opacity , timetext labels
      // The opacity of the parent's background sets the maximum perceived opacity of the child elements.
      // child div class "slabel" opacity can never be made greater as parent "timeslot"
      // thats why the time text labels are fade, and i can not change it
      // workaround set background-color RGBA color with opacity value in color for <div class="timeslot"

     $(".outerDiv").append(   // draw timeslots and textlabels underneath
          `<div class="timeslot" data-index="`
          +i+
          `" onclick="timeslotclicked(`+i+`)" style="position:absolute;height:50px;background-color:`
          +timeslotcolor+
          `;top:0px;left:`
          +left+
          `%;width:`
          +width+
          `%;z-index:40;opacity:`
          +timeslot_opacity+
          `%;">
          <div class="slabel" style="position: absolute; color: green; background-color: green; height: 20px; width: 1px; left: 0%; top: 55px;opacity:`
          +label_opacity+  // next child startlabel takes same opacity
          `%;">
          <div  class="startlabel" style="position: absolute; color: green; background-color: green; height: 0px; width: 1px; left: -17px; top: 15px;font-size:`
          +fontsize+
          `px;">`
          +ontext+
          `</div></div>
          <div class="elabel" style="position: absolute; color: red; background-color: red; height: 20px; width: 1px; left: 100%; top: 55px;opacity:`
          +label_opacity+  // next child endlabel takes same opacity
          `%;">
          <div class="endlabel" style="position: absolute; color: red; background-color: red; height: 0px; width: 1px; left: -17px; top: 30px;font-size:`
          +fontsize+
          `px;">`
          +offtext+
          `</div>
          </div>
          </div>`
     );

  } // end for

}




////////////////////////////////////////
// showhideeditpopup();             // toggle show hide on each call
// showhideeditpopup("show");       // show
// showhideeditpopup("hide");       // hide
////////////////////////////////////////
function showhideeditpopup(showorhide) {
  if (showorhide == "show") {
      id("editpopup").style.display = "block";           // show from function parameter   showhideeditpopup(show);
      document.body.style.backgroundColor="#c3c3c3";                              // make body background a little darker so that popup stands out?

  } else if (showorhide == "hide") {
      id("editpopup").style.display = "none";            // hide from function parameter     showhideeditpopup(hide);
      document.body.style.backgroundColor= "";                                  // reset body background to lighter shade

  }else {
    if (id("editpopup").style.display === "none") {      // toggle = show  showhideeditpopup();
      id("editpopup").style.display = "block";
      document.body.style.backgroundColor="#c3c3c3";                           // make body background a little darker so that popup stands out?

    } else {
      id("editpopup").style.display = "none";            // toggle = hide    showhideeditpopup();
      document.body.style.backgroundColor= "";                                   // reset body background to lighter shade

    }
  }
  drawtimeslots(); // if you close by x green selection may be left if not closed bij cancel or save
}








var innerdivclick=0;
var timeslotdivclick=0;
var sunclicked=0;
/////////////////////////////////
// think next is not used anymore
$( "#innerDiv" ).on( "click", function() {
    // $('pre.message').html("edit / remove timeslot popup");
    console.log("innerdiv clicked");
    innerdivclick=1;
 });
 // do not know open analog time picker if textlabel is clicked
$( "#startlabel" ).on( "click", function() {
    // $('pre.message').html("slabel click");
    console.log("slabel clicked");
    $("#ontime").focus();

    //return;
 });
  $( "#endlabel" ).on( "click", function() {
    // $('pre.message').html("elabel click");
    console.log("elabel clicked");
    $("#offtime").focus();
    //return;
 });

// think above is not used anymore
//////////////////////////////////////

// click on timescale added new slots inside timeslots
// https://stackoverflow.com/questions/5259191/disable-clicking-of-a-divs-element
//$(".outerDiv").children().bind('click', function(){
//  console.log("click event is turned off for this")
  //return false;
//});

// next no use

function sunriselabelclicked(){
  // call from HTML onclick
  sunclicked=1;                     // a flag to return from outerdiv click
  //showhideeditpopup("hide");
  console.log("function sunriselabelclicked(){");
  // maybe set ontime an hour before sunrisetime
  // maybe set offtime to sunrisetime
}



function sunsetlabelclicked(){
  // call from HTML onclick
  sunclicked=1;                     // a flag to return from outerdiv click
  //showhideeditpopup("hide");
  console.log("function sunsetlabelclicked(){");
  // maybe set ontime to sunsettime
  // maybe set offtime to hor after sunsettime
}


/*
$(document).on('click', '.sunriselabel', function(event) {
  event.stopPropagation();
  event.preventDefault();
  //sunclicked=1;
  //console.clear();
  console.log('sunrise Child Clicked');
});

$(document).on('click', '.sunsetlabel', function(event) {
  event.stopPropagation();
  event.preventDefault();
  //sunclicked=1;
  //console.clear();
  console.log('sunset Child Clicked');
});
*/


$( ".timeslot" ).on( "click", function() {
    console.log("timeslot function click");
});




/*
              _               _ _                          _ _      _
   ___  _   _| |_ ___ _ __ __| (_)_   __   ___  _ __   ___| (_) ___| | __
  / _ \| | | | __/ _ \ '__/ _` | \ \ / /  / _ \| '_ \ / __| | |/ __| |/ /
 | (_) | |_| | ||  __/ | | (_| | |\ V /  | (_) | | | | (__| | | (__|   <
  \___/ \__,_|\__\___|_|  \__,_|_| \_/    \___/|_| |_|\___|_|_|\___|_|\_\

Figlet font Standard https://run.plnkr.co/plunks/ZEkhoGgs4ntDZzT0/
*/
// $("#outerDiv").on("click", function(event) { // jquery
id( "outerDiv" ).addEventListener("click", function(event){    // javascript
  //event.stopPropagation();
  //event.preventDefault();
  selected_highlight = -1;        // erase edit timeslot highlight
  if(innerdivclick==1){           // outerdiv click comes after innerdivclick
    showhideeditpopup("show");
    innerdivclick=0;
    return;                       // i want to return to the innerdiv click
  }
   if(timeslotdivclick==1){       // outerdiv click comes after innerdivclick
    timeslotdivclick=0;
    return;                       // i want to return to the timeslotdivclick
  }

  if(sunclicked==1){              // outerdiv click comes after innerdivclick
    sunclicked=0;
    return;                       // i want to return to the timeslotdivclick
  }

   id("addoredit").innerHTML="Add New TimeSlot";                 // text on showhideeditpopup changes from add or edit timeslot
   id("deletebutton").disabled = true;  // greyout disable the delete button
   id("deletebutton").hidden = true;    // hide the delete button
   showhideeditpopup("show");

   // $('pre.message').html("new add / edit / save timeslot popup");
   console.log("outerdiv clicked");
   savefromedit=0;
   let outerDiv = id('outerDiv');


  id('innerDiv').style.width = event.clientX-outerDiv.offsetLeft+'px';
  console.log("mouse click x position on outerdiv ",event.clientX-outerDiv.offsetLeft);
  console.log("outerDiv width ",outerDiv.offsetWidth);

         // map_range returns a float that does not work for later convert to hh:mm
         // but the float is better for left% width% scaling otherwise the selections are of target
  var clickposinminutes=Math.round(map_range((event.clientX-outerDiv.offsetLeft),0, outerDiv.offsetWidth,0,1440));
  console.log("clickposinminutes ",clickposinminutes);

  var hhmm=toHoursAndMinutes(clickposinminutes);              // add 15 minutes for timeslot
  var hhmmplus15=toHoursAndMinutes(clickposinminutes+15);
  if(clickposinminutes+15>=1440)hhmmplus15="24:00";
  console.log("hhmm ",hhmm);
  id("ontime").value=hhmm;               // set on time textfield
  id("offtime").value=hhmmplus15;        // set off time textfield

  drawtemp();
});















// https://stackoverflow.com/questions/60923136/how-to-get-the-width-on-where-the-mouse-clicks-a-div
function changeWidth(event) {
/*
  let outerDiv = document.getElementById('outerDiv');

  document.getElementById('innerDiv').style.width = event.clientX-outerDiv.offsetLeft+'px';
  console.log(event.clientX-outerDiv.offsetLeft);
  console.log(outerDiv.offsetWidth);

  var clickposinminutes=map_range((event.clientX-outerDiv.offsetLeft),0, outerDiv.offsetWidth,0,1440)
  console.log("clickposinminutes ",clickposinminutes);
  var hhmm=toHoursAndMinutes(clickposinminutes);
  var hhmmplus15=toHoursAndMinutes(clickposinminutes+15);
  if(clickposinminutes+15>=1440)hhmmplus15="24:00";
  console.log("hhmm ",hhmm);
  document.getElementById("ontime").value=hhmm;
  document.getElementById("offtime").value=hhmmplus15;

  drawtemp();
  */
}



///////////////////////////////////////////////////////////////////////////
// arduino alike map function == Re-maps a number from one range to another.
// https://www.arduino.cc/reference/en/language/functions/math/map/
// https://stackoverflow.com/questions/5649803/remap-or-map-function-in-javascript
// scale range 1 into range2 bar range to 0 to 1440 minute range
// or
// scale a minutevalue in range 0 to 1440 minutes to 0% to 100%,  used for left and width of timeslot divs
///////////////////////////////////////////////////////////////////////////////
function map_range(value, low1, high1, low2, high2) {
    return (low2 + (high2 - low2) * (value - low1) / (high1 - low1)).toFixed(3);   // to 3 decimals, Math.round did not scale right
}



///////////////////////////////////////////////////////////////
// 0 to 1440 minutes in a day convert timeinminutes to hh:mm
// https://codingbeautydev.com/blog/javascript-convert-minutes-to-hours-and-minutes/#:~:text=To%20convert%20minutes%20to%20hours%20and%20minutes%20in%20JavaScript%2C%20divide,the%20remainder%20of%20the%20division.
/////////////////////////////////////////////////////////////////////////////
function toHoursAndMinutes(totalMinutes) {
  if(totalMinutes>=1440)totalMinutes=1440;       // max 24:00
  var hours = Math.floor(totalMinutes / 60);
  var minutes = totalMinutes % 60;
  if (hours<=9){hours='0'+hours;}
  if (minutes<=9){minutes='0'+minutes;}         // add a zero if <= 9

  return (hours+":"+minutes) ;
}



/////////////////////////////////////
// convert hh:mm to time in minutes
////////////////////////////////////
function hhmm_to_minutes(hhmm) {
  console.log("hhmm_to_minutes(hhmm) ",hhmm);

  var hhmm_array = hhmm.split(':');                                       // split hh:mm  at the colons
  var timeinminutes = (+hhmm_array[0]) * 60 + (+hhmm_array[1]);          // Hours are worth 60 minutes

  console.log("timeinminutes ",timeinminutes);

  return (timeinminutes) ;
}




//////////////////////////////////////////
// draw selection on bar from text input
/////////////////////////////////////////
function drawtemp (){
  // document.getElementById("ontime").value;                                     // get time from on text field
  // document.getElementById("offtime").value;                                    // get time from off text field


  if(id("offtime").value == "00:00"){
        id("offtime").value="24:00";                         // if offtime is 00:00 set it to 24:00
  }


  var startminutes = hhmm_to_minutes(id("ontime").value);    // convert hh:mm to minutes
  var endminutes = hhmm_to_minutes(id("offtime").value);     // convert hh:mm to minutes

  console.log("start / endminutes",startminutes," / ",endminutes)

  var divwidth=outerDiv.offsetWidth;

  // console.log("map div pos",map_range(startminutes,  0,1440,0,divwidth));
  // console.log("map div pos",map_range(endminutes,  0,1440,0,divwidth));

// better not in pixels /////////////////////////////
      var startpos=map_range(startminutes,  0,1440, 0,(outerDiv.offsetWidth));   // scale startminutes in  range 0...1440 to div size
      var endpos=map_range(endminutes,  0,1440, 0,(outerDiv.offsetWidth));       // scale endminutes in  range 0...1440 to div size
      id('innerDiv').style.left=(startpos)+'px';
      id('innerDiv').style.width=(endpos-startpos)+'px';
// do left and width in % not in px
// do it again better in % above in px did strange on screen rotate
      var startpos = map_range(startminutes,  0,1440, 0,100);                    // scale startminutes in  range 0...1440 to 0 to 100%
      var endpos = map_range(endminutes,  0,1440, 0,100);                        // scale endminutes in  range 0...1440 to 0 to 100%
      id('innerDiv').style.left=(startpos)+'%';             // set left%
      id('innerDiv').style.width=(endpos-startpos)+'%';     // set width %
//////////////////////////////////////////////////

  id('startlabel').innerHTML=id("ontime").value;      // write hh:mm to label
  id('endlabel').innerHTML=id("offtime").value;       // write hh:mm to label

}






////////////////////////////////////////
// create the slider numbers and scale
// https://codepen.io/ldijkman/pen/XWyBPpG
///////////////////////////////////////
var pips = 96;                                // 24hour x 4quarters

for (i = 0; i <= pips; i = i + 1) {
  var number;
  var imod4 = i % 4;                          // for hour numbers
  // console.log("imod4", imod4);

  if (imod4 == 0) {
    number = i / 4;                            // for hour numbers
  } else {
    number = "";                               // no number for 15, 30, 45, minutes
  }

  var ruler = $(
    '\n\n<span class="ruler-pip">\n<span class="ruler-line" style="width:2px; color:black;"></span>\n<span class="ruler-number" style="position:absolute;">' +
      number +
      "</span>\n"
  );

  ruler.css({ left: "" + ((100 / pips) * i).toFixed(3) + "%" });
  ruler.css({ position: "absolute" });

  ruler.css({ top: "32px" });

  // console.log("left ", ((100 / pips) * i).toFixed(1), "%"); // 1 decimals

  $(".outerDiv").append(ruler);


  if (imod4 == 0) {
    $(".ruler-line").eq(i).css("height", "35px");       // hour line
    $(".ruler-line").eq(i).css("width", "2px");
    $(".ruler-line").eq(i).css("background", "black");
    $(".ruler-line").eq(i).css("left", "-1px");
  }
  if (imod4 == 1) {
    $(".ruler-line").eq(i).css("height", "10px");       // 15 minute line
    $(".ruler-line").eq(i).css("width", "1px");
    $(".ruler-line").eq(i).css("background", "gray");
    $(".ruler-line").eq(i).css("left", "-0.5px");
  }
  if (imod4 == 2) {
    $(".ruler-line").eq(i).css("height", "20px");       // 30 minute line
    $(".ruler-line").eq(i).css("width", "1px");
    $(".ruler-line").eq(i).css("background", "gray");
    $(".ruler-line").eq(i).css("left", "-0.5px");
  }
  if (imod4 == 3) {
    $(".ruler-line").eq(i).css("height", "10px");       // 45 minute line
    $(".ruler-line").eq(i).css("width", "1px");
    $(".ruler-line").eq(i).css("background", "gray");
    $(".ruler-line").eq(i).css("left", "-0.5px");
  }
}

$(".outerDiv").append(
  '<div class="selection" style="position:absolute;height:55px;background-color:green;opacity:50%;top:20px;left:50%;z-index:-1;"></div>'
);
//////////////////////////////////////////////
// END // create the slider numbers and scale
//////////////////////////////////////////////













// add div for time text label below timeslot selection
// you do not see this in the browser view page source
// use chrome browser inspect to see this in the generated source
$('#innerDiv').append('<div id="slabel" style="position: absolute; color: green; background-color: green; height: 20px; width: 1px; left: 0%; top: 55px;"><div  id="startlabel" style="position: absolute; color: green; background-color: green; height: 0px; width: 1px; left: -20px; top: 15px;"></div></div>');
// endlabel bit lower so they do not overlap when close to eachother
$('#innerDiv').append('<div id="elabel" style="position: absolute; color: red; background-color: red; height: 20px; width: 1px; left: 100%; top: 55px;"><div id="endlabel" style="position: absolute; color: red; background-color: red; height: 0px; width: 1px; left: -20px; top: 30px;"></div></div>');


// add divs for sunrise actualtime and sunset line and label
// you do not see this in the browser view page source
// use chrome browser inspect to see this in the generated source
$('.outerDiv').append('<div id="actualtime" class="actualtime" style="position: absolute; color: red; background-color: red; height: 30px; width: 1px; left: 50%; top:-30px;"><div id="acttimelabel" class="acttimelabel" style="position: absolute;top:-60px;left:-30px;border: 0px solid green;"></div></div>');
$('.outerDiv').append('<div id="sunrisel" class="sunrisel" style="position: absolute; color: grey; background-color: green; height: 40px; width: 1px; left: 0%; top: -40px;"><div id="sunriselabel" class="sunriselabel" onclick="sunrise_label_clicked()" style="position: absolute;top:-20px;left:-20px;border: 0px solid green;z-index:2000;"> sunrise</div></div>');
$('.outerDiv').append('<div id="sunsetl" class="sunsetl" style="position: absolute; color: grey; background-color: green; height: 40px; width: 1px; left: 100%; top: -40px;"><div id="sunsetlabel" class="sunsetlabel" onclick="sunset_label_clicked()" style="position: absolute;top:-20px;left:-20px;border: 0px solid green;z-index:2000;"> sunset</div></div>');


// add 3 divs for night shade and dayshine
// sunrise width % is later set changed
// sunset left % and width % is later set changed
// dayshine left % and width % is later set changed
// you do not see this in the browser view page source
// use chrome browser inspect to see this in the generated source
// z-index:-1 stops parent child clicks
$('.outerDiv').append('<div class="morning_shade" style="position:absolute;height:20px;background-color:gray;opacity:20%;top:-20px;z-index:-1;"></div>');
$('.outerDiv').append('<div class="dayshine" style="position:absolute;height:20px;background-color:yellow;opacity:20%;top:-20px;z-index:-1;"></div>');
$('.outerDiv').append('<div class="evening_shade" style="position:absolute;height:20px;background-color:gray;opacity:20%;top:-20px;z-index:-1;" ></div>');







// https://github.com/mourner/suncalc
// https://www.latlong.net/

// do not know make it global
var times;
var sunrisemin;
var sunriseStr;
var sunsetmin;
var sunsetStr;
var moon;

// get today's sunlight times for                          // https://www.latlong.net/
// geolocation for sunrise sunset
// var lat=52.7354;
// var lon=5.1790;
function dogeoloc(){
  var lat=id('lat').value;
  var lon=id('lon').value;
  console.log(lat," : ",lon);
  times = SunCalc.getTimes(new Date(),lat,lon);


 moon = SunCalc.getMoonIllumination(new Date());
 console.log("moon ", moon);
console.log("moon.phase ", moon.phase);

// format sunrise time from the Date object
 sunrisemin =times.sunrise.getMinutes();
if(sunrisemin<=9)sunrisemin="0"+sunrisemin;                     // 0-9 add a zero
var sunriseStr = times.sunrise.getHours() + ':' + sunrisemin;

sunsetmin =times.sunset.getMinutes();
if(sunsetmin<=9)sunsetmin="0"+sunsetmin;                        // 0-9 add a zero
sunsetStr = times.sunset.getHours() + ':' + sunsetmin;

var currents=((times.sunrise.getHours()*60+times.sunrise.getMinutes())/1440)*100; ;
  for (let i = 0; i < 1; i++) {
   //document.getElementsByClass('sunrisel')[i].style.left = currents+"%";   // time to percentage 0 to 100% set div position

   //document.getElementsByClass('sunrisel')[i].innerHTML = "<br><br><br>sunrise "+times.sunrise.getHours()+":"+sunrisemin; // set time text on div class actualtime
  }

var currents=((times.sunset.getHours()*60+times.sunset.getMinutes())/1440)*100; ;
  for (let i = 0; i < 1; i++) {
   //document.getElementsByClass('sunsetl')[i].style.left = currents+"%";   // time to percentage 0 to 100% set div position

   //document.getElementsByClass('sunsetl')[i].innerHTML = "<br><br><br>sunset "+times.sunset.getHours()+":"+sunsetmin; // set time text on div class actualtime
  }

// get position of the sun (azimuth and altitude) at today's sunrise
/////var sunrisePos = SunCalc.getPosition(times.sunrise, 52.7354, 5.1790);

// get sunrise azimuth in degrees
/////var sunriseAzimuth = sunrisePos.azimuth * 180 / Math.PI;

// https://github.com/mourner/suncalc
console.log(times);

console.log("sunrise "+sunriseStr);
console.log("sunset "+sunsetStr);

//console.log(sunrisePos);
//console.log(sunriseAzimuth);
//document.getElementsByClass('sunrise')[0].innerHTML =("<a href='http://www.google.com/search?q=52.7354,5.1790'>52.7354, 5.1790 </a> sunrise "+sunriseStr)+" ";
//document.getElementsByClass('sunset')[0].textContent =(" sunset "+sunsetStr)+" ";
//document.getElementsByClass('sunrise')[1].innerHTML =("<a href='http://www.google.com/search?q=52.7354,5.1790'>52.7354, 5.1790 </a> sunrise "+sunriseStr+" ");
//document.getElementsByClass('sunset')[1].textContent =(" sunset "+sunsetStr)+" ";

/*
const sunrise = document.querySelectorAll('.sunrise');
sunrise.forEach(sunrise => {
  //box.style.backgroundColor = 'purple'; box.style.width = '300px';
  //sunrise.innerHTML =("<!--"+lat+","+lon+"--> <a href='http://www.google.com/search?q="+lat+","+lon+"'>SunRise "+sunriseStr)+" </a>";
});



const sunset = document.querySelectorAll('.sunset');
sunset.forEach(sunset => {
  //box.style.backgroundColor = 'purple'; box.style.width = '300px';
  //sunset.innerHTML =("<a href='http://www.google.com/search?q="+lat+","+lon+"'>SunSet "+sunsetStr)+"</a>   ";
});
*/
}


 dogeoloc();





///////////////////////////////////////////////////////////////////////////
// doiteverysecond() doiteverysecond() doiteverysecond() doiteverysecond()
///////////////////////////////////////////////////////////////////////////
function doiteverysecond() {

  // console.log("Using JavaScript version:", navigator.userAgent);
  // console.log("websocket.readyState ",websocket.readyState;

  if(window.innerHeight > window.innerWidth){
        id('pleaserotatetolandscape').innerHTML="<h4>Rotate device to LandScape?</h4>";
  }else{
        // erase rotatemessage if in landscape"
        id('pleaserotatetolandscape').innerHTML="";
  }


  if(self!==top){     // if document is iframed show a message,   Go Full Screen,it works Better!
        id("gofullscreenmessage").innerHTML='<h3><a href="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/create_from_scratch/index.html" target="fullscreen">Go Full Screen,it works Better!</a></h3>';
  }else{      // erase
        id("gofullscreenmessage").innerHTML="";
  }


  const now = new Date();
  const current = (((now.getHours() * 60) + now.getMinutes())/1440)*100;       // time to percentage 0 to 100% set div position
  var sec;
  var min;

  var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
  var dayName = days[now.getDay()];




  if(now.getMinutes()<=9)min="0"+now.getMinutes(); else min=now.getMinutes();  // a leading zer0 if 0 to 9
  if(now.getSeconds()<=9)sec="0"+now.getSeconds(); else sec=now.getSeconds();  // a leading zer0 if 0 to 9

 for (let i = 0; i < 1; i++) {
      classname('actualtime')[i].style.left = current+"%";   // time to percentage 0 to 100% set div position

      classname('actualtime')[i].innerHTML = "<div id=\"acttimelabel\" class=\"acttimelabel\" style=\"position: absolute;top:-60px;left:-30px;border: 0px solid green;z-index:-1;\">" +dayName+" "+now.getHours()+":"+min+":"+sec+"</div>"; // set time text on div class actualtime
 }

 var currents=((times.sunrise.getHours()*60+times.sunrise.getMinutes())/1440)*100; ;
  var sunrisecur=currents;
  for (let i = 0; i < 1; i++) {
      classname('sunrisel')[i].style.left = currents+"%";   // time to percentage 0 to 100% set div position

      classname('sunrisel')[i].innerHTML = "<div id=\"sunriselabel\" class=\"sunriselabel\" onclick=\"sunriselabelclicked()\" style=\"position: absolute;top:-35px;left:-20px;border: 0px solid green;\"> sunrise "+times.sunrise.getHours()+":"+sunrisemin; +"</div>";// set time text on div class actualtime

      classname('evening_shade')[i].style.width= currents+"%";  // gray shade before sunrise
  }

var currents=((times.sunset.getHours()*60+times.sunset.getMinutes())/1440)*100; ;
  var sunsetcur=currents;
  for (let i = 0; i < 1; i++) {
      classname('sunsetl')[i].style.left = currents+"%";   // time to percentage 0 to 100% set div position

      classname('sunsetl')[i].innerHTML = "<div id=\"sunriselabel\" class=\"sunsetlabel\" onclick=\"sunsetlabelclicked()\" style=\"position: absolute;top:-35px;left:-20px;border: 0px solid green;z-index:0;\"> sunset "+times.sunset.getHours()+":"+sunsetmin+"</div>"; // set time text on div class actualtime

      classname('morning_shade')[i].style.width= (100-currents)+"%";  // gray shade before sunrise

      classname('morning_shade')[i].style.left= currents+"%";

      classname('dayshine')[i].style.left= sunrisecur+"%";
      classname('dayshine')[i].style.width= (100-sunrisecur)+(sunsetcur-100)+"%";
  }


}
///////////////////////////////////////////////////////////////////////
// end doiteverysecond()  end doiteverysecond()  end doiteverysecond()
///////////////////////////////////////////////////////////////////////









//////////////////////
// DOMContentLoaded
/////////////////////
document.addEventListener('DOMContentLoaded', function() {      // do next when document is loaded

    // https://github.com/loebi-ch/jquery-clock-timepicker
    $('#ontime').clockTimePicker({alwaysSelectHoursFirst:true,labeltext:"<font style='font-size: 15px;'> ON time</font><br>"});  // activate analog timepicker popup for id ontime text field
    $('#offtime').clockTimePicker({alwaysSelectHoursFirst:true,labeltext:"<font style='font-size: 15px;'> OFF time</font><br>"}); // activate analog timepicker popup for id offtime text field

    dragElement(id("editpopup"));            // make editpopup draggable by mouse and touch

    drawtemp();
    domessage();
    showhideeditpopup();
    drawtimeslots();

    // select day, set radio day to today,  makes label for radiobutton green
    var daynr=new Date().getDay();                  // 0=sunday ... 6=saturday
    if (daynr==0)daynr=7;
    console.log("daynr ",daynr);
    // $('.radioday')[daynr-1].checked="true";                                // jquery
    classname('radioday')[daynr-1].checked="true";      // javascript
    // 0=monday ... 6=sunday
    checkit();

    setInterval(doiteverysecond, 1000); // Milliseconds  call function doiteverysecond() every second




}, false);
//////////////////////
// END DOMContentLoaded
/////////////////////



/////////////////////////////
// show or hide About popup
////////////////////////////
function showhideabout() {
  if (id("aboutDIV").style.display === "none") {
    id("aboutDIV").style.display = "block";
     // should be something to block scrolling of body
     // only popup scroll
     // https://codepen.io/anon/pen/oEMmrm
  } else {
    id("aboutDIV").style.display = "none";
  }
}



/////////////////////////////////////////////////////////////////////
// Make the DIV add or edit popup element draggable:
// https://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_draggable
// touch should be added == think it works , touch me
// https://stackoverflow.com/questions/56703458/how-to-make-a-draggable-elements-for-touch-and-mousedrag-events
// https://codepen.io/ldijkman/pen/abQxbdM
//////////////////////////////////////////////////////////////////////
function dragElement(elmnt) {
  let pos1 = 0,
      pos2 = 0,
      pos3 = 0,
      pos4 = 0;

  let dragHandle = id("editpopupheader");

  if (dragHandle !== undefined) {
    // if present, the header is where you move the DIV from:
    dragHandle.onmousedown = dragMouseDown;
    dragHandle.ontouchstart = dragMouseDown; //added touch event
  } else {
    // otherwise, move the DIV from anywhere inside the DIV:
    elmnt.onmousedown = dragMouseDown;
    elmnt.ontouchstart = dragMouseDown; //added touch event
  }

  function dragMouseDown(e) {
    e = e || window.event;
    e.preventDefault();

    //Get touch or click position
    //https://stackoverflow.com/a/41993300/5078983
    if (
      e.type == "touchstart" ||
      e.type == "touchmove" ||
      e.type == "touchend" ||
      e.type == "touchcancel"
    ) {
      let evt = typeof e.originalEvent === "undefined" ? e : e.originalEvent;
      let touch = evt.touches[0] || evt.changedTouches[0];
      x = touch.pageX;
      y = touch.pageY;
    } else if (
      e.type == "mousedown" ||
      e.type == "mouseup" ||
      e.type == "mousemove" ||
      e.type == "mouseover" ||
      e.type == "mouseout" ||
      e.type == "mouseenter" ||
      e.type == "mouseleave"
    ) {
      x = e.clientX;
      y = e.clientY;
    }

    console.log("drag start x: " + x + " y:" + y);

    // get the mouse cursor position at startup:
    pos3 = x;
    pos4 = y;
    document.onmouseup = closeDragElement;
    document.ontouchend = closeDragElement;
    // call a function whenever the cursor moves:
    document.onmousemove = elementDrag;
    document.ontouchmove = elementDrag;
  }
  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();

    //Get touch or click position
    //https://stackoverflow.com/a/41993300/5078983
    if (
      e.type == "touchstart" ||
      e.type == "touchmove" ||
      e.type == "touchend" ||
      e.type == "touchcancel"
    ) {
      let evt = typeof e.originalEvent === "undefined" ? e : e.originalEvent;
      let touch = evt.touches[0] || evt.changedTouches[0];
      x = touch.pageX;
      y = touch.pageY;
    } else if (
      e.type == "mousedown" ||
      e.type == "mouseup" ||
      e.type == "mousemove" ||
      e.type == "mouseover" ||
      e.type == "mouseout" ||
      e.type == "mouseenter" ||
      e.type == "mouseleave"
    ) {
      x = e.clientX;
      y = e.clientY;
    }

    // calculate the new cursor position:
    pos1 = pos3 - x;
    pos2 = pos4 - y;
    pos3 = x;
    pos4 = y;
    // set the element's new position:
    elmnt.style.top = elmnt.offsetTop - pos2 + "px";
    elmnt.style.left = elmnt.offsetLeft - pos1 + "px";
  }

  function closeDragElement() {
    console.log("drag end x: " + pos3 + " y:" + pos4);
    // stop moving when mouse button is released:
    document.onmouseup = null;
    document.ontouchcancel = null;                      // added touch event
    document.ontouchend = null;                         // added touch event
    document.onmousemove = null;
    document.ontouchmove = null;                        // added touch event

    selected_highlight=-1;                              // erase edit timeslot highlight
  }
} // end function dragMouseDown(e) {

</script>






<!--
  ///////////////////////////
  // begin editpopup HTML
  //////////////////////////
  -->
<div id="editpopup">
 <div id="editpopupheader" class="drag-handle">
    <div id="closeedit">Please Drag Me ?<button onclick="showhideeditpopup()" style="border-color:red; color:red;position:absolute;left:85%;">
      <b>X</b></button>
    </div>
 </div>
  <br>
 <div id="addoredit">add / edit  a time slot<!--this text will be changed to add or edit--></div><br>

    <input type="text" class="ontime"  id="ontime" readonly style="color:green;" size="6"   oninput="drawtemp()"  value="07:30" onchange="drawtemp();console.log('Time changed to: ' + this.value)"/>
<input type="text" class="offtime"  id="offtime" readonly style="color:red;" size="6"   oninput="offtimechange();drawtemp()"  value="16:30" change="offtimechange();" onchange="offtimechange();drawtemp();console.log('Time changed to: ' + this.value)"/>
  <br><br>
<input type="button" value="Cancel" onclick="cancelbutton()">
<input type="button" value="Save" onclick="savetimeslot()">
<br><br>
<input type="button" id="deletebutton" value="Delete" onclick="deletebutton()">
<br><br>
<font color="green"">
<small>Touch drag is Working ;-) ???</small>
</font>
<br>
</div>
</div>
<!--
  ////////////////////////
  // end editpopup HTML
  ///////////////////////
  -->


<!--
  ////////////////////////
  // begin aboutdiv HTML
  ///////////////////////
  -->

  <div id="aboutDIV" style="position: fixed;
  width: 98%;
  top:0%;
  padding: 10px 0;
  text-align: center;
  background-color: lightgray;borderColor:black;border:5px solid;border-radius:10px;
  margin-top: 10px;display:none;z-index:1001;overflow-y:scroll; height:100%;overscroll-behavior: contain;">

 <div id="closeit" style="
 position: fixed;
 display: absolute;
 float:right;right: 2em;">
    <button onclick="showhideabout()" style="border-color:red; color:red;"><b>X</b></button>
  </div><h1>Visual Scheduler / Graphical Scheduler</h1>

  <br>Visual TimeSlot Scheduler<br>
Easy Set and Overview Scheduled timeslots<br>
Touch Friendly Scheduler<br>
<br>
Create a scheduler from scratch <br>
(a bit like Plasma-Cloud WiFi POE Scheduler / Apple Elgato Eve Schedule)<br>
<br>
Visual Scheduler for irrigation, sprinklers, lights, wifi relays, wifi switches<br>
  irrigation Scheduler, Sprinkler Scheduler, Light Scheduler, WiFi relays Scheduler, WiFi switches Scheduler<br>
  Time Activated Relays - Relay Control on a Schedule<br>
  daily scheduler, weekly scheduler, timed switching<br>
  visual timed automation, etcetera <a href="https://www.youtube.com/watch?v=mfJhMfOPWdE" target="blahblah">BlahBlah!</a><br>
  <br>
  Youtube Video <a href="https://youtu.be/GQpa_UIErT0" target="youtube">https://youtu.be/GQpa_UIErT0</a><br>
  Do not forget to Subscribe at the end of the video ?! ;-)<br>
  Better Youtube Video <a href="https://youtu.be/17K2TtYPI_A" target="youtube">better youtube video, served from ESP32 ace editor websockets</a><br>
  Do not forget to Subscribe at the end of the video ?! ;-)<br>
  <br>
  <a href="https://youtu.be/Uy8vY94GGuE" target="phonehome">youtube video => Add icon link to phone home screen</a><br>
  <br>
  <br>
  <center>
  <hr>
   Sources used<br>
   <hr>
  <a href="https://plugins.slyweb.ch/jquery-clock-timepicker" target="jquery-clock-timepicker">plugins.slyweb.ch/jquery-clock-timepicker</a>
  <br><br>
  <a href="https://github.com/mourner/suncalc" target="suncalc">github.com/mourner/suncalc</a>
  <br><br>
  <a href="https://github.com/kaimallea/isMobile" target="ismobile">github.com/kaimallea/isMobile</a>
  <br><br>
  <a href="https://www.w3schools.com" target="w3schools">www.w3schools.com</a>
  <br><br>
  <a href="https://stackoverflow.com" target="stackoverflow">stackoverflow.com</a><br>
  <br>


  <hr>
  <br>
  open HTML/CSS/Javascript, not closed like apps with wifi wall switches<br>
  Possble to Edit it with Ace editor on ESP8266 / ESP32 webserver<br>
  <br>
  on phone<br>
  from browser, save to phone home screen<br>
  and it almost looks like an app without the addres location bar<br>
  <br>
  <br>
  <a href="https://facebook.com/luberth.dijkman" target="facebook">facebook.com/luberth.dijkman</a><br>
  <br>
  <a href="https://github.com/ldijkman/randomnerd_esp32_wifi_manager/tree/main/docs/mrs" target="mrs_github">github mrs visual scheduler</a><br>
  <br>
  <a href="https://plnkr.co/edit/p7xyOMhDtuTc49aZ" target="plunker">//plnkr.co/edit/p7xyOMhDtuTc49aZ</a><br>
  <br>
  <a href="https://github.com/ldijkman/randomnerd_esp32_wifi_manager/discussions" target="discussions">github discussions</a><br>
  <br>
  Sorry for the kindergarden aged, there is no AM/PM<br>
  <br>
  <br>
  Free for personal use.<br>
  Not free for commercial use.<br>
  Copyright Dirk Luberth Dijkman 2023 ... <script>document.write(new Date().getFullYear())</script><br>
  <br>
  <br>
  <button onclick="showhideabout()" style="color:green;">Accept!</button><br>
  <br><br><br><br><br><br><br><br>
</div>

  <div id="about" style="position: fixed; top: 1em; right: 1em;">
    <button onclick="showhideabout()" style="border-color:green; color:green;"><b>?</b></button>
  </div>
<!--
  //////////////////////
  // end  aboutdiv HTML
  //////////////////////
  -->

<br><br>

<input type="button" onclick="showhideabout()" value="About"><br>
<!-- Copyright Dirk Luberth Dijkman 2023 -->
<br><br>
<small><small><small>
Free for personal use.<br>
Not free for commercial use.<br>
Copyright Dirk Luberth Dijkman 2023 ... <script>document.write(new Date().getFullYear())</script></small></small></small>
<!-- https://stackoverflow.com/questions/4562587/shortest-way-to-print-current-year-in-a-website -->


<br><br>
<!--
webcam for sound in my youtune videos screen recordings<br>
-->
<button class="btn btn-primary" id="button">Display Webcam feed in Picture-in-Picture mode</button>
<script>
const button = document.getElementById('button');

button.addEventListener('click', async () => {
  const video= document.createElement('video');
  //video.muted = true;
  video.srcObject = await navigator.mediaDevices.getUserMedia({ video: true });
  video.play();
  video.addEventListener('loadedmetadata', () => {
    video.requestPictureInPicture()
    .catch(console.error)
  });
});
    </script>
<br><br>it is Almost Time to Switch<!--it is Time to SWitch - SwitchTime--><br>
    <img src="https://media.s-bol.com/N15Y8Y0kYB9p/D9BL5K/1200x1172.jpg" width="150px" height="150px"><br>
</body>
</html>


<!--
David Bird G6EJD would say it like next:

This software, the ideas and concepts is Copyright (c) Dirk Luberh Dijkman Bangert 30 Andijk The Netherlands 2023 and beyond.
All rights to this software are reserved.

***DO NOT USE THIS SOFTWARE IF YOU CAN NOT AGREE TO THESE LICENCE TERMS ***

It is prohibited to redistribute or reproduce of any part or all of the software contents in any form other than the following:
 1. You may print or download to a local hard disk extracts for your personal and non-commercial use only.
 2. You may copy the content to individual third parties for their personal use, but only if you acknowledge the author Dirk Luberth Dijkman as the source of the material.
 3. You may not, except with my express written permission, distribute or commercially exploit the content.
 4. You may not transmit it or store it in any other website or other form of electronic retrieval system for commercial purposes.
 5. You MUST include all of this copyright and permission notice ('as annotated') and this shall be included in all copies or substantial portions of the software and where the software use is visible to an end-user.

THE SOFTWARE IS PROVIDED "AS IS" FOR PRIVATE USE ONLY, IT IS NOT FOR COMMERCIAL USE IN WHOLE OR PART OR CONCEPT.

FOR PERSONAL USE IT IS SUPPLIED WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.

IN NO EVENT SHALL THE AUTHOR OR COPYRIGHT HOLDER BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

Elon Musk do not use this scheduler to launch your trip to Mars


https://search.google.com/test/mobile-friendly?url=https%3A%2F%2Fldijkman.github.io%2Frandomnerd_esp32_wifi_manager%2Fmrs%2Fcreate_from_scratch%2Findex.html
-->



   Wich Ladder Will it be,                        
                            https://youtu.be/l9wejBgCiT4
  
  
	 </textarea>
    </div>
  
   <div class="resizer" id="dragMe"></div>
    <div class="container__right">
            <div id="preview">
            </div>
  </div> 
</div>    
  
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/ace.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/ext-keybinding_menu.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/ext-prompt.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/ext-language_tools.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/mode-html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/mode-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/mode-css.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/mode-c_cpp.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/snippets/html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/snippets/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/snippets/css.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/worker-html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/worker-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/worker-css.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/ext-searchbox.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/worker-base.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/ext-beautify.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/ext-settings_menu.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/ext-keybinding_menu.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/ext-spellcheck.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.29.0/ext-emmet.min.js" integrity="sha512-3lADipRXib6VcyVdmfwWp6vIqvY7YY9tFtt8ynRTzNxZ38Or0xcrJpGaUzmR64UoV7Vf8Zvj0cu+nqytchBErw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://ldijkman.github.io/Ace-Editor-Click-Link-window.open-URL/hoverlink.js"></script>
<!--  https://github.com/ldijkman/Ace-Editor-Click-Link-window.open-URL/tree/main/docs 


<script type="text/javascript" src="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/Ace_color/ace-colorpicker-min.js" ></script>

-->

<script type="text/javascript" src="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/Ace_color/ace-colorpicker.js" ></script>

<link rel="stylesheet" href="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/Ace_color/ace-colorpicker.css" />




<link rel="stylesheet" href="https://ldijkman.github.io/Ace_Seventh_Heaven/ace_settingsmenu.css" />



<script>
function id(id) {
  return document.getElementById(id);
}

var editor = ace.edit("editor")
var beauty = ace.require("ace/ext/beautify")

ace.require("ace/ext/language_tools")
ace.require("ace/ext/emmet")     // do not know what emmet is and does
editor.setTheme("ace/theme/vibrant_ink")
editor.session.setMode("ace/mode/html", function() {
	LoadColorPicker()
})
  function LoadColorPicker() {
    console.log("load colorpicker now in function LoadColorPicker");
    window.editor = ace.edit("editor");
    AceColorPicker.load(ace, editor);
  }
    var Range = ace.require('ace/range').Range // get reference to ace/range
    ace.require("ace/ext/language_tools");
    //ace.require('ace/ext/ext-linking'); // not sure if this is correct ace/ext/linking
	  ace.require("ace/ext/emmet");          // do not know what emmet is and does


// fetch ace's language tools module:
var langTools = ace.require('ace/ext/language_tools');

// data stub:
var javascript = [
{name:'setInterval(function(){},10);'},
{name:'setTimeout(function(){},10);'},
{name:'clearInterval(id);'},
{name:'clearTimeout(id);'},

{name:'document.getElementById()'},
{name:'document.getElementByClassName()'},
{name:'document.getElementsByTagName()'},

{name:'document.querySelector()'},
{name:'document.querySelectorAll()'},

{name:'console.info("HelloWorld",messageNR,"----------",newDate());'},
{name:'console.'},
{name:'console.info("test",testval);'},
{name:'log("",)'},
{name:'error("",)'},
{name:'info("",)'},
{name:'warn("",)'},
{name:'debug("",)'},
{name:'clear("clear")'},
{name:'newDate()'},
{name:'Math.PI'},
{name:'Math.abs()'},
{name:'Math.acos()'},
{name:'Math.acosh()'},
{name:'Math.asin()'},
{name:'Math.asinh()'},
{name:'Math.atan()'},
{name:'Math.atan2()'},
{name:'Math.atanh()'},
{name:'Math.cbrt()'},
{name:'Math.ceil()'},
{name:'Math.clz32()'},
{name:'Math.cos()'},
{name:'Math.cosh()'},
{name:'Math.exp()'},
{name:'Math.expml()'},
{name:'Math.floor()'},
{name:'Math.fround()'},
{name:'Math.hypot()'},
{name:'Math.imul()'},
{name:'Math.log()'},
{name:'Math.log10()'},
{name:'Math.log1p()'},
{name:'Math.log2()'},
{name:'Math.max()'},
{name:'Math.min()'},
{name:'Math.pow()'},
{name:'Math.random()'},
{name:'Math.round()'},
{name:'Math.sign()'},
{name:'Math.sin()'},
{name:'Math.sinh()'},
{name:'Math.sqrt()'},
{name:'Math.tan()'},
{name:'Math.tanh()'},
{name:'Math.trunc()'},
{name:'toggleconsole()'},
{name:'hideconsole()'},
{name:'showconsole()'},
{name:'console.clear("console.clear()")'},
{name:'var a=eval("(1000-778)*3");console.log("The Number is",a)'},
{name:'let a=3;let b=a**2;console.log("let a=3;let b=a**2;The result b is",b)'},
{name:'var a=eval("(1000-778)*3");console.log("TheNumberis",a)'},
{name:'console.info("header#legend.innerHTML=",document.getElementById("legend").innerHTML);'},
{name:'var mytimer=setInterval(function(){console.debug("setIntervaltostopdoclearInterval(nextnumber);",mytimer)},500);'},
{name:'setInterval(function(){},10);'},
{name:'document.querySelector("#legend").innerHTML+="HelloWorld!";'},

{name:`const nodeList=document.querySelectorAll('*');
for(let i=0;i<nodeList.length;i++){
nodeList[i].style.backgroundColor="pink";
}`},

{name: `const intervalID = setInterval(myCallback, 500, "Parameter 1", "Parameter 2");
function myCallback(a, b) {
  console.log(a);
  console.log(b);
}
setTimeout(function(){clearInterval(intervalID);},20000);
`},

{name: `var ChatGTPlistallfunctions; 
const javascriptFunctions = Object.getOwnPropertyNames(window)
  .filter((prop) => typeof window[prop] === 'function');

console.log(javascriptFunctions);
for(let i=0;i<javascriptFunctions.length;i++){
  console.info(javascriptFunctions[i]);
}
`},

{name: `
const value = 42;

// if statement
if (value === 42) {
  console.log('if statement: Value is 42');
}

// if...else statement
if (value === 42) {
  console.log('if...else statement: Value is 42');
} else {
  console.log('if...else statement: Value is not 42');
}

// if...else if...else statement
if (value === 42) {
  console.log('if...else if...else statement: Value is 42');
} else if (value === 24) {
  console.log('if...else if...else statement: Value is 24');
} else {
  console.log('if...else if...else statement: Value is neither 42 nor 24');
}

// Ternary (conditional) operator
const message = value === 42 ? 'Ternary operator: Value is 42' : 'Ternary operator: Value is not 42';
console.log(message);

// switch statement
switch (value) {
  case 42:
    console.log('switch statement: Value is 42');
    break;
  case 24:
    console.log('switch statement: Value is 24');
    break;
  default:
    console.log('switch statement: Value is neither 42 nor 24');
}
`},

{name: `const stringMethods = [
  "charAt",
  "charCodeAt",
  "concat",
  "endsWith",
  "fromCharCode",
  "includes",
  "indexOf",
  "lastIndexOf",
  "localeCompare",
  "match",
  "normalize",
  "padEnd",
  "padStart",
  "repeat",
  "replace",
  "search",
  "slice",
  "split",
  "startsWith",
  "substr",
  "substring",
  "toLowerCase",
  "toString",
  "toUpperCase",
  "trim",
  "trimEnd",
  "trimLeft",
  "trimRight",
  "trimStart",
  "valueOf",
];`},


{name: `for (let i = 0; i < 1000; i++) {
    // Your code to be executed in each iteration goes here
    console.log("Iteration \${i}",i);
}`},

{name: `let i = 0;
while (i < 10) {
  console.log("i=",i);
  i++
}`},

{name: `// or Logical OR (||)
const a = 3;
const b = -2;
console.log(a > 0 || b > 0); // Expected output: true`},
{name:`Copyright Dirk Luberth Dijkman Bangert Andijk`},

{name: `<script> <\/script>`},
{name: `<script src=" "><\/script>`},
{name: `<style> <\/style>`},
{name: `|| /*(Logical OR)*/`}

];

// create a completer object with a required callback function:
var javascriptCompleter = {
  getCompletions: function(editor, session, pos, prefix, callback) {
    callback(null, javascript.map(function(console) {
      return {
        caption: console.name,
	      value: console.name,
      	meta: "Heaven",
      };
    }));	
  },
   getDocTooltip: function(item) {
        if (!item.docHTML) {
            item.docHTML = [
                'MDN Web Docs<a href="https://developer.mozilla.org/en-US/search?q=',item.caption,'" target="_blank"><br><br><br>', item.caption, '</a><br><br><center><input type="button" onclick=\'openinwindow("',item.caption,'")\' value="open in window"><br></center>',
            ].join("");
        }
    }
};
function openinwindow(what){
  var url='https://developer.mozilla.org/en-US/search?q='+what;
  var urlt= escape(url);
  console.debug("urlt",urlt);
  window.open(url, "mdn", "adressbar=yes,toolbar=yes,scrollbars=yes,resizable=yes,top=300,left=300,width=800,height=600");
}
function openwindow(what){
  window.open(what, "AIChatGPT", "adressbar=yes,toolbar=yes,scrollbars=yes,resizable=yes,top=300,left=300,width=800,height=600");
}
// finally, bind to langTools:
langTools.addCompleter(javascriptCompleter);














	
		editor.setOptions({
			enableBasicAutocompletion: true,
			enableLiveAutocompletion: true,
			enableSnippets: true,
			enableEmmet: true,                 // do not know what emmet is and does
			fixedWidthGutter: false,
			showFoldWidgets: true,
			showInvisibles: true,
      displayIndentGuides: true,
			printMargin: false,
			fontFamily: '',
      fontSize:20,
			tabSize: 2,
      foldStyle: 'markbegin',
      useWorker: true,
      behavioursEnabled: true,          // boolean: true if enable custom behaviours
      wrapBehavioursEnabled: true,      // boolean
      useSoftTabs: false,                 // spaces or tabs i think tabs is better softtabs uses spaces
      scrollPastEnd: .5,
      dragEnabled: true, // boolean: enable dragging
  	});


//https://codepen.io/zymawy/pen/XwbxoJ
// All options are set to default value
/*
editor.setOptions({
  // editor options
  selectionStyle: 'line',// "line"|"text"
  highlightActiveLine: true, // boolean
  highlightSelectedWord: true, // boolean
  readOnly: false, // boolean: true if read only
  cursorStyle: 'ace', // "ace"|"slim"|"smooth"|"wide"
  mergeUndoDeltas: true, // false|true|"always"
  behavioursEnabled: true, // boolean: true if enable custom behaviours
  wrapBehavioursEnabled: true, // boolean
  autoScrollEditorIntoView: undefined, // boolean: this is needed if editor is inside scrollable page
  keyboardHandler: null, // function: handle custom keyboard events
  
  // renderer options
  animatedScroll: false, // boolean: true if scroll should be animated
  displayIndentGuides: false, // boolean: true if the indent should be shown. See 'showInvisibles'
  showInvisibles: false, // boolean -> displayIndentGuides: true if show the invisible tabs/spaces in indents
  showPrintMargin: true, // boolean: true if show the vertical print margin
  printMarginColumn: 80, // number: number of columns for vertical print margin
  printMargin: undefined, // boolean | number: showPrintMargin | printMarginColumn
  showGutter: true, // boolean: true if show line gutter
  fadeFoldWidgets: false, // boolean: true if the fold lines should be faded
  showFoldWidgets: true, // boolean: true if the fold lines should be shown ?
  showLineNumbers: true,
  highlightGutterLine: false, // boolean: true if the gutter line should be highlighted
  hScrollBarAlwaysVisible: false, // boolean: true if the horizontal scroll bar should be shown regardless
  vScrollBarAlwaysVisible: false, // boolean: true if the vertical scroll bar should be shown regardless
  fontSize: 12, // number | string: set the font size to this many pixels
  fontFamily: undefined, // string: set the font-family css value
  maxLines: undefined, // number: set the maximum lines possible. This will make the editor height changes
  minLines: undefined, // number: set the minimum lines possible. This will make the editor height changes
  maxPixelHeight: 0, // number -> maxLines: set the maximum height in pixel, when 'maxLines' is defined. 
  scrollPastEnd: 0, // number -> !maxLines: if positive, user can scroll pass the last line and go n * editorHeight more distance 
  fixedWidthGutter: false, // boolean: true if the gutter should be fixed width
  theme: 'ace/theme/textmate', // theme string from ace/theme or custom?
 
  // mouseHandler options
  scrollSpeed: 2, // number: the scroll speed index
  dragDelay: 0, // number: the drag delay before drag starts. it's 150ms for mac by default 
  dragEnabled: true, // boolean: enable dragging
  focusTimout: 0, // number: the focus delay before focus starts.
  tooltipFollowsMouse: true, // boolean: true if the gutter tooltip should follow mouse

  // session options
  firstLineNumber: 1, // number: the line number in first line
  overwrite: false, // boolean
  newLineMode: 'auto', // "auto" | "unix" | "windows"
  useWorker: true, // boolean: true if use web worker for loading scripts
  useSoftTabs: true, // boolean: true if we want to use spaces than tabs
  tabSize: 4, // number
  wrap: false, // boolean | string | number: true/'free' means wrap instead of horizontal scroll, false/'off' means horizontal scroll instead of wrap, and number means number of column before wrap. -1 means wrap at print margin
  indentedSoftWrap: true, // boolean
  foldStyle: 'markbegin', // enum: 'manual'/'markbegin'/'markbeginend'.
  mode: 'ace/mode/html' // string: path to language mode 
  //https://codepen.io/zymawy/pen/XwbxoJ
*/

 editor.setOption(editor.$options.animatedScroll.name, true);
 editor.setBehavioursEnabled(true);
 editor.setDisplayIndentGuides(true);


    HoverLink = require("hoverlink").HoverLink
    editor.hoverLink = new HoverLink(editor);



// click on URL link in editor
editor.hoverLink.on("open", function() {
      // alert("trying to open")
      console.log("trying to open",editor.hoverLink.link.value);

      if(editor.hoverLink.isOpen){
          window.open(editor.hoverLink.link.value);
      }
      console.log("this.link",editor.hoverLink.isOpen);
})


editor.execCommand('find');         // create the search find replace popup
                                    // maybe a little delay 
                                    // before make it draggable
                                    // think draggable wants to add code to div class="ace_search"
setTimeout(function(){
    // https://jqueryui.com/draggable/
    $( ".ace_search" ).draggable();  // after an edit the search / replace popup is draggable
}, 250);






		new AceScrollbars(editor);





// minimapeditor
var myTimeout;  // for update timeout minimap
// test maybe better for plugin alike code
editor.container.insertAdjacentHTML("beforeend", "<div id=\"minimapeditor\" class=\"minimapeditor\" onmouseover=\'ace.edit(\"minimapeditor\").focus();\'></div>")


//////////////////////////////////////////////////////////
// minimapeditor
//////////////////////////////////////////////////////////
  var minimapeditor = ace.edit("minimapeditor");
  minimapeditor.session.setMode("ace/mode/html");
  minimapeditor.setTheme("ace/theme/vibrant_ink");
  minimapeditor.setFontSize(3.0);
  minimapeditor.setShowPrintMargin(false);
  minimapeditor.renderer.setShowGutter(false);
  minimapeditor.setReadOnly(true);
  minimapeditor.renderer.setOption('showLineNumbers', false);
  editor.setOption("showPrintMargin", false);

  minimapeditor.setValue(editor.getSession().getValue());
  //minimapeditor.selection.clearSelection();
  //minimapeditor.setOption(minimapeditor.$options.animatedScroll.name, true);
  //minimapeditor.setAutoScrollEditorIntoView(true)


// get linenumeber on minimap mouseclick
minimapeditor.on('mousedown', () => {
    // mouseup works better?
});



// get linenumeber on minimap mouseup, for set main editor cursor position
minimapeditor.on('mouseup', () => {       // var cursor = minimapeditor.getCursorPosition();
    var cursorrow = minimapeditor.getCursorPosition().row;
    var cursorcolumn = minimapeditor.getCursorPosition().column;
    // var cursorPos = $scope.editor.getCursorPosition()

    // move cursorr big editor to cursor rom clickpos minimapeditor
    ace.edit("editor").gotoLine(cursorrow,cursorcolumn);
    ace.edit("editor").moveCursorTo(cursorrow,cursorcolumn);
    // console.log("getcursor row",cursorrow );
    // minimapeditor.selection.clearSelection();

    minimapeditor.scrollToLine(cursorrow, true, true, function () {});
    ace.edit("minimapeditor").moveCursorTo(editor.getCursorPosition());
    ace.edit("minimapeditor").gotoLine(cursorrow,cursorcolumn);
    minimapeditor.setAutoScrollEditorIntoView(true)

     minimapeditor.session.removeMarker(marker);
     // marker=minimapeditor.session.addMarker(new Range(editor.renderer.getFirstVisibleRow(), 0, editor.renderer.getLastVisibleRow(), 0), "ace_active-line", "fullLine");

});


//https://stackoverflow.com/questions/63892312/ace-editor-get-selected-word-after-double-click
editor.on("dblclick", function () {  //select on 
    setTimeout(() => {
        // could return a string of all sellected words on a newline split into array
        var selected_word = editor.getCopyText().split(/\r?\n/)[0];
        //editor.getSelectedText().split(/\r?\n/)[0];
        console.log("editor.getSelectedText()",editor.getSelectedText().split(/\r?\n/)[0]); 
        console.log("editor.getCopyText()",editor.getCopyText().split(/\r?\n/)[0]);
        editor.findAll(editor.getSelectedText().split(/\r?\n/)[0]);
        minimapeditor.findAll(editor.getSelectedText().split(/\r?\n/)[0]);

        document.querySelector(".ace_search_field").value=editor.getSelectedText().split(/\r?\n/)[0]; 
   
    }, 250);
});

editor.on('mousedown', () => {
     //minimapeditor.selection.clearSelection();
     minimapeditor.selection.selectLine();
        //if (document.querySelector(".ace_search_field").value !=""){
    //editor.findAll(document.querySelector(".ace_search_field").value);
    //minimapeditor.findAll(document.querySelector(".ace_search_field").value);
   //} 
   });

var marker; //gray select on minimap

editor.session.on("changeScrollTop", function() {

    var s=editor.renderer.getFirstVisibleRow()
    var e=editor.renderer.getLastVisibleRow()
    var m = s+((e-s)/2);    // center of editor

    minimapeditor.scrollToLine(m, true, true, function () {});
    minimapeditor.moveCursorTo(m);
    minimapeditor.gotoLine(m);

 minimapeditor.session.removeMarker(marker);  // gray selection on minimap
 marker=minimapeditor.session.addMarker(new Range(s, 0, e, 0), "ace_active-line", "fullLine");
  if(editor.getSelectedText().split(/\r?\n/)[0] != ""){
      minimapeditor.findAll(editor.getSelectedText().split(/\r?\n/)[0]);
  }
})



// on change main big editor change content minimap editor 5 sec delay of no change
editor.getSession().on('change', function () {

    // timeout here?
    // update minimap after 5 seconds no change (update every keypres makes editor slow)
    clearTimeout(myTimeout); // clear if new change
    myTimeout = setTimeout(function(){
        minimapeditor.setValue(editor.getSession().getValue());
        minimapeditor.selection.clearSelection();
    }, 1000);

    ace.edit("editor").focus(); // To focus the ace editor
    ace.edit("editor").renderer.$cursorLayer.showCursor();
//$('.ace_scrollbar.ace_scrollbar-v').style.display = "none";
//$(".ace_scrollbar.ace_scrollbar-v").eq(1).setAttribute('style', 'overscroll:hidden;');
if(document.querySelector(".ace_search_field").value !=""){
    // preventScroll
  // ace.edit("editor").findAll(document.querySelector(".ace_search_field").value);
}

 
//   if (document.querySelector(".ace_search_field").value !=""){
//    editor.findAll(document.querySelector(".ace_search_field").value);
//    minimapeditor.findAll(document.querySelector(".ace_search_field").value);
//   } 

});





/////////////////////////////// end minimap ?





  

// https://www.w3schools.com/howto/howto_js_toggle_hide_show.asp
function showhideminimap() {
  var x = id("minimapeditor");
  if (x.style.display === "none") {
    x.style.display = "block";
    id("minimapbutton").value="Hide MiniMap"
  } else {
    x.style.display = "none";
    id("minimapbutton").value="Show MiniMap"
  }
}
 
function showhidepreview() {

  if (id("editor").style.width === "100%") {
    id("editor").style.width = "75%";
    id("previewbutton").value="Hide Preview";
  } else {
    id("editor").style.width = "100%";
    id("previewbutton").value="Show Preview";
  }
  
}




function toggleFullScreen() {
  if (top.location!= self.location) {
    top.location = self.location.href;
  }
  if (window.location !== window.top.location) {
    window.top.location = window.location;
  }
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
  } else {
    if (document.exitFullscreen) {
      document.exitFullscreen();
    }
  }
}

var onoff=1;
function togglelinenumbers() {
  if (onoff==1) {
      //editor.renderer.setOption('showLineNumbers', false);
      //editor.renderer.setShowGutter(false);
      //const nodeList = document.querySelectorAll(".ace_gutter-cell");
      //for (let i = 0; i < nodeList.length; i++) {
          //nodeList[i].innerHTML = "" // removes linenumbes from gutter but cursor gets strange on typing
          //nodeList[i].innerText = "";// removes linenumbes from gutter but cursor gets strange on typing
      //}
      // cannot find how they turn off linenumbers in ace settings menu
      //document.querySelector(".ace_gutter").style.width = "20px";//hides linumbers, shows icons, but not folding thingy
      editor.setOption('showLineNumbers', false);
      id("linenmbrsbutton").value="Show LineNumbers";
      onoff=0;
  }else{
      //editor.renderer.setOption('showLineNumbers', false);
      //editor.renderer.setshowLineNumbers(false);
      //editor.renderer.setShowGutter(true);
      //document.querySelector(".ace_gutter-cell ").innerhtml="";      
      //document.querySelector(".ace_gutter").style.width = "55px";
      //editor.renderer.setOption.showLineNumbers(false);
       editor.setOption('showLineNumbers', true);
       id("linenmbrsbutton").value="Hide LineNumbers";
      onoff=1;
  }
}
      
var ionoff=1;
function toggleinvisibles() {
  if (ionoff==1) {
      editor.setOption('showInvisibles', false);
      id("invisiblesbutton").value="Show Invisibles";
      ionoff=0;
  }else{
       editor.setOption('showInvisibles', true);
       id("invisiblesbutton").value="Hide Invisibles";
      ionoff=1;
  }
}



// save part of https://codepen.io/8354801/pen/OeOBXm
function save() {
  download('Ace_Seventh_Heaven.html', editor.getValue());
}

// download part of https://codepen.io/8354801/pen/OeOBXm
function download(filename, text) {
      var element = document.createElement('a');
      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
      // get text value name is set by openfile
      filename=document.querySelector("input.text").value;
      element.setAttribute('download', filename);

      element.style.display = 'none';
      document.body.appendChild(element);

      element.click();

      document.body.removeChild(element);
}


// https://plnkr.co/edit/GCLwKqNGqi4R2Fnr?preview


  function openCode(files) {
        var file = files[0];
        if (!file) return;
        var modelist = ace.require('ace/ext/modelist');
        var modeName = modelist.getModeForPath(file.name).mode;
        editor.session.setMode(modeName);
        minimapeditor.session.setMode(modeName);
        id('ace-mode').value=modeName.replace("ace/mode/",""); // not correct mode select  blanks
console.log("modeName ",modeName.replace("ace/mode/",""));

        console.log("file.name",file.name);
        console.log("change page title",file.name+" Ace Seventh Heaven");
        document.querySelector('title').textContent = file.name+" ________ The AfterWorld, Editor With AI ________ ";
        // silly set filename text field for save to disk filename
        document.querySelector("input.text").value=file.name;      

        reader = new FileReader();
        reader.onload = function () {
          editor.session.setValue(reader.result);
        };
        reader.readAsText(file);


      }



    id('ace-theme').addEventListener('change', function(e) {
      console.log((id('ace-theme').value).toLowerCase());
      e.preventDefault();
      ace.edit("editor").setTheme('' + (id('ace-theme').value).toLowerCase());
      ace.edit("minimapeditor").setTheme('' + (id('ace-theme').value).toLowerCase());
    });


    id('ace-mode').addEventListener('change', function(e) {
      console.log((id('ace-mode').value).toLowerCase());
      e.preventDefault();
      ace.edit("editor").getSession().setMode('ace/mode/' + (id('ace-mode').value).toLowerCase());
    });


function Update_HTML_Preview(){	
	
  $("#preview").empty();

	
	var code = editor.getValue();
	
	var iframe = document.createElement('iframe');
	
	var preview = id('preview');
	var content = code + `
<script src="https://ldijkman.github.io/Ace_Seventh_Heaven/console.js"><\/script>
` ;

	preview.appendChild(iframe);

	iframe.contentWindow.document.open('text/htmlreplace');
	iframe.contentWindow.document.write(content);
	iframe.contentWindow.document.close();
	
	 //$("#preview").innerHTML=content;

}

Update_HTML_Preview();

var timeout;
var emarker;
var emarkers;
$('.ace_search_field').on('keydown', function(e){
   setTimeout(markit, 2000);
});


function markit() {

var markercolor;
    var darkorlight=document.querySelector('#ace-theme option:checked').parentElement.label;
     console.log("dark or light ",darkorlight);
     if(darkorlight=="Dark"){
        markercolor="yellowborder";
     }else{
       markercolor="purpleborder";
     }
 /*  // get keycode of current keypress event
    var code = (e.keyCode || e.which);

    // do nothing if it's an arrow key
    if(code == 37 || code == 38 || code == 39 || code == 40) {
        return;
    }

    // do normal behaviour for any other key
    $('#search-items #autocom').fadeIn();
    */
 // get editor find search text
var text=document.querySelector(".ace_search_field").value;
  //console.log("search",text);

 //editor.session.removeMarker(emarker);
 //minimapeditor.session.removeMarker(emarkers);



  //minimapeditor.find(text);
  //https://codepen.io/ldijkman/pen/gOZjGVL
            //var range= 
            minimapeditor.findAll(text); // findAll finds more but clears the custom scrollbar 
         
            editor.findAll(text);  // findAll finds more but clears the custom scrollbar 
           
           
           
          //console.log("findall : ",range)
          //var selectarray=editor.getSelection().getAllRanges();
          //console.log("editor.getSelection().getAllRanges()",selectarray);
            //console.log("editor.getSelection().getAllRanges().length",editor.getSelection().getAllRanges().length);
 /*    
      for (let i = 0; i < editor.getSelection().getAllRanges().length ; i=i+1) {

           // console.log("line",editor.getSelection().ranges[i].start.row);
           // console.log("start",editor.getSelection().ranges[i].start.column);
           // console.log("end",editor.getSelection().ranges[i].end.column);
            var line=editor.getSelection().ranges[i].start.row;
            var start=editor.getSelection().ranges[i].start.column;
            var end=editor.getSelection().ranges[i].end.column;
  
            emarker=editor.session.addMarker(new Range(line,start,line,end), markercolor, "text");    
            emarkers=minimapeditor.session.addMarker(new Range(line,start,line,end), markercolor, "text"); 
      } 

document.querySelectorAll(".yellowborder").forEach(function(el) {
   el.style.border = "2px solid red";
});
 */
}




$("#editor").on('keyup', function(e) {
 
console.log("keyup");

	  var code = (e.keyCode || e.which);

    // do nothing if it's an arrow key
    if(code == 37 || code == 38 || code == 39 || code == 40) {
        return;
    }

	//console.log("yea");

	if(timeout) {
		clearTimeout(timeout);
		timeout = null;
	}

	timeout = setTimeout(Update_HTML_Preview, 2500)
	
});

///////////////////////////////////////////////////////////////////////////
// arduino alike map function == Re-maps a number from one range to another.
// https://www.arduino.cc/reference/en/language/functions/math/map/
// https://stackoverflow.com/questions/5649803/remap-or-map-function-in-javascript
// scale range 1 into range2 bar range to 0 to 1440 minute range
// or
// scale a minutevalue in range 0 to 1440 minutes to 0% to 100%,  used for left and width of timeslot divs
///////////////////////////////////////////////////////////////////////////////
function map_range(value, low1, high1, low2, high2) {
    return (low2 + (high2 - low2) * (value - low1) / (high1 - low1)).toFixed(3);   // to 3 decimals, Math.round did not scale right
}

// https://www.javascripttutorial.net/dom/css/add-styles-to-an-element/
function css(element, style) {
    for (const property in style)
        element.style[property] = style[property];
}

document.addEventListener("DOMContentLoaded", () => {
    editor.findAll("function");
    minimapeditor.findAll("function");
    document.querySelector(".ace_search_field").value="function"; 
    
    // minimapeditor.find("function");
    // https://www.javascripttutorial.net/dom/css/add-styles-to-an-element/
    const note = document.querySelector('.ace_scrollbar.ace_scrollbar-v');
    css(note, {
      //'background-color': 'yellow',
      //width: '10px',
      overflow:'hidden'      // remove the verticalscrollbar from behind the custom scrollbar
    });                      // but live the minimap vertical scrollbar intact  

    const notetwo = document.querySelectorAll('.ace_scrollbar.ace_scrollbar-v')[1];
    css(notetwo, {
       width: '8px'
      //'background-color': '',
      // color: 'red'             // i do not know maybe make scrollbar slider guide transparent
      //overflow:'hidden'      // remove the verticalscrollbar from behind the custom scrollbar
    }); 

  toggleFullScreen();
});
  

// moved to ace scrollbar js

editor.getSession().on("changeAnnotation", function() {
  //var annotations = session.getAnnotations()||[], i = len = annotations.length;
  // while (i--) {
  //   if(/doctype first\. Expected/.test(annotations[i].text)) {
  //     annotations.splice(i, 1);
  //  }
  //}
  // if(len>annotations.length) {
  //  session.setAnnotations(annotations);
  // }

  var  errormessage="";
  //var Range = ace.require("ace/range").Range;
  errormessage += " "+editor.getSession().getAnnotations().length+" Annotations\r\n"+"Click to go to next Error or Warning in Editor\r\n\r\n";
  //  resizeScroll(); // redraw vertical scrollbar on error changes
  for (let i = 0; i < editor.getSession().getAnnotations().length; i=i+1) {
      //console.log("errors/warnings on line ",editor.getSession().getAnnotations()[i].row);
      errormessage += " "+editor.getSession().getAnnotations()[i].row+1 +"  "+ editor.getSession().getAnnotations()[i].type +"  "+ editor.getSession().getAnnotations()[i].text+"\r\n";
      //var mymarker=minimapeditor.addMarker(new Range((editor.getSession().getAnnotations()[i].row+1), 0, (editor.getSession().getAnnotations()[i].row+1), 60), "red", "text");
  }
  errorbutton.title=errormessage;
});







var errorpointer=0;

function nexterror() {

    var len = editor.getSession().getAnnotations().length;
    document.getElementById("errorbuttom"),value=len;
    if (errorpointer >= len){
        errorpointer=0;
    }

    editor.scrollToLine(editor.getSession().getAnnotations()[errorpointer].row+1, true, true, function () {});
    editor.moveCursorTo(editor.getSession().getAnnotations()[errorpointer].row)+1;
    editor.gotoLine(editor.getSession().getAnnotations()[errorpointer].row+1);

    errorpointer++;

}







  const minimapmarker=[];
  const editormarker=[];
var len="";

function doiteverysecond () {

  //editor.findAll("luberth");

    //    console.log("editor.getSelectedText()",editor.getSelectedText().split(/\r?\n/)[0]); 
    //    console.log("editor.getCopyText()",editor.getCopyText().split(/\r?\n/)[0]);

// https://github.com/ajaxorg/ace/issues/1199
//console.log("color",getComputedStyle(editor.renderer.scroller).backgroundColor);
//console.log("guttercolor ",document.querySelector(".ace_gutter").style.backgroundColor);

//get warnings errors?
//console.log("editor.getSession().getAnnotations()",editor.getSession().getAnnotations());


/*console.log("editor.getSession().getAnnotations().length",editor.getSession().getAnnotations().length);
for (let i = 0; i < editor.getSession().getAnnotations().length; i=i+1) {
console.log("errors/warnings on line ",editor.getSession().getAnnotations()[i].row);
}*/

if (editor.getSession().getAnnotations().length=="0") {
  errorbutton.style.color="greenyellow";
}else{
  errorbutton.style.color="rgb(255,40,0)";
}

    var len = editor.getSession().getAnnotations().length;
    document.getElementById("errorbutton").value=""+len;

//if(len!=editor.getSession().getAnnotations().length){
 //   resizeScroll(); // redraw vertical scrollbar on error changes
//}
//len=editor.getSession().getAnnotations().length;


  //var Range = ace.require("ace/range").Range;


for (let i = 0; i < editormarker.length; i=i+1) {
        minimapeditor.session.removeMarker(minimapmarker[i]);
        editor.session.removeMarker(editormarker[i]);
}
  for (let i = 0; i < editor.getSession().getAnnotations().length; i=i+1) {
       if(editor.getSession().getAnnotations()[i].type=="error"){
          minimapmarker[i]= minimapeditor.session.addMarker(new Range(editor.getSession().getAnnotations()[i].row, 0, editor.getSession().getAnnotations()[i].row, 60), "errormarker", "fullLine");
          editormarker[i]=editor.session.addMarker(new Range(editor.getSession().getAnnotations()[i].row, 0, editor.getSession().getAnnotations()[i].row, 60), "errormarker", "fullLine");
       }else{
          minimapmarker[i]= minimapeditor.session.addMarker(new Range(editor.getSession().getAnnotations()[i].row, 0, editor.getSession().getAnnotations()[i].row, 60), "warningmarker", "fullLine");
          editormarker[i]=editor.session.addMarker(new Range(editor.getSession().getAnnotations()[i].row, 0, editor.getSession().getAnnotations()[i].row, 60), "warningmarker", "fullLine");
       }
    }
   // minimapeditor.setValue(editor.getSession().getValue());
//ace.edit("minimapeditor").setFontSize(parseFloat(ace.edit("minimapeditor").getFontSize()));

    var darkorlight=document.querySelector('#ace-theme option:checked').parentElement.label;
     //console.log("Theme optgroup = ",darkorlight);
     if(darkorlight=="Dark"){
        // dark
        // https://github.com/ajaxorg/ace/issues/1199
        document.querySelector(".ace_scroll-v").style.backgroundColor=getComputedStyle(editor.renderer.scroller).backgroundColor; 
     }else{
       // bright
       // https://github.com/ajaxorg/ace/issues/1199
       document.querySelector(".ace_scroll-v").style.backgroundColor=getComputedStyle(editor.renderer.scroller).backgroundColor; 
     }

document.getElementById("version").innerHTML = ' &nbsp;&nbsp;<a href="https://github.com/ajaxorg/ace" target="ace">Ace Version: ' + ace.version+'</a>';


// beautify options
//console.log("tabsize",document.getElementById("tabsize").value);
//console.log("max-preserve-newlines",document.getElementById("max-preserve-newlines").value);
//console.log("wrap-line-length",document.getElementById("wrap-line-length").value);
//console.log("brace-style",document.getElementById("brace-style").value);
//console.log("indent-scripts",document.getElementById("indent-scripts").value);


/*var roww = editor.getCursorPosition().row;
var column=editor.getCursorPosition().column;
//console.log("cursorpos",cursorpos);
editor.setOption("enableMultiselect", false);
var range = editor.findAll('ldijk',{
    wrap: false,
    caseSensitive: false, 
    wholeWord: false,
    regExp: false,
    preventScroll: true // do not change selection
})
//range.start.column = 0
//range.end.column = Number.MAX_VALUE
//editor.session.replace(range, "x" + editor.session.getLine(range.start.row) + "x")
//console.log("cursorpos",cursorpos);
editor.selection.setRange(range);
 
  editor.gotoLine(roww, column);  
  editor.moveCursorTo(roww,column);
*/

//download_to_textbox("https://run.plnkr.co/plunks/TMDzQALQgACruCYz/");
//download_to_textbox("https://raw.githubusercontent.com/ldijkman/Ace_Seventh_Heaven/main/docs/Hell.html");

}
 setInterval(doiteverysecond, 2500); // Milliseconds  call function doiteverysecond() every second



function download_to_textbox(url) {
        $.get(url, null, function (data) {
            //el.val(data);
            editor.setValue(data);
        }, "text");
    }


function play() { 
		var beepsound = new Audio( 'https://www.myinstants.com/media/sounds/wuh-oh.mp3'); 

    beepsound.addEventListener("canplaythrough", (event) => {
        beepsound.play()
    });
	} 


</script>


<textarea rows=5 cols ="55" hidden>
4 7th Heaven Editor?<br>
<a href="https://ldijkman.github.io/Ace_Seventh_Heaven/Seventh_Heaven.html" target="7th_Heaven">https://ldijkman.github.io/Ace_Seventh_Heaven/Seventh_Heaven.html</a><br>
</textarea>
 

 <script>
    // https://web.dev/patterns/files/save-a-file/#using-the-file-system-access-apis-showsavefilepicker-method
    // https://web.dev/patterns/files/save-a-file/demo.html
    // https://plnkr.co/edit/oOmxxNPfJlkjIh9i
    // https://github.com/GoogleChromeLabs/browser-fs-access	 
    // https://googlechromelabs.github.io/browser-fs-access/demo/



     var textarea = editor.getValue(),
      textInput = document.querySelector("input.text"),
      textButton = document.querySelector(".savebutton"),
      img = document.querySelector("img"),
      imgInput = document.querySelector("input.img"),
      imgButton = document.querySelector("button.img"),
      saveFile = async (e, t) => {
        if ("showSaveFilePicker" in window && (() => {
            try {
              return window.self === window.top
            } catch {
              return !1
            }
          })()) try {
          const n = await showSaveFilePicker({
              suggestedName: t
            }),
            a = await n.createWritable();
          return await a.write(e), void await a.close()
        } catch (e) {
          return void("AbortError" !== e.name && console.error(e.name, e.message))
        }
        const n = URL.createObjectURL(e),
        a = document.createElement("a");
        a.href = n,
        a.download = t,
        a.style.display = "none",
        document.body.append(a), a.click(),
        setTimeout((() => {
          URL.revokeObjectURL(n), a.remove()
        }), 1e3)
      };
    textButton.addEventListener("click", (async () => {
      const e = new Blob([editor.getValue()], {
        type: "text/plain"
      });
      await saveFile(e, textInput.value)
    })), imgButton.addEventListener("click", (async () => {
      const e = await fetch(img.src).then((e => e.blob()));
      await saveFile(e, imgInput.value)
    }));
    // https://web.dev/patterns/files/save-a-file/#using-the-file-system-access-apis-showsavefilepicker-method
    // https://web.dev/patterns/files/save-a-file/demo.html
    // https://plnkr.co/edit/oOmxxNPfJlkjIh9i
    // https://github.com/GoogleChromeLabs/browser-fs-access	 
    // https://googlechromelabs.github.io/browser-fs-access/demo/	 
   
   







  </script>






 <!-- hitwebcounter Code START -->
<a href="https://www.hitwebcounter.com" target="_blank" >
<img src="https://hitwebcounter.com/counter/counter.php?page=9338682&style=0038&nbdigits=6&type=page&initCount=0" title="i think this is a safe Counter Widget" Alt="Visit counter For Websites"   border="0" style="float:right;padding:5x;"/></a>                                    
            
            
            
            
            
        <div id="time" style="position: fixed; bottom: 1em; right: 1em;background:lightgray;z-index:11000;">  
          <!--<button onclick="showhideabout()" style="border-color:green; color:green;"><b>?</b></button>-->
          <script>
            setInterval(function () {

             const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
             const days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
              const d = new Date();
              let month = months[d.getMonth()];
              let day = days[d.getDay()];
              //document.getElementById("demo").innerHTML = day;

              const event = new Date();
              document.getElementById("time").innerHTML = (event.toLocaleString());
            }, 1000);

          </script>
          <script>
            // session storage https://plnkr.co/edit/TMDzQALQgACruCYz
            const fruits = ["Banana", "Orange", "Apple", "Mango","","","",""];
            setInterval(function () {
            fruits.shift();
            var test=new Date().getSeconds();
            //fruits.push(test);document.getElementById("demo").innerHTML = fruits;
            }, 1000);

            // session storage https://plnkr.co/edit/TMDzQALQgACruCYz
            </script>
        </div>              
                          
                          
                           https://youtu.be/l9wejBgCiT4

               <script>


      // https://codepen.io/louisr/pen/xZwJLx
      // https://github.com/bahmutov/console-log-div 
      //      changes Luberth https://plnkr.co/edit/AufqNkQe4InMuU8v
      //      test for https://ldijkman.github.io/Ace_Seventh_Heaven/Hell.html 
      //    more? https://stackoverflow.com/questions/13815640/a-proper-wrapper-for-console-log-with-correct-line-number

        //const stylesheet = '#console-log-div{min-height:55px;max-height:200px;width:600px;top:200px;left:100px;margin:1px;padding:1px 0 0;font-family:"Input Mono",monospace;font-weight:400;font-size:.8em;line-height:1em;color:rgba(0,0,0,.61);box-shadow:inset 0 0 2px rgba(0,0,0,.1);background-color:#ebebeb;overflow:auto;overscroll-behavior-y:auto;transform:scale(100%);z-index:50000}#console-log-div #legend,#console-log-div .log-row,#console-log-div td{padding:1px 0 8px;text-indent:1px;z-index:50000}#console-log-div #legend{padding-bottom:12px;font-size:1.2em;cursor:move;z-index:50000}#console-log-div .log-row:nth-child(odd){background:rgba(0,0,0,.1);z-index:50000}#console-log-div thead{background:rgba(0,0,0,.2)}';
        //document.adoptedStyleSheets = [stylesheet];

      var etype = "log";

      (function initConsoleLogDiv() {
        'use strict';


        if (console.log.toDiv) {
          return;
        }

        function toString(x) {
          return typeof x === 'string' ? x : JSON.stringify(x);
        }

        var log = console.log.bind(console);
        var error = console.error.bind(console);
        var warn = console.warn.bind(console);
        var table = console.table ? console.table.bind(console) : null;
        var consoleId = 'console-log-div';

        // Create the Console Div container.
        function createOuterElement(id) {
          var outer = document.getElementById(id);
          if (!outer) {
            outer = document.createElement('fieldset');
            outer.id = id;
            document.body.appendChild(outer);
          }
          var style = outer.style;
          return outer;
        }
        // Create the logging div and adornments.
        var logTo = (function createLogDiv() {

          var outer = createOuterElement(consoleId);
          var caption = document.createTextNode('Console Output');
          var legend = document.createElement('div');
          legend.id = "legend";
          legend.appendChild(caption);
          outer.appendChild(legend);

          document.getElementById("legend").innerHTML = 'Console Editor log, Drag Me. <input type="button" onclick=\'document.getElementById("console-log-text").innerHTML="Cleared Console";\' value="Clear" title="Empty Console!"> <input type="button" value="hide" title="Not yet!">';

          var div = document.createElement('div');
          div.id = 'console-log-text';

          outer.appendChild(div);
          return div;
        }());

        function printToDiv() {
          var msg = Array.prototype.slice.call(arguments, 0)
            .map(toString)
            .join(' ');
          var item = document.createElement('div');
          item.classList.add('log-row');
          item.textContent = msg;

          //logTo.appendChild(item);               // new logs on bottom
          logTo.prepend(item);                    // i want new logs on top
          
                              // wait for element creation
          //setTimeout(function () {
          const nodeList = document.querySelectorAll(".log-row");
          if (etype == "log") {                        // change text color
            nodeList[0].style.color = "gray";
          }
          if (etype == "warn") {
            nodeList[0].style.color = "orange";
          }
          if (etype == "errorr") {
            nodeList[0].style.color = "red";
          }
          if (etype == "exception") {
            nodeList[0].style.color = "red";
          }


          // }, 5);
        }

        function logWithCopy() {
          var ele = document.getElementById('console-log-div');
          setDarkLight(ele);
          log.apply(null, arguments);
          etype = "log";
          printToDiv.apply(null, arguments);
        }

        console.log = logWithCopy;
        console.log.toDiv = true;



        console.error = function errorWithCopy() {
          error.apply(null, arguments);
          var args = Array.prototype.slice.call(arguments, 0);
          args.unshift('ERROR:');
          etype = "errorr";
          printToDiv.apply(null, args);
        };

        console.warn = function logWarning() {
          warn.apply(null, arguments);
          var args = Array.prototype.slice.call(arguments, 0);
          args.unshift('WARNING:');
          etype = "warn";
          printToDiv.apply(null, args);
        };

        function printTable(objArr, keys) {

          var numCols = keys.length;
          var len = objArr.length;
          var $table = document.createElement('table');
          $table.style.width = '100%';
          $table.setAttribute('border', '1');
          var $head = document.createElement('thead');
          var $tdata = document.createElement('td');
          $tdata.innerHTML = 'Index';
          $head.appendChild($tdata);

          for (var k = 0; k < numCols; k++) {
            $tdata = document.createElement('td');
            $tdata.innerHTML = keys[k];
            $head.appendChild($tdata);
          }
          $table.appendChild($head);

          for (var i = 0; i < len; i++) {
            var $line = document.createElement('tr');
            $tdata = document.createElement('td');
            $tdata.innerHTML = i;
            $line.appendChild($tdata);

            for (var j = 0; j < numCols; j++) {
              $tdata = document.createElement('td');
              $tdata.innerHTML = objArr[i][keys[j]];
              $line.appendChild($tdata);
            }
            $table.appendChild($line);
          }
          var div = document.getElementById('console-log-text');
          div.appendChild($table);

        }

        console.table = function logTable() {
          if (typeof table === 'function') {
            table.apply(null, arguments);
          }

          var objArr = arguments[0];
          var keys;

          if (typeof objArr[0] !== 'undefined') {
            keys = Object.keys(objArr[0]);
          }
          printTable(objArr, keys);
        };

        window.addEventListener('error', function (err) {
           etype="exception";
          printToDiv('EXCEPTION:', err.message + '\n  ' + err.filename, err.lineno + ':' + err.colno);
        });

        //   Detect dark or light colors.

        function setDarkLight(element) {
          var color = window.getComputedStyle(element, null).backgroundColor;
          if (isDark(color)) {
            element.style.color = "rgba(255,255,255,1)";
          } else {
            element.style.color = "rgba(0,0,0,.61)";
          }
        }

        function isDark(color) {
          var match = /rgb\((\d+).*?(\d+).*?(\d+)\)/.exec(color);
          return parseFloat(match[1]) +
            parseFloat(match[2]) +
            parseFloat(match[3]) <
            3 * 256 / 2; // r+g+b should be less than half of max (3 * 256)
        }
      }());


      // https://codepen.io/louisr/pen/xZwJLx
      // https://github.com/bahmutov/console-log-div 
      //      changes Luberth https://plnkr.co/edit/AufqNkQe4InMuU8v
      //      test for https://ldijkman.github.io/Ace_Seventh_Heaven/Hell.html 
      //    more? https://stackoverflow.com/questions/13815640/a-proper-wrapper-for-console-log-with-correct-line-number

           setTimeout(function () {
          // https://jqueryui.com/draggable/
          $("#console-log-div").draggable(); // after an edit the search / replace popup is draggable
        }, 250);

   
               </script>  



               <script>
  // https://stackoverflow.com/questions/8960193/how-to-make-html-element-resizable-using-pure-javascript



// wait for the page loaded, and make console draggable 
document.addEventListener("DOMContentLoaded",
function (event) {

           setTimeout(function () { var element = document.querySelector(".cont_ai_ner")
makeResizable(element,16,16)
    console.info("AI Code Assistant, Running, Making it Draggable.");
    make_AI_draggable(); // https://www.w3schools.com/howto/howto_js_draggable.asp


 var element = document.querySelector(".cont_ai_ner")
makeResizable(element,16,16)
  }, 250);
    console.info("Ok, You can Drag it now!.");
    console.info("& Wow!, Resize on Borders and Corners!.");
     console.debug('ai => RosyBrown');
});





function makeResizable(element, minW = 500, minH = 500, size = 10)
{
    const top = document.createElement('div');
    top.style.width = '100%';
    top.style.height = size + 'px';
    top.style.backgroundColor = 'transparent';
    top.style.position = 'absolute';
    top.style.top = - (size/2) + 'px';
    top.style.left = '0px';
    top.style.cursor = 'n-resize';

    top.addEventListener('mousedown',resizeYNegative())

    element.appendChild(top);

    const bottom = document.createElement('div');
    bottom.style.width = '100%';
    bottom.style.height = size + 'px';
    bottom.style.backgroundColor = 'transparent';
    bottom.style.position = 'absolute';
    bottom.style.bottom = - (size/2) + 'px';
    bottom.style.left = '0px';
    bottom.style.cursor = 'n-resize';

    bottom.addEventListener('mousedown',resizeYPositive())

    element.appendChild(bottom);

    const left = document.createElement('div');
    left.style.width = size + 'px';
    left.style.height = '100%';
    left.style.backgroundColor = 'transparent';
    left.style.position = 'absolute';
    left.style.top = '0px';
    left.style.left = - (size/2) + 'px';
    left.style.cursor = 'e-resize';

    left.addEventListener('mousedown',resizeXNegative())

    element.appendChild(left);

    const right = document.createElement('div');
    right.style.width = size + 'px';
    right.style.height = '100%';
    right.style.backgroundColor = 'transparent';
    right.style.position = 'absolute';
    right.style.top = '0px';
    right.style.right = - (size/2) + 'px';
    right.style.cursor = 'e-resize';

    right.addEventListener('mousedown',resizeXPositive())

    element.appendChild(right);


    const corner1 = document.createElement('div');
    corner1.style.width = size + 'px';
    corner1.style.height = size + 'px';
    corner1.style.backgroundColor = 'transparent';
    corner1.style.position = 'absolute';
    corner1.style.top = - (size/2) + 'px';
    corner1.style.left = - (size/2) + 'px';
    corner1.style.cursor = 'nw-resize';

    corner1.addEventListener('mousedown',resizeXNegative())
    corner1.addEventListener('mousedown',resizeYNegative())
    
    element.appendChild(corner1);

    const corner2 = document.createElement('div');
    corner2.style.width = size + 'px';
    corner2.style.height = size + 'px';
    corner2.style.backgroundColor = 'transparent';
    corner2.style.position = 'absolute';
    corner2.style.top = - (size/2) + 'px';
    corner2.style.right = - (size/2) + 'px';
    corner2.style.cursor = 'ne-resize';

    corner2.addEventListener('mousedown',resizeXPositive())
    corner2.addEventListener('mousedown',resizeYNegative())

    element.appendChild(corner2);

    const corner3 = document.createElement('div');
    corner3.style.width = size + 'px';
    corner3.style.height = size + 'px';
    corner3.style.backgroundColor = 'transparent';
    corner3.style.position = 'absolute';
    corner3.style.bottom = - (size/2) + 'px';
    corner3.style.left = - (size/2) + 'px';
    corner3.style.cursor = 'sw-resize';

    corner3.addEventListener('mousedown',resizeXNegative())
    corner3.addEventListener('mousedown',resizeYPositive())

    element.appendChild(corner3);

    const corner4 = document.createElement('div');
    corner4.style.width = size + 'px';
    corner4.style.height = size + 'px';
    corner4.style.backgroundColor = 'transparent';
    corner4.style.position = 'absolute';
    corner4.style.bottom = - (size/2) + 'px';
    corner4.style.right = - (size/2) + 'px';
    corner4.style.cursor = 'se-resize';

    corner4.addEventListener('mousedown',resizeXPositive())
    corner4.addEventListener('mousedown',resizeYPositive())

    element.appendChild(corner4);
    
    function get_int_style(key)
    {
        return parseInt(window.getComputedStyle(element).getPropertyValue(key));
    }

    function resizeXPositive()
    {
        let offsetX
        function AIdragMouseDown(e) {
            if(e.button !== 0) return
            e = e || window.event;
            e.preventDefault();
            const {clientX} = e;
            offsetX = clientX - element.offsetLeft - get_int_style('width');
            document.addEventListener('mouseup', AIcloseDragElement)
            document.addEventListener('mousemove', AIelementDrag)
          }
        
          function AIelementDrag(e) {
                const {clientX} = e;
                let x = clientX - element.offsetLeft - offsetX
                if(x < minW) x = minW;
                element.style.width =  x + 'px';
          }
        
          function AIcloseDragElement() {
            document.removeEventListener("mouseup", AIcloseDragElement);  
            document.removeEventListener("mousemove", AIelementDrag);
          }
        return AIdragMouseDown
    }

    function resizeYPositive()
    {
        let offsetY
        function AIdragMouseDown(e) {
            if(e.button !== 0) return
            e = e || window.event;
            e.preventDefault();
            const {clientY} = e;
            offsetY = clientY - element.offsetTop - get_int_style('height');
    
            document.addEventListener('mouseup',AIcloseDragElement)
            document.addEventListener('mousemove',AIelementDrag)
          }
        
          function AIelementDrag(e) {
                const {clientY} = e;
                let y =  clientY - element.offsetTop - offsetY;
                if(y < minH) y = minH;
                element.style.height = y + 'px';
          }
        
          function AIcloseDragElement() {
            document.removeEventListener("mouseup", AIcloseDragElement);  
            document.removeEventListener("mousemove", AIelementDrag);
          }
        return AIdragMouseDown
    }

    function resizeXNegative()
    {
        let offsetX
        let startX
        let startW
        let maxX
        function AIdragMouseDown(e) {
            if(e.button !== 0) return
            e = e || window.event;
            e.preventDefault();
            const {clientX} = e;
            startX = get_int_style('left')
            startW = get_int_style('width')
            offsetX = clientX - startX;
            maxX = startX + startW - minW
    
            document.addEventListener('mouseup',AIcloseDragElement)
            document.addEventListener('mousemove',AIelementDrag)
          }
        
          function AIelementDrag(e) {
                const {clientX} = e;
                let x = clientX - offsetX
                let w = startW + startX - x
                if(w < minW) w = minW;
                if(x > maxX) x = maxX;
                element.style.left = x + 'px';
                element.style.width = w + 'px';
          }
        
          function AIcloseDragElement() {
            document.removeEventListener("mouseup", AIcloseDragElement);  
            document.removeEventListener("mousemove", AIelementDrag);
          }
        return AIdragMouseDown
    }

    function resizeYNegative()
    {
        let offsetY
        let startY
        let startH
        let maxY
        function AIdragMouseDown(e) {
            if(e.button !== 0) return
            e = e || window.event;
            e.preventDefault();
            const {clientY} = e;
            startY = get_int_style('top')
            startH = get_int_style('height')
            offsetY = clientY - startY;
            maxY = startY + startH - minH 
    
            document.addEventListener('mouseup',AIcloseDragElement,false)
            document.addEventListener('mousemove',AIelementDrag,false)
          }
        
          function AIelementDrag(e) {
                const {clientY} = e;
                let y =  clientY - offsetY
                let h = startH + startY - y
                if(h < minH) h = minH;
                if(y > maxY) y = maxY;
                element.style.top = y + 'px';
                element.style.height = h + 'px';
          }
        
          function AIcloseDragElement() {
            document.removeEventListener("mouseup", AIcloseDragElement);  
            document.removeEventListener("mousemove", AIelementDrag);
          }
        return AIdragMouseDown
    }
}
// https://stackoverflow.com/questions/8960193/how-to-make-html-element-resizable-using-pure-javascript
  



// start drag https://www.w3schools.com/howto/howto_js_draggable.asp
function make_AI_draggable() { 
  consolecont_ai_ner=document.getElementById("cont_ai_ner");
    var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
//  if (document.getElementById(consolecont_ai_ner.id + "Heaven"))
//  if present, the Heaven is where you move the DIV from:
//     document.getElementById(consolecont_ai_ner.id + "Heaven").onmousedown = AIdragMouseDown;
//   } else {
//   otherwise, move the DIV from anywhere inside the DIV:
    document.getElementById("Heaven").onmousedown = consoleAIdragMouseDown;
   
 

  function consoleAIdragMouseDown(e) {
    e = e || window.event;
    e.preventDefault();
    // get the mouse cursor position at startup:
    pos3 = e.clientX;
    pos4 = e.clientY;
    document.onmouseup = closeconsoledrag;
    // call a function whenever the cursor moves:
    document.onmousemove = consoledrag;
  }

  function consoledrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    // set the element's new position:
    consolecont_ai_ner.style.top = (consolecont_ai_ner.offsetTop - pos2) + "px";
    consolecont_ai_ner.style.left = (consolecont_ai_ner.offsetLeft - pos1) + "px";
  }

  function closeconsoledrag() {
    /* stop moving when mouse button is released:*/
    document.onmouseup = null;
    document.onmousemove = null;
  }
}
// end drag https://www.w3schools.com/howto/howto_js_draggable.asp


 </script>
















  <div class="cont_ai_ner" id="cont_ai_ner">
      <div class="Heaven" id="Heaven" title="You Can Drag Me & Resize on Corners and Borders">
      <!--https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover-->
      <div class="dropdown"style="position: absolute;" >
        <button class="dropbtn" style="margin:3px;">Menu</button>
          <div class="dropdown-content">
           
            <a href="https://platform.openai.com/signup" target="_blank" title='Get Started &#013;SignUp for OpenAI Chat-GPT&#013;&#013;if you have a key&#013;enter it in the main window&#013; &#013;API_KEY label expands with an input field&#013;&#013;Paste your key in the input field&#013;&#013;would you give me feedback?&#013;is my info//guide/description right&#013;This is also new for me!'>
            <button class="dropbt" style="border:none;color:greenyellow" onmouseover="this.focus()" onmouseout="this.blur()">Get Started OpenAI Signup</button></a>
            
            <a href="https://platform.openai.com/account/api-keys" target="_blank" title="Get an API_KEY&#013;&#013;if you have a key&#013;enter it in the main window&#013;&#013;API_KEY label expands with an input field&#013;&#013;Paste your key in the input field&#013;&#013;would you give me feedback?&#013;is my info//guide/description right&#013;This is also new for me"><button class="dropbt" style="border:none;color:greenyellow" onmouseover="this.focus()" onmouseout="this.blur()">Get an API_KEY</button></a>
         
            <button onclick='openNewWindow("https://chat.openai.com/")' value="Chat-GPT WebPage" title="Chat-GPT WebPage" class="dropbt" style="border:none;color:greenyellow;" onmouseover="this.focus()" onmouseout="this.blur()">Chat-GPT WebPage</button>
            <a href="https://platform.openai.com/docs/models" target="_blank" title=""><button class="dropbt" style="border:none;" onmouseover="this.focus()" onmouseout="this.blur()">AI models info</button></a>
            <a href="https://platform.openai.com/usage" target="_blank" title="Traffic Tokens Usage"><button class="dropbt" style="border:none;" onmouseover="this.focus()" onmouseout="this.blur()">AI Usage Info</button></a>
            
            <button onclick='openNewWindow("https://status.openai.com/")' value="Chat-GPT WebPage" title="OpenAI Server Status&#013;&#013;Has some downtime&#013;&#013;&#013;would loke to have a status image" class="dropbt" style="border:none;color:greenyellow;" onmouseover="this.focus()" onmouseout="this.blur()">OpenAI API Server Status</button></button>
          
            <a href="https://github.com/ldijkman/Ace_Seventh_Heaven/discussions/6" target="_blank" title=""><button class="dropbt" style="border:none;" onmouseover="this.focus()" onmouseout="this.blur()">Comments, Suggestions, Feedback</button></a>
           
            <a href="https://ldijkman.github.io/Ace_Seventh_Heaven/Hell.html" target="_blank" title="Heaven or Hell"><button class="dropbt" style="border:none;" onmouseover="this.focus()" onmouseout="this.blur()">Heaven or Hell</button></a>
           
            <button class="dropbt" onclick="MaximizeAI();"style="border:none;">FullScreen</button><br>
            
          </div>
       </div>	
       <!--https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_js_dropdown_hover--> 
        <script>
            function openNewWindow(what) {
                 window.open(what, "_blank", "width=600, height=400");
           }
        </script>
        <center>
      	A.I. Code Assistant<!-- Ace Editor with AI / Ace Editor with AI -->
          <button onclick="toggleVisibility('cont_ai_ner')" style="float:right;margin:3px;margin-right:5px;" title="Close Window"> X </button>
          <a href="https://github.com/ldijkman/Ace_Seventh_Heaven/discussions/6" target="_blank" style="float:right;margin:3px;" title="Hellup"><button>?</button></a>
          <button onclick="MaximizeAI()" style="float:right;margin:3px;margin-right:5px;" title="Maximize AI Window to fullscreen"> + </button>
         <button onclick="normalsize()" style="float:right;margin:3px;margin-right:5px;" title="normalsize AI Window"> - </button>
        
         </center>
      </div>
      <div class="AfterWorld"  id="AfterWorld" title="The AfterWorld">
      	
      	
      	    <div style="border :1px solid white;margin:10px;padding:10px;" title="Enter an Openai API_KEY">
              <center> 
                    <label class="label" onmouseover="expandInput()" onmouseout="shrinkInput()" title="Get an OpenAI Api_Key Here!"><a href="https://platform.openai.com/account/api-keys" target="Heaven">API_KEY</a> : </label>
                    <input type="text" class="input" id="apikey" placeholder="Type or Paste APi_KEY here..." title="Type or Paste APi_KEY here..." onmouseover="expandInput()" onmouseout="shrinkInput()">
                    <br>
                    <!-- https://platform.openai.com/docs/models -->
                    <select name="model" id="model" title="Select an AI model">
                        <option value="gpt-3.5-turbo-1106" title="For me the Fastest and 16k" style="color:green;">gpt-3.5-turbo-1106  16k</option>
                        <option value="gpt-3.5-turbo" title="Slow for Me? Bussy? and 4k" style="color:green;">gpt-3.5-turbo 4k</option>
                        <option value="gpt-3.5-turbo-16k" title="Dont know 16k">gpt-3.5-turbo-16k</option>
                        <option value="code-davinci-002" title="Dont know" style="color:red;">code-davinci-002</option>
                        <option value="gpt-4-1106-preview" title="Dont know" style="color:red;">gpt-4-1106-preview</option>
                        <option value="gpt-4" title="Dont know" style="color:red;">gpt-4</option>
                    
                   
                    </select>
                    <!-- https://platform.openai.com/docs/models -->
                         
                   <button onclick='resultText.innerText=""' Title="WARNING!!!: Clear Chat Area/History">Clear Chat</button>
   
    <script> 
        function expandInput() {
            var container = document.querySelector('.input');
            container.style.width = '200px';
        }

        function shrinkInput() {
            var container = document.querySelector('.input');
            container.style.width = '0'; 
        }
        shrinkInput();
    </script>
              </center>
            </div>

<div>   <!--Streaming OpenAI API Completions in JavaScript-->
<!--
      <center>
      <h3 class=""> 
       OpenAI Code Assistant
      </h3>
      </center>
-->
      <div id="resultcont_ai_ner" class="" style="border :1px solid gray;margin:10px;padding:10px;">
        <!--<p class="">Generated Text</p>-->
        <p id="resultText" class="" title="Chat Content" ></p>
      </div>

      <center>
      <input type="text" id="promptInput" placeholder="Question Me..." title="Type or Paste your Question here...&#013;&#013;Looks like a little input field&#013;But it Handles more input as Google Bard"/>
      <div class=""><div id="spinner"></div>
        <br>
        <button id="generateBtn" class="" title="Submit Question">Generate</button>
        <button id="stopBtn" disabled class="" Title="Guess">Stop</button><br>
   
        </center>
      </div>
     <center>
     <br>
     <a href="https://ldijkman.github.io/Ace_Seventh_Heaven/Hell.html" target="Hell">Heaven or Hell, That is the Question.</a><br>
     </center>
    </div>
      	
      	
      
      <div class="Hell" title="&copy; Dirk Luberth Dijkman Bangert 30 Andijk The Netherlands">
        <center>
          <font style="font-size:10px;">
                &copy; Dirk Luberth Dijkman Bangert 30 Andijk The Netherlands
          </font>
          <button onclick="scrollToTop()"  style="float:right;" title="Scroll to Top"><font style="transform: rotate(90deg);float:left;"><</font></button>
          <button onclick="scrollToBottom()"  style="float:right;" title="Scroll to Bottom"><font style="transform: rotate(90deg);float:left;">></font></button>
        
        </center>
        
      </div>
    </div>

   
<!-- 
Copyright, Free to use if this/next message is left in the code   
    original source https://github.com/gopinav/ai 
  this: 
     OpenAI Stream Chat, HTML WebPage
       https://plnkr.co/edit/KmmUTa3FNTQ6WLa7
       https://codepen.io/ldijkman/pen/gOqWwxw?editors=1010
       https://ldijkman.github.io/Ace_Seventh_Heaven/OpenAI_Stream_Chat.html
             https://github.com/ldijkman/Ace_Seventh_Heaven/tree/main/docs
       https://www.facebook.com/luberth.dijkman/
Copyright, Free to use if this/above message is left in the code           
-->
    


 <script>
/*
<!-- 
Copyright, Free to use if this/next message is left in the code   
    original source https://github.com/gopinav/ai 
  this: 
     OpenAI Stream Chat, HTML WebPage
       https://plnkr.co/edit/KmmUTa3FNTQ6WLa7
       https://codepen.io/ldijkman/pen/gOqWwxw?editors=1010
       https://ldijkman.github.io/Ace_Seventh_Heaven/OpenAI_Stream_Chat.html
             https://github.com/ldijkman/Ace_Seventh_Heaven/tree/main/docs
       https://www.facebook.com/luberth.dijkman/
Copyright, Free to use if this/above message is left in the code   
-->
*/
// Add your code here
/**
 * This code demonstrates how to use the OpenAI API to generate chat completions.
 * The generated completions are received as a stream of data from the API 
 * and the
 * code includes functionality to handle errors and abort requests using an AbortController.
 * The API_KEY variable needs to be updated 
 * with the appropriate value from OpenAI for successful API communication.
 */



const API_URL = "https://api.openai.com/v1/chat/completions";


 var apiKey;
  // Check if there is an API key in local storage on page load
  // console.log("aks",localStorage.getItem("apiKey"));
  const storedApiKey = localStorage.getItem("apiKey");
  if (storedApiKey) {
    document.querySelector("#apikey").value = storedApiKey;
    setTimeout(function(){console.warn("Wow!,You have been here before, Welcome Back!");
    },500);
  } 
var API_KEY = document.querySelector("#apikey").value;

const promptInput = document.getElementById("promptInput");
const generateBtn = document.getElementById("generateBtn");
const stopBtn = document.getElementById("stopBtn");
const resultText = document.getElementById("resultText");

    // Add an event listener to the input element for the "input" event.
    document.getElementById("apikey").addEventListener("input", function(event) {
      // This function will be called whenever the user types in the input field.
      API_KEY = document.getElementById("apikey").value;
      console.debug("API_KEY ", API_KEY)
    });

   


let controller = null; // Store the AbortController instance

const generate = async () => {
  const spinner = document.getElementById("spinner");
  spinner.style.display = "block";
  
  if (!promptInput.value) {
    // alert("Please enter a prompt.");        // Alert is annoying change it         the user if no prompt value
    resultText.innerHTML += "<br><font style=\"color:red;\"><b>ERROR: </b>Enter a Question in input text field</font><br>";
    promptInput.value= "a prayer for my foolishness";
    generate();
    return;
  }

  console.debug("ask tokens ",promptInput.value.length);

  // Disable the generate button and enable the stop button
  generateBtn.disabled = true;
  stopBtn.disabled = false;
  resultText.innerText += "\n\n";

  // Create a new AbortController instance
  controller = new AbortController();
  const signal = controller.signal;

              // Get the dropdown element
            var dropdown = document.getElementById("model");

            // Get the selected value
            var aiGPT_Model = dropdown.options[dropdown.selectedIndex].value;

            // Log or use the selected value
            console.log("aiGPT_Model:", aiGPT_Model);

  try {
    // Fetch the response from the OpenAI API with the signal from AbortController
    const response = await fetch(API_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${API_KEY}`,
      },
      body: JSON.stringify({
        model: aiGPT_Model,
        messages: [{ role: "user", content: promptInput.value }],
        max_tokens: 4000,     // think 4000 chars for response leaves 96 for ask
        stream: true,         // For streaming responses
      }),
      signal,                 // Pass the signal to the fetch request
    });

    // Read the response as a stream of data
    const reader = response.body.getReader();
    const decoder = new TextDecoder("utf-8");
    //resultText.innerText = "";  //  i do not want to clear on each new question

    // Store the API key in local storage
    localStorage.setItem("apiKey", document.getElementById("apikey").value);
    console.log("ak",localStorage.getItem("apiKey"));
    document.getElementById("apikey").style.color="green";

console.time();
var message="";
    while (true) {
      const { done, value } = await reader.read();
      if (done) {
        break;
      }
      // Massage and parse the chunk of data
      const chunk = decoder.decode(value);
      const lines = chunk.split("\n");
      const parsedLines = lines
        .map((line) => line.replace(/^data: /, "").trim()) // Remove the "data: " prefix
        .filter((line) => line !== "" && line !== "[DONE]") // Remove empty lines and "[DONE]"
        .map((line) => JSON.parse(line)); // Parse the JSON string

      for (const parsedLine of parsedLines) {
        const { choices } = parsedLine;
        const { delta } = choices[0];
        const { content } = delta;
        // Update the UI with the new content
        if (content) {
          resultText.innerText += content;
          message+=content;
          console.info("Blah ",content); // https://youtu.be/mfJhMfOPWdE
           
          scrollAfterWorldToBottom(); // Scroll to the bottom after generating a message

        }
      }
    }
console.timeEnd();

console.debug("message tokens? ",message.length);
console.debug("message ",message);
console.debug("message tokens? ",message.length);

  promptInput.value="";  // clear ask field
 
  } catch (error) {
    // Handle fetch request errors
    if (signal.aborted) {
      resultText.innerText += "\nRequest aborted.\n";
    } else {
      console.error("Error:", error);
      resultText.innerHTML += "<br><font style=\"color:red;\">Error, is your API_KEY valid ?</font><br>";
      console.error("Error, is your API_KEY valid ?");
      document.getElementById("apikey").style.color="red";
     
    }
  } finally {
    // Enable the generate button and disable the stop button
    generateBtn.disabled = false;
    stopBtn.disabled = true;
    controller = null; // Reset the AbortController instance
  }
   spinner.style.display = "none";
};

const stop = () => {
  // Abort the fetch request by calling abort() on the AbortController instance
  if (controller) {
    controller.abort();
    controller = null;
  }
};

promptInput.addEventListener("keyup", (event) => {
  if (event.key === "Enter") {
    resultText.innerText +="\n---------------\nYou: "+ promptInput.value+"";
    generate();
  }
});

generateBtn.addEventListener("click", (event)=>{
  resultText.innerText +="\n---------------\nYou: "+ promptInput.value+"";
  generate();
});

stopBtn.addEventListener("click", stop);

// Function to scroll the AfterWorld div to the bottom
function scrollAfterWorldToBottom() {
  var AfterWorld = document.getElementById("AfterWorld");
  AfterWorld.scrollTop = AfterWorld.scrollHeight;
}

  function scrollToTop() {
    AfterWorld.scrollTo({
      top: 0,
      behavior: "smooth"
    });
  }

  function scrollToBottom() {
    AfterWorld.scrollTo({
    top: document.body.scrollHeight,
    behavior: "smooth"
  });
  }



  function MaximizeAI() {
      document.getElementById("cont_ai_ner").style.width = '100%';
      document.getElementById("cont_ai_ner").style.height = '100%';
      document.getElementById("cont_ai_ner").style.left = '0';
      document.getElementById("cont_ai_ner").style.top = '0';
  }

    function normalsize() {
      document.getElementById("cont_ai_ner").style.width = '40%';
      document.getElementById("cont_ai_ner").style.height = '80%';
      document.getElementById("cont_ai_ner").style.left = '30%';
      document.getElementById("cont_ai_ner").style.top = '10%';
  }


</script>




<script>
  function toggleFullscreen() {
    const elem = document.documentElement;

    if (!document.fullscreenElement) {
      if (elem.requestFullscreen) {
        elem.requestFullscreen();
      } else if (elem.mozRequestFullScreen) { /* Firefox */
        elem.mozRequestFullScreen();
      } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
        elem.webkitRequestFullscreen();
      } else if (elem.msRequestFullscreen) { /* IE/Edge */
        elem.msRequestFullscreen();
      }
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.mozCancelFullScreen) { /* Firefox */
        document.mozCancelFullScreen();
      } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */
        document.webkitExitFullscreen();
      } else if (document.msExitFullscreen) { /* IE/Edge */
        document.msExitFullscreen();
      }
    }
  }
</script>





/*
<!-- 
Copyright, Free to use if this/next message is left in the code   
    original source https://github.com/gopinav/ai 
  this: 
     OpenAI Stream Chat, HTML WebPage
       https://plnkr.co/edit/KmmUTa3FNTQ6WLa7
       https://codepen.io/ldijkman/pen/gOqWwxw?editors=1010
       https://ldijkman.github.io/Ace_Seventh_Heaven/OpenAI_Stream_Chat.html
             https://github.com/ldijkman/Ace_Seventh_Heaven/tree/main/docs
       https://www.facebook.com/luberth.dijkman/
Copyright, Free to use if this/above message is left in the code   
-->
*/
      </script>
    
    
<!-- 
Copyright, Free to use if this/next message is left in the code   
    original source https://github.com/gopinav/ai 
  this: 
     OpenAI Stream Chat, HTML WebPage
       https://plnkr.co/edit/KmmUTa3FNTQ6WLa7
       https://codepen.io/ldijkman/pen/gOqWwxw?editors=1010
       https://ldijkman.github.io/Ace_Seventh_Heaven/OpenAI_Stream_Chat.html
             https://github.com/ldijkman/Ace_Seventh_Heaven/tree/main/docs
       https://www.facebook.com/luberth.dijkman/
Copyright, Free to use if this/above message is left in the code           
-->        
    <script>
        function toggleVisibility(what) {
            var myDiv = document.getElementById(what);

            // Toggle the visibility
            if (myDiv.style.display === "none") {
                myDiv.style.display = "block";
                 console.warn('run in console => toggleVisibility("'+what+'");');
            } else {
                myDiv.style.display = "none";
                console.warn('run in console => toggleVisibility("'+what+'");');
            }
        }
    </script>
                                  
</body>

</html>
