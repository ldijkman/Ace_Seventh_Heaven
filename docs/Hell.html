<!--
i think the editor is now more like plugin like in the editor
only problem i have is i wat v scroll for minimapeditor and not for editor

i want a resizeble html previewer https://codepen.io/ldijkman/pen/jOXKLaW


-->

<!--
https://github.com/ukandrewc/Ace-Scrollbars/tree/master

https://github.com/ldijkman/Ace-Scrollbars/tree/master/docs

-->

<!DOCTYPE html>
<html lang="en">
<script>
var warning = true;
window.onbeforeunload = function() {
  if (warning) {
    return "You have made changes on this page that you have not yet confirmed. If you navigate away from this page you will lose your unsaved changes";
    }
}
</script>

  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/ldijkman/randomnerd_esp32_wifi_manager/main/Electra.jpg">

<title>Ace Seventh Heaven</title>

<head>
	<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.6">

	<style type="text/css" media="screen">


    body {
  color-scheme:  dark;
  background-color:black;
  overscroll-behavior: none;
  	overflow: hidden;
}


		#editor {
         /* Initially, the left takes 3/4 width */
    width: 80%;
  height: 100%;
    /* Misc */
    
   display: flex;
			pposition: relative; 
			ptop: 0%;
    pwidth: 100%;
    pheight: 94%;
 }


 .ace_editor .ace_marker-layer .ace_selection{ background-color:orange; }

 .ace_editor .ace_marker-layer .ace_selected-word{ background-color:orange; }






#editor .ace_scrollbar-v {  /* hide vertical scrollbar */
	ooverflow: hidden;
}
.ace_scrollbar-h {  /*  */
	width: 100%;
}
.ace_scroll-v {
	z-index: 1000;
	position: absolute;
	top: 0;
	right: 4px;
	bottom: 12px;
	width: 30px;
  border: 1px solid gray;
	//background: #D2CECE;
}

.ace_thumb-v {
	background: lightgray;
}
/*
.ace_scroll-h {
	z-index: 1000;
	position: absolute;
	left: 0;
	right: 0;
	bottom: 0;
	height: 12px;
	background: yellow
}

.ace_thumb-h {
	background: lightgray
}
*/
.ace_map-row {
	z-index: 1001; 
	position: absolute;
	pointer-events: none;
	top: 0;
	right: 4px;
	width: 30px;
	height: 2px;
	background: greenyellow;
}

.ace_map-item {
	z-index: 1002;
	position: absolute;
	pointer-events: none;
	right: 10px;
	width: 20px;
	height: 2px;
	background: cornflowerblue
}

.ace_link_marker {
      position: absolute;
      border-bottom: 5px solid red;
      //background:aqua;
      opacity:50%;

}

.ace_search  {
  position:absolute;
    border-radius: 4px 4px 4px 5px;
    border-right: 0 none;
    right:auto;
    cursor: move;
    color-scheme:  dark;
    background-color: #444444;
    color:lightgray;
}
.ace_search.right {
  position:absolute;
    border-radius: 4px 4px 4px 5px;
    border-right: 0 none;
    left:5%;
    top:2%;
    font-size:15px; /*otherwise it scales with fontsize of editor inherit*/
    right:auto;
    cursor: move;
    color-scheme:  dark;
    background-color: #444444;
    color:lightgray;
}
.ace_button {
    color: lightgray;
}



   #minimapeditor {
    position:absolute;
    right:50px;
    top:0;
    width: 150px;
    height: 97%;
    background-color:;
    border:1px;
    border: solid;
    border-color:gray;
 }
.ace_scrollbar-h {
    width:80%;
}

#minimapeditor .ace_scrollbar-h {
    display: none;
}







a:-webkit-any-link {
    color: lightgray;
    cursor: pointer;
    text-decoration: underline;
}

#minimapeditor .ace_active-line{
 // oooooopacity:60%;
}
.ace_link_marker {
      position: absolute;
      border-bottom: 5px solid red;
      //background:aqua;
      opacity:50%;

}

 .ace_search  {
    border-radius: 8px 8px 8px 8px;
    border-right: 0 none;
    right:auto;
    cursor: move;
    color-scheme:  dark;
    background-color: #444444;
    color:lightgray;
}
 .ace_search.right {
    border-radius: 8px 8px 8px 8px;
    border-right: 0 none;
    right:auto;
    cursor: move;
    color-scheme:  dark;
    background-color: #444444;
    color:lightgray;
}

.ace_search.ace_searchbtn_close{
  background-color:red;
}
#minimapeditor .ace_scrollbar-v {
    
}
    
    
    /*https://phuoc.ng/collection/html-dom/create-resizable-split-views/*/
body{
     width: 100%;
    height: 100%;
}
.container {
  position:absolute;
   display: flex;
    top:5%;
    width: 100%;
    height: 95%;
    /* Misc */
    border: 1px solid #cbd5e0;  

}
.container__left {
    /* Initially, the left takes 3/4 width */
    width: 80%;
  height: 100%;
    /* Misc */
    
   display: flex;
    

}
.resizer {
    background-color: #cbd5e0;
    cursor: ew-resize; 
 
    width: 6px;
  
}
.container__right {
    /* Take the remaining width */
    flex: 1;
    width:100%;
  height:100%;
    /* Misc */
    
    display: flex;
    
}
 /*
https://github.com/ukandrewc/Ace-Scrollbars/tree/master
*/


.ace_scrollbar-v {  /* hide vertical scrollbar */
	ooverflow: hidden;
}
.ace_scrollbar-h {  /*  */
	width: 100%;
}
.ace_scroll-v {
	z-index: 1000;
	position: absolute;
	top: 0;
	right: 4px;
	bottom: 12px;
	width: 30px;
  border: 1px solid gray;]
	//background: #D2CECE;
}

.ace_thumb-v {
	background: darkgray;
}
/*
.ace_scroll-h {
	z-index: 1000;
	position: absolute;
	left: 0;
	right: 0;
	bottom: 0;
	height: 12px;
	background: yellow 
}

.ace_thumb-h {
	background: lightgray
}
*/
.ace_map-row {
	z-index: 1001;
	position: absolute;
	pointer-events: none;
	top: 0;
	right: 4px;
	width: 30px;
	height: 2px;
	background: greenyellow;
}

.ace_map-item {
	z-index: 1002;
	position: absolute;
	pointer-events: none;
	right: 10px;
	width: 20px;
	height: 2px;
	background: cornflowerblue
}   
        #preview {
      /**/
      /* Take the remaining width */
      flex: 1;
      height: 100%;
      display: flex;
    }

    #preview iframe {
      width: 100%;
      height: 100%;
      border: none;
      overflow: hidden;
    }

    #status {
      position:absolute;
      padding: 0px 0;
      height: 55px;
      width:100%;
      z-index:100000;
    }
        #preview {
      /**/
      /* Take the remaining width */
      flex: 1;
      height: 100%;
      display: flex;
    }

    #preview iframe {
      width: 100%;
      height: 100%;
      border: none;
      overflow: hidden;
    }

    #status {
      position:absolute;
      padding: 0px 0;
      height: 55px;
      width:100%;
      z-index:100000;
    }
</style>
  

<script>
   
   //https://phuoc.ng/collection/html-dom/create-resizable-split-views/
document.addEventListener('DOMContentLoaded', function () {
    // Query the element
    const resizer = document.getElementById('dragMe');
    const leftSide = resizer.previousElementSibling;
    const rightSide = resizer.nextElementSibling;

    // The current position of mouse
    let x = 0;
    let y = 0;
    let leftWidth = 0;

    // Handle the mousedown event
    // that's triggered when user drags the resizer
    const mouseDownHandler = function (e) {
        // Get the current mouse position
        x = e.clientX;
        y = e.clientY;
        leftWidth = leftSide.getBoundingClientRect().width;

        // Attach the listeners to document
        document.addEventListener('mousemove', mouseMoveHandler);
        document.addEventListener('mouseup', mouseUpHandler);
    };

    const mouseMoveHandler = function (e) {
        // How far the mouse has been moved
        const dx = e.clientX - x;
        const dy = e.clientY - y;

        const newLeftWidth = ((leftWidth + dx) * 100) / resizer.parentNode.getBoundingClientRect().width;
        leftSide.style.width = newLeftWidth + '%';

        resizer.style.cursor = 'col-resize';
        document.body.style.cursor = 'col-resize';

        leftSide.style.userSelect = 'none';
        leftSide.style.pointerEvents = 'none';

        rightSide.style.userSelect = 'none';
        rightSide.style.pointerEvents = 'none';
    };

    const mouseUpHandler = function () {
        resizer.style.removeProperty('cursor');
        document.body.style.removeProperty('cursor');

        leftSide.style.removeProperty('user-select');
        leftSide.style.removeProperty('pointer-events');

        rightSide.style.removeProperty('user-select');
        rightSide.style.removeProperty('pointer-events');

        // Remove the handlers of mousemove and mouseup
        document.removeEventListener('mousemove', mouseMoveHandler);
        document.removeEventListener('mouseup', mouseUpHandler);
    };

    // Attach the handler
    resizer.addEventListener('mousedown', mouseDownHandler);
});
   
   

   
  </script>
<script type="text/javascript" src="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/Ace_color/ext-scrollbar.js"></script>
<!--
 <link rel="stylesheet" href="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/Ace_color/ext-scrollbar.css" />
-->


</head>

<body>


<input type="button" onclick="document.getElementById('openbton').click()" value="Open File">
<input
        type="file"
        id="openbton"
        onchange="openCode(this.files)"
        value="Open PC"
        style="background-color:lightgray;color:black;font-weight: bold;"
        title="For PC load a file from Disk"
        hidden
      />
<input class="text" value="7th_Heaven.html" title="FileName">

<button onclick='save()' style="background-color:lightgreen;color:black;font-weight: bold;">Save by DownLoad</button>
&nbsp;
<button class=text type="button" style="background-color:lightgreen;color:black;font-weight: bold;" title="if Framed DownLoad- if FullScreen maybe Save to Disk">Save to Disk?</button>
&nbsp;
<button onclick="toggleFullScreen()" title="Toggle FullScreen" style="background-color:lightblue;color:black;font-weight: bold;">Toggle FullScreen</button>
&nbsp;
      <button onclick='ace.edit("editor").setFontSize(parseInt(ace.edit("editor").getFontSize())-1);document.getElementById("fontSize").value=editor.getFontSize()' title="FontSize -">&nbsp;-&nbsp;</button>
      <input type="number" id="fontSize" style="width: 3em;" value='20' oninput='ace.edit("editor").setFontSize(parseInt(this.value))'  title="FontSize">
      <button onclick='ace.edit("editor").setFontSize(parseInt(ace.edit("editor").getFontSize())+1);document.getElementById("fontSize").value=editor.getFontSize()' title="FontSize +">&nbsp;+&nbsp;</button>
&nbsp;
          <select id="ace-mode" style="width: 75px;" title="select editor file type mode">
            <option value="css">CSS</option>
            <option value="html" selected>HTML</option>
            <option value="javascript">JavaScript</option>
            <option value="json">JSON</option>
            <option value="text">Text</option>
            <option value="c_cpp">C and C++</option>
          </select>
&nbsp;
<select id="ace-theme" size="1" style="width: 100px;" title="select a theme colorscheme"><optgroup label="Bright"><option value="ace/theme/chrome">Chrome</option><option value="ace/theme/clouds">Clouds</option><option value="ace/theme/crimson_editor">Crimson Editor</option><option value="ace/theme/dawn">Dawn</option><option value="ace/theme/dreamweaver">Dreamweaver</option><option value="ace/theme/eclipse">Eclipse</option><option value="ace/theme/github">GitHub</option><option value="ace/theme/iplastic">IPlastic</option><option value="ace/theme/solarized_light">Solarized Light</option><option value="ace/theme/textmate">TextMate</option><option value="ace/theme/tomorrow">Tomorrow</option><option value="ace/theme/xcode">XCode</option><option value="ace/theme/kuroir">Kuroir</option><option value="ace/theme/katzenmilch">KatzenMilch</option><option value="ace/theme/sqlserver">SQL Server</option></optgroup><optgroup label="Dark"><option value="ace/theme/ambiance">Ambiance</option><option value="ace/theme/chaos">Chaos</option><option value="ace/theme/clouds_midnight">Clouds Midnight</option><option value="ace/theme/dracula">Dracula</option><option value="ace/theme/cobalt">Cobalt</option><option value="ace/theme/gruvbox">Gruvbox</option><option value="ace/theme/gob">Green on Black</option><option value="ace/theme/idle_fingers">idle Fingers</option><option value="ace/theme/kr_theme">krTheme</option><option value="ace/theme/merbivore">Merbivore</option><option value="ace/theme/merbivore_soft">Merbivore Soft</option><option value="ace/theme/mono_industrial">Mono Industrial</option><option value="ace/theme/monokai">Monokai</option><option value="ace/theme/nord_dark">Nord Dark</option><option value="ace/theme/one_dark">One Dark</option><option value="ace/theme/pastel_on_dark">Pastel on dark</option><option value="ace/theme/solarized_dark">Solarized Dark</option><option value="ace/theme/terminal">Terminal</option><option value="ace/theme/tomorrow_night">Tomorrow Night</option><option value="ace/theme/tomorrow_night_blue">Tomorrow Night Blue</option><option value="ace/theme/tomorrow_night_bright">Tomorrow Night Bright</option><option value="ace/theme/tomorrow_night_eighties">Tomorrow Night 80s</option><option value="ace/theme/twilight">Twilight</option><option value="ace/theme/vibrant_ink" selected>Vibrant Ink</option></optgroup></select>
&nbsp;
<button onclick='ace.edit("minimapeditor").setFontSize(parseFloat(ace.edit("minimapeditor").getFontSize())-.1);document.getElementById("minimapfontSize").value=minimapeditor.getFontSize()' title="MiniMap FontSize -">&nbsp;-&nbsp;</button>
<input type="number" id="minimapfontSize" style="width: 3em;" value='3' step="0.1" oninput='ace.edit("minimapeditor").setFontSize(parseFloat(this.value))'  title="MiniMap FontSize">
<button onclick='ace.edit("minimapeditor").setFontSize(parseFloat(ace.edit("minimapeditor").getFontSize())+.1);document.getElementById("minimapfontSize").value=minimapeditor.getFontSize()' title="MiniMap FontSize +">&nbsp;+&nbsp;</button>
&nbsp;
<button onclick="showhideminimap()">Show / Hide MiniMap</button>
&nbsp;
<a href="https://plnkr.co/edit/Digj5Fw7D6hxaTU4?preview" target="Ace JumpScroll">[ Ace JumpScroll ]</a>




	<!--////////////////////////////////////////////////////////////-->


<div class="container">
    <div id="editor" onmouseover='ace.edit("editor").focus();'>
      <textarea>
      xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
https://github.com/ldijkman/Ace-Scrollbars/blob/master/docs/Ace_editor_custom_scrollbar.html

custom scrollbar show search / select highlight position in vertical scrollbar


 You can drag move the search/replace!
    to a desired position on the screen
        Beat that! VisualStudio Monaco ;-)

The Editor of the Web
  Demo: https://ldijkman.github.io/Ace_Seventh_Heaven/Seventh_Heaven.html
  Source: https://github.com/ldijkman/Ace_Seventh_Heaven/tree/main/docs
  BlahBlah: https://github.com/ldijkman/Ace_Seventh_Heaven/discussions


this demo adds a vertical scrollbar
higlight search / select positions file Overview vertical scrollbar visualizer
MiniMap File OverView
links / url in the the editor highlight red underline
on mouseover and if clicked open in a new window

    click on the editor text, so that the focus is on the editor
    ctrl+f search/find
    search for function
    results positions are  visible in vertical scrollbar

    if you select highlight a word by doubleclck on a word
    => say doubleclick on next  => function
    it also shows occurrence positions on vertical scrollbar
    search shows more like functional
    doubleclick on function does not do functional

focus must be on editor

   control+, (ctrl+comma) for options
   F1 for shortcuts

   ctrl+c copy
   ctrl+v paste     (mouse mid button)
   ctrl+a selectall

   ctrl+f find
   ctrl+h replace

   ctrl+z undo
   ctrl+y redo

   ctrl+alt+mouseleft click or drag  blockselect multicursor set


focus must be on editor

    only gray view is off target
    changed custom scrollbar visualizer code a bit from pixels to percent
    think it works a bit better now

    Ace MiniMap Demo https://ldijkman.github.io/Ace_MiniMap/ace_editor_minimap.html

    https://youtu.be/YjZ-waKmJbc

    https://youtu.be/OMbZ_-kfY2M

    https://plnkr.co/edit/Digj5Fw7D6hxaTU4

    https://github.com/ldijkman/Ace-Scrollbars/tree/master/docs

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx



       </textarea>
    </div>
  
   <div class="resizer" id="dragMe"></div>
    <div class="container__right">
            <div id="preview">
              <div id="status">	<p><i class="fa fa-spinner fa-spin fa-fw"></i> generating preview</p></div>
            </div>
  </div> 
</div>    
  
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ace.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-keybinding_menu.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-prompt.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-language_tools.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/mode-html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/mode-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/mode-css.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/mode-c_cpp.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/snippets/html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/snippets/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/snippets/css.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/worker-html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/worker-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/worker-css.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-searchbox.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/worker-base.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-beautify.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-settings_menu.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-keybinding_menu.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-spellcheck.min.js"></script>


<script src="https://ldijkman.github.io/Ace-Editor-Click-Link-window.open-URL/hoverlink.js"></script>
<!--  https://github.com/ldijkman/Ace-Editor-Click-Link-window.open-URL/tree/main/docs -->

<script type="text/javascript" src="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/Ace_color/ace-colorpicker-min.js" ></script>
<link rel="stylesheet" href="https://ldijkman.github.io/randomnerd_esp32_wifi_manager/mrs/Ace_color/ace-colorpicker.css" />


  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>






<script>


var editor = ace.edit("editor")
var beauty = ace.require("ace/ext/beautify")

ace.require("ace/ext/language_tools")
//ace.require("ace/ext/emmet")     // do not know what emmet is and does
editor.setTheme("ace/theme/vibrant_ink")
editor.session.setMode("ace/mode/html", function() {
	LoadColorPicker()
})
  function LoadColorPicker() {
    console.log("load colorpicker now in function LoadColorPicker");
    window.editor = ace.edit("editor");
    AceColorPicker.load(ace, editor);
  }
    var Range = ace.require('ace/range').Range // get reference to ace/range
    ace.require("ace/ext/language_tools");
    //ace.require('ace/ext/ext-linking'); // not sure if this is correct ace/ext/linking
	  ace.require("ace/ext/emmet");          // do not know what emmet is and does


		editor.setOptions({
			enableBasicAutocompletion: true,
			enableLiveAutocompletion: true,
			enableSnippets: true,
			//enableEmmet: true,                 // do not know what emmet is and does
			fixedWidthGutter: true,
			showFoldWidgets: false,
			displayIndentGuides: false,
			printMargin: false,
			fontFamily: '',
      fontSize:20,
			tabSize: 2
		})

 editor.setOption(editor.$options.animatedScroll.name, true);
 editor.setOption("enableEmmet", true);     // do not know what emmet is and does

var myTimeout;  // for update timeout minimap

    HoverLink = require("hoverlink").HoverLink
    editor.hoverLink = new HoverLink(editor);



// click on URL link in editor
editor.hoverLink.on("open", function() {
  // alert("trying to open")
  console.log("trying to open",editor.hoverLink.link.value);

  if(editor.hoverLink.isOpen){
      window.open(editor.hoverLink.link.value);
 }
  console.log("this.link",editor.hoverLink.isOpen);
})

editor.execCommand('find');         // create the search find replace popup
                                    // https://jqueryui.com/draggable/
                                    // maybe a little delay before make it draggable
                                    // think draggable wants to add code to div class="ace_search"
Time_out_delay = setTimeout(function(){
   $( ".ace_search" ).draggable();  // after an edit the search / replace popup is draggable
}, 250);

// https://jqueryui.com/draggable/
//$( function() {
//    $( ".ace_search" ).draggable();
//} );




		new AceScrollbars(editor);

		function indentCode() {
			let p = editor.selection.getCursor()
			beauty.beautify(editor.session)
			editor.selection.moveToPosition(p)
		}

		function loadSource() {
			editor.setValue(name)
			beauty.beautify(editor.session)
			editor.navigateFileStart()
			editor.focus()
		}

		function saveSource() {
			indentCode()
			getSource()
		}

		function getSource() {
			name = editor.getValue()
		}

   // const addCSS = css => document.head.appendChild(document.createElement("style")).innerHTML=css;
   // addCSS(".ace_editor .ace_marker-layer .ace_selection{ background-color:orange; }");

   // const addCSStwo = css =>document.head.appendChild(document.createElement("style")).innerHTML=css;
   // addCSStwo(".ace_editor .ace_marker-layer .ace_selected-word{ background-color:orange; }");



editor.on('mousedown', () => {
     minimapeditor.selection.clearSelection();
     minimapeditor.selection.selectLine();
});



var marker; //gray select on minimap

editor.session.on("changeScrollTop", function() {

    var s=editor.renderer.getFirstVisibleRow()
    var e=editor.renderer.getLastVisibleRow()
    var m = s+((e-s)/2);    // center of editor

    minimapeditor.scrollToLine(m, true, true, function () {});
    ace.edit("minimapeditor").moveCursorTo(m);
    ace.edit("minimapeditor").gotoLine(m);

 minimapeditor.session.removeMarker(marker);  // grau selection on minimap
 marker=minimapeditor.session.addMarker(new Range(s, 0, e, 0), "ace_active-line", "fullLine");
})



// on change main big editor change content minimap editor 5 sec delay of no change
editor.getSession().on('change', function () {

    // timeout here?
    // update minimap after 5 seconds no change (update every keypres makes editor slow)
    clearTimeout(myTimeout); // clear if new change
    myTimeout = setTimeout(function(){
        minimapeditor.setValue(editor.getSession().getValue());
        minimapeditor.selection.clearSelection();
    }, 1000);

    ace.edit("editor").focus(); // To focus the ace editor
    ace.edit("editor").renderer.$cursorLayer.showCursor();

});




// test maybe better for plugin alike code
editor.container.insertAdjacentHTML("beforeend", "<div id=\"minimapeditor\" class=\"minimapeditor\" onmouseover=\'ace.edit(\"minimapeditor\").focus();\'></div>")


//////////////////////////////////////////////////////////
// minimaoeditor
//////////////////////////////////////////////////////////
  var minimapeditor = ace.edit("minimapeditor");
  minimapeditor.session.setMode("ace/mode/html");
  minimapeditor.setTheme("ace/theme/vibrant_ink");
  minimapeditor.setFontSize(3.0);
  minimapeditor.setShowPrintMargin(false);
  minimapeditor.renderer.setShowGutter(false);
  minimapeditor.setReadOnly(true);
  minimapeditor.renderer.setOption('showLineNumbers', false);
  editor.setOption("showPrintMargin", false);

  minimapeditor.setValue(editor.getSession().getValue());
  minimapeditor.selection.clearSelection();
  //minimapeditor.setOption(minimapeditor.$options.animatedScroll.name, true);
  //minimapeditor.setAutoScrollEditorIntoView(true)


// get linenumeber on minimap mouseclick
minimapeditor.on('mousedown', () => {
    // mouseup works better?
});



// get linenumeber on minimap mouseup, for set main editor cursor position
minimapeditor.on('mouseup', () => {       // var cursor = minimapeditor.getCursorPosition();
    var cursorrow = minimapeditor.getCursorPosition().row;
    var cursorcolumn = minimapeditor.getCursorPosition().column;
    // var cursorPos = $scope.editor.getCursorPosition()

    // move cursorr big editor to cursor rom clickpos minimapeditor
    ace.edit("editor").gotoLine(cursorrow,cursorcolumn);
    ace.edit("editor").moveCursorTo(cursorrow,cursorcolumn);
    // console.log("getcursor row",cursorrow );
    // minimapeditor.selection.clearSelection();

    minimapeditor.scrollToLine(cursorrow, true, true, function () {});
    ace.edit("minimapeditor").moveCursorTo(editor.getCursorPosition());
    ace.edit("minimapeditor").gotoLine(cursorrow,cursorcolumn);
    minimapeditor.setAutoScrollEditorIntoView(true)

     minimapeditor.session.removeMarker(marker);
     // marker=minimapeditor.session.addMarker(new Range(editor.renderer.getFirstVisibleRow(), 0, editor.renderer.getLastVisibleRow(), 0), "ace_active-line", "fullLine");

});










// https://www.w3schools.com/howto/howto_js_toggle_hide_show.asp
function showhideminimap() {
  var x = document.getElementById("minimapeditor");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
}






function toggleFullScreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
      }
}

// save part of https://codepen.io/8354801/pen/OeOBXm
function save() {
  download('Ace_Seventh_Heaven.html', editor.getValue());
}

// download part of https://codepen.io/8354801/pen/OeOBXm
function download(filename, text) {
      var element = document.createElement('a');
      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
      // get text value name is set by openfile
      filename=document.querySelector("input.text").value;
      element.setAttribute('download', filename);

      element.style.display = 'none';
      document.body.appendChild(element);

      element.click();

      document.body.removeChild(element);
}


// https://plnkr.co/edit/GCLwKqNGqi4R2Fnr?preview


  function openCode(files) {
        var file = files[0];
        if (!file) return;
        var modelist = ace.require('ace/ext/modelist');
        var modeName = modelist.getModeForPath(file.name).mode;
        editor.session.setMode(modeName);
        minimapeditor.session.setMode(modeName);
        document.getElementById('ace-mode').value=modeName.replace("ace/mode/",""); // not correct mode select  blanks
console.log("modeName ",modeName.replace("ace/mode/",""));

        console.log("file.name",file.name);
        console.log("change page title",file.name+" Ace Seventh Heaven");
        document.querySelector('title').textContent = file.name+" Ace Seventh Heaven";
        // silly set filename text field for save to disk filename
        document.querySelector("input.text").value=file.name;      

        reader = new FileReader();
        reader.onload = function () {
          editor.session.setValue(reader.result);
        };
        reader.readAsText(file);


      }



    document.getElementById('ace-theme').addEventListener('change', function(e) {
      console.log((document.getElementById('ace-theme').value).toLowerCase());
      e.preventDefault();
      ace.edit("editor").setTheme('' + (document.getElementById('ace-theme').value).toLowerCase());
     ace.edit("minimapeditor").setTheme('' + (document.getElementById('ace-theme').value).toLowerCase());

    floatbuttons();
    });


    document.getElementById('ace-mode').addEventListener('change', function(e) {
      console.log((document.getElementById('ace-mode').value).toLowerCase());
      e.preventDefault();
      ace.edit("editor").getSession().setMode('ace/mode/' + (document.getElementById('ace-mode').value).toLowerCase());
    });


function myFunction(){	
	
  $("#preview").empty();
	$("#status p").delay(500).fadeOut(2500);
	
	var code = editor.getValue();
	
	var iframe = document.createElement('iframe');
	
	var preview = document.getElementById('preview');
	var content = '<!doctype html>' + code;

	preview.appendChild(iframe);

	iframe.contentWindow.document.open('text/htmlreplace');
	iframe.contentWindow.document.write(content);
	iframe.contentWindow.document.close();
	
	// $("#preview").html(code);

}

myFunction();

var timeout;

$('#search-form .search-terms').on('keydown', function(e){
  /*  // get keycode of current keypress event
    var code = (e.keyCode || e.which);

    // do nothing if it's an arrow key
    if(code == 37 || code == 38 || code == 39 || code == 40) {
        return;
    }

    // do normal behaviour for any other key
    $('#search-items #autocom').fadeIn();
    */
});

$("#editor").on('keyup', function(e) {
 
console.log("keyup");

	    var code = (e.keyCode || e.which);

    // do nothing if it's an arrow key
    if(code == 37 || code == 38 || code == 39 || code == 40) {
        return;
    }
	$("#status p").fadeIn(2000);
	
	console.log("yea");

	if(timeout) {
		clearTimeout(timeout);
		timeout = null;
	}


	timeout = setTimeout(myFunction, 2500)
	
});

///////////////////////////////////////////////////////////////////////////
// arduino alike map function == Re-maps a number from one range to another.
// https://www.arduino.cc/reference/en/language/functions/math/map/
// https://stackoverflow.com/questions/5649803/remap-or-map-function-in-javascript
// scale range 1 into range2 bar range to 0 to 1440 minute range
// or
// scale a minutevalue in range 0 to 1440 minutes to 0% to 100%,  used for left and width of timeslot divs
///////////////////////////////////////////////////////////////////////////////
function map_range(value, low1, high1, low2, high2) {
    return (low2 + (high2 - low2) * (value - low1) / (high1 - low1)).toFixed(3);   // to 3 decimals, Math.round did not scale right
}



document.addEventListener("DOMContentLoaded", () => {
   editor.find("function");
});

</script>


<textarea rows=5 cols ="55" hidden>
4 7th Heaven Editor?<br>
<a href="https://ldijkman.github.io/Ace_Seventh_Heaven/Seventh_Heaven.html" target="7th_Heaven">https://ldijkman.github.io/Ace_Seventh_Heaven/Seventh_Heaven.html</a><br>
</textarea>
 

 <script>
    // https://web.dev/patterns/files/save-a-file/#using-the-file-system-access-apis-showsavefilepicker-method
    // https://web.dev/patterns/files/save-a-file/demo.html
    // https://plnkr.co/edit/oOmxxNPfJlkjIh9i
    // https://github.com/GoogleChromeLabs/browser-fs-access	 
    // https://googlechromelabs.github.io/browser-fs-access/demo/



     var textarea = editor.getValue(),
      textInput = document.querySelector("input.text"),
      textButton = document.querySelector("button.text"),
      img = document.querySelector("img"),
      imgInput = document.querySelector("input.img"),
      imgButton = document.querySelector("button.img"),
      saveFile = async (e, t) => {
        if ("showSaveFilePicker" in window && (() => {
            try {
              return window.self === window.top
            } catch {
              return !1
            }
          })()) try {
          const n = await showSaveFilePicker({
              suggestedName: t
            }),
            a = await n.createWritable();
          return await a.write(e), void await a.close()
        } catch (e) {
          return void("AbortError" !== e.name && console.error(e.name, e.message))
        }
        const n = URL.createObjectURL(e),
        a = document.createElement("a");
        a.href = n,
        a.download = t,
        a.style.display = "none",
        document.body.append(a), a.click(),
        setTimeout((() => {
          URL.revokeObjectURL(n), a.remove()
        }), 1e3)
      };
    textButton.addEventListener("click", (async () => {
      const e = new Blob([editor.getValue()], {
        type: "text/plain"
      });
      await saveFile(e, textInput.value)
    })), imgButton.addEventListener("click", (async () => {
      const e = await fetch(img.src).then((e => e.blob()));
      await saveFile(e, imgInput.value)
    }));
    // https://web.dev/patterns/files/save-a-file/#using-the-file-system-access-apis-showsavefilepicker-method
    // https://web.dev/patterns/files/save-a-file/demo.html
    // https://plnkr.co/edit/oOmxxNPfJlkjIh9i
    // https://github.com/GoogleChromeLabs/browser-fs-access	 
    // https://googlechromelabs.github.io/browser-fs-access/demo/	 
   
   

   
  </script>

</body>

</html>
